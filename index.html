<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS, html5，Swift，自学" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="不积跬步，无以至千里；不积小流，无以成江海。">
<meta property="og:type" content="website">
<meta property="og:title" content="清风明心">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="清风明心">
<meta property="og:description" content="不积跬步，无以至千里；不积小流，无以成江海。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="清风明心">
<meta name="twitter:description" content="不积跬步，无以至千里；不积小流，无以成江海。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"right","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> 清风明心 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '',
      xfbml      : true,
      version    : 'v2.6'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/zh_Hans/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>











  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">清风明心</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">天下事有难易乎？为之，则难者亦易矣；不为，则易者亦难矣。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/23/Swift开发技巧（一）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/23/Swift开发技巧（一）/" itemprop="url">
                  Swift开发技巧（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-23T11:25:16+08:00">
                2017-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/23/Swift开发技巧（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/23/Swift开发技巧（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/23/Swift开发技巧（一）/" class="leancloud_visitors" data-flag-title="Swift开发技巧（一）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="使用arc4random-、arc4random-uniform-取得随机数"><a href="#使用arc4random-、arc4random-uniform-取得随机数" class="headerlink" title="使用arc4random()、arc4random_uniform()取得随机数"></a>使用arc4random()、arc4random_uniform()取得随机数</h4><p><strong>arc4random() </strong>这个全局函数会生成10位数的随机整数（UInt32）。其生成的最大值是4294967295（2^32 - 1），最小值为0。</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//下面是使用 arc4random 函数求一个 1~100 的随机数（包括1和100）</span></div><div class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>...<span class="number">10</span> &#123;</div><div class="line">            <span class="keyword">let</span> temp = <span class="type">Int</span>(arc4random()%<span class="number">100</span>)+<span class="number">1</span></div><div class="line">            <span class="built_in">print</span>(temp)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line"><span class="comment">//下面是使用 arc4random_uniform 函数求一个 1~100 的随机数（包括1和100）</span></div><div class="line">        <span class="keyword">for</span> <span class="number">_</span> <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">10</span> &#123;</div><div class="line">            <span class="keyword">let</span> temp = <span class="type">Int</span>(arc4random_uniform(<span class="number">100</span>))+<span class="number">1</span></div><div class="line">            <span class="built_in">print</span>(temp)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/01/23/Swift开发技巧（一）/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/23/Swift3学习笔记（七）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/23/Swift3学习笔记（七）/" itemprop="url">
                  Swift3学习笔记（七）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-23T09:04:41+08:00">
                2017-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/23/Swift3学习笔记（七）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/23/Swift3学习笔记（七）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/23/Swift3学习笔记（七）/" class="leancloud_visitors" data-flag-title="Swift3学习笔记（七）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="用-Swift-运行时获取对象属性列表"><a href="#用-Swift-运行时获取对象属性列表" class="headerlink" title="用 Swift 运行时获取对象属性列表"></a><strong>用 Swift 运行时获取对象属性列表</strong></h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span>?</div><div class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">0</span></div><div class="line">    <span class="keyword">var</span> title: <span class="type">String</span>?</div><div class="line">    </div><div class="line">    <span class="comment">//类方法</span></div><div class="line">    <span class="comment">///目标：[使用运行时]获取当前类所有属性的数组</span></div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">func</span> <span class="title">propertyList</span>() -&gt; [<span class="title">String</span>] </span>&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">var</span> <span class="built_in">count</span>: <span class="type">UInt32</span> = <span class="number">0</span></div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//1.获取“类”的属性列表，返回属性列表的数组。可选项</span></div><div class="line">        <span class="comment">//其中的UnsafeMutablePointer是可变的UInt32类型的指针</span></div><div class="line">        <span class="keyword">let</span> list = class_copyPropertyList(<span class="keyword">self</span>, &amp;<span class="built_in">count</span>)</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(<span class="string">"属性的数量<span class="subst">\(<span class="built_in">count</span>)</span>"</span>);</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//2.遍历数组</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="type">Int</span>(<span class="built_in">count</span>) &#123;</div><div class="line">            <span class="comment">//3.根据下标获取属性</span></div><div class="line">            <span class="keyword">let</span> pty = list?[i]</div><div class="line">            </div><div class="line">            <span class="comment">//4.获取属性的名称 C 语言字符串</span></div><div class="line">            <span class="comment">//Int8 -&gt; byte -&gt; char -&gt; C语言的字符串</span></div><div class="line">            <span class="keyword">let</span> cName = property_getName(pty!)</div><div class="line">            </div><div class="line">            <span class="comment">//5.转成OC（String）的字符串</span></div><div class="line">            <span class="keyword">let</span> name = <span class="type">String</span>(utf8String: cName!)</div><div class="line">            </div><div class="line">            <span class="built_in">print</span>(name)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//释放C语言对象</span></div><div class="line">        free(list)</div><div class="line">        </div><div class="line">        <span class="comment">//返回一个空数组，而不是nil</span></div><div class="line">        <span class="keyword">return</span> []</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/01/23/Swift3学习笔记（七）/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/21/Swift3学习笔记（六）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/21/Swift3学习笔记（六）/" itemprop="url">
                  Swift3学习笔记（六）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-21T16:39:09+08:00">
                2017-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/21/Swift3学习笔记（六）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/21/Swift3学习笔记（六）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/21/Swift3学习笔记（六）/" class="leancloud_visitors" data-flag-title="Swift3学习笔记（六）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="必选属性的构造过程"><a href="#必选属性的构造过程" class="headerlink" title="必选属性的构造过程"></a>必选属性的构造过程</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> 1.给自己的属性分配空间并且设置初始值</div><div class="line"> 2.调用父类的构造方法之前，先给本类的属性设置初始值</div><div class="line"> 3.调用父类的“构造函数”，给父类的属性分配空间设置初始值</div><div class="line"> NSObject 没有属性，只有一个成员变量'isa'</div><div class="line"> */</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//1. Class 'Person' has no initializers</span></div><div class="line"><span class="comment">//Person类没有“初始化器”s，构造函数。可以有多个，默认的是init</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span></div><div class="line">    <span class="comment">//2.Overriding declaration requires an 'override' keyword</span></div><div class="line">    <span class="comment">//如果重写一个方法的话，如果父类有这个方法，子类需要重写的话就必须加上override</span></div><div class="line">    <span class="comment">//3.Property 'self.name' not initialized at implicitly generated super.init call</span></div><div class="line">    <span class="comment">//implicitly(隐式生成 super.init),调用父类的构造函数之前,属性self.name没有被初始化</span></div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line"></div><div class="line">        <span class="comment">//必须加载super.init()之前</span></div><div class="line">        name = <span class="string">""</span></div><div class="line">        </div><div class="line">        <span class="comment">//4. Property 'self.name' not initialized at super.init call</span></div><div class="line">        <span class="comment">//这里的提示是给self.name初始化，分配内存空间，设置初始值</span></div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line"> </div><div class="line">    &#125;    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ViewController.swift</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> 在Swift中，默认同一个项目中（同一个命名空间下），所有的类都是共享的，可以直接访问到，不需要import</div><div class="line"> 所有的对象属性 var，也可以直接访问到</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="comment">//实例化Person类</span></div><div class="line">        <span class="comment">//() -&gt; alloc/init</span></div><div class="line">        <span class="comment">//swift中对应一个函数 init构造函数</span></div><div class="line">        <span class="comment">//给成员变量分配空间，初始化成员变量</span></div><div class="line">        <span class="keyword">let</span> p = <span class="type">Person</span>()</div><div class="line">        <span class="built_in">print</span>(p.name)</div><div class="line">        p.name = <span class="string">"xu"</span></div><div class="line">        <span class="built_in">print</span>(p.name)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注：如果是子类的构造方法，他的是执行顺序是：</strong></p>
<ul>
<li>先执行子类的构造方法，再执行父类的构造方</li>
</ul>
<h4 id="重载构造方法"><a href="#重载构造方法" class="headerlink" title="重载构造方法"></a>重载构造方法</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"><span class="comment">/**</span></div><div class="line"> 如果重载了构造函数，并且没有实现父类 init方法，系统不再提供init() 构造方法（默认是会有的）</div><div class="line"> - 因为默认的构造函数，不能给本类的属性分配空间!</div><div class="line">*/</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span></div><div class="line">    </div><div class="line">    <span class="comment">//重写：父类有这个方法</span></div><div class="line">    <span class="keyword">override</span> <span class="keyword">init</span>() &#123;</div><div class="line"></div><div class="line">        <span class="comment">//问题：name 确实有初始值，但是所有的初始值都是Feyddy</span></div><div class="line">        name = <span class="string">"Feyddy"</span></div><div class="line">        </div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//重载，函数名相同，但是参数的个数不同</span></div><div class="line">    <span class="comment">//重载可以给自己的属性从外部设置初始值</span></div><div class="line">    <span class="keyword">init</span>(name: <span class="type">String</span>) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//使用参数的name设置成属性</span></div><div class="line">        <span class="keyword">self</span>.name = name</div><div class="line">        </div><div class="line">        <span class="comment">//调用父类的构造函数</span></div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在ViewController里面创建对象的时候就会有两种方法</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> p = <span class="type">Person</span>(name: <span class="string">"xuzongli"</span>)</div><div class="line"><span class="keyword">let</span> p2 = <span class="type">Person</span>()</div></pre></td></tr></table></figure>
<p>但是如果除去“重写：父类有这个方法“那就只会剩下重载的那个方法</p>
<h4 id="KVC函数调用的基本实现及KVC构造函数中基本数据类型和私有属性"><a href="#KVC函数调用的基本实现及KVC构造函数中基本数据类型和私有属性" class="headerlink" title="KVC函数调用的基本实现及KVC构造函数中基本数据类型和私有属性"></a>KVC函数调用的基本实现及KVC构造函数中基本数据类型和私有属性</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"><span class="comment">/**</span></div><div class="line"> 1.在定义模型的时候，如果是对象，通常都是可选的</div><div class="line">  -在需要的时候创建</div><div class="line">  -避免写构造函数，可以简化代码</div><div class="line"> 2.如果是基本数据类型，不能设置成可选的，而且要设置初始值，否则KVC会奔溃</div><div class="line"> 3.如果需要使用KVC设置数据，属性不能是private</div><div class="line"> 4.在使用KVC方法之前应该调用super.init()，保证对象实例化完成</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>: <span class="title">NSObject</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">//name 属性是可选的，在OC中很多的属性都是在需要的时候创建的</span></div><div class="line">    <span class="comment">//例如。vc.view / tableViewCell.textLabel / detailLabel / imageView</span></div><div class="line">    <span class="comment">//因为手机在开发，内存很宝贵，有些属性并不是一定需要分配空间的</span></div><div class="line">    <span class="comment">//延迟加载，在需要的时候在创建</span></div><div class="line">    </div><div class="line">    <span class="keyword">var</span> name: <span class="type">String</span>?</div><div class="line">    </div><div class="line">    <span class="comment">//给基本数据类型属性初始化</span></div><div class="line">    <span class="comment">// - 使用KVC会提示无法找到age 的Key</span></div><div class="line">    <span class="comment">// - 原因：Int是一个基本数据类型的结构体，OC中没有，OC中只有基本数据类型</span></div><div class="line">    <span class="comment">//var age: Int?</span></div><div class="line">    <span class="keyword">var</span> age: <span class="type">Int</span> = <span class="number">0</span></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//如果是private属性，使用KVC设置的时候，同样无法设置</span></div><div class="line">    <span class="comment">//如果是private属性，是禁止外部访问的</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">var</span> title: <span class="type">String</span>?</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">//重载构造函数，使用字典为本类设置初始值</span></div><div class="line">    <span class="keyword">init</span>(dict: [<span class="type">String</span>: <span class="type">AnyObject</span>]) &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//保障对象完全初始化完成(一定)</span></div><div class="line">        <span class="keyword">super</span>.<span class="keyword">init</span>()</div><div class="line">        </div><div class="line">        <span class="comment">//Use of 'self' in method call 'setValuesForKeys' before super.init initializes self</span></div><div class="line">        <span class="comment">//使用self 的方法“setValueForKeys”之前，应该调用 super.init</span></div><div class="line">        <span class="comment">//KVC的方法是OC的方法，在运行时给对象发送消息，要求对象已经实例化完成</span></div><div class="line">        setValuesForKeys(dict)</div><div class="line">        </div><div class="line">        <span class="comment">//super.init()如果放在这个时候调用，对象还没有初始化完成</span></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//重写父类的方法</span></div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">setValue</span><span class="params">(<span class="number">_</span> value: Any?, forUndefinedKey key: String)</span></span> &#123;</div><div class="line">        <span class="comment">//没有调用 super，将父类的代码实现完全覆盖！不会奔溃！</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="子类构造函数的继承"><a href="#子类构造函数的继承" class="headerlink" title="子类构造函数的继承"></a>子类构造函数的继承</h4><p>我们继承上面的类</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>: <span class="title">Person</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">var</span> no: <span class="type">String</span>?</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在主控制器中实现初始化</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> s = <span class="type">Student</span>(dict: [<span class="string">"name"</span>:<span class="string">"wang"</span> <span class="keyword">as</span> <span class="type">AnyObject</span>,<span class="string">"age"</span>:<span class="number">10</span> <span class="keyword">as</span> <span class="type">AnyObject</span>,<span class="string">"no"</span>:<span class="string">"100"</span> <span class="keyword">as</span> <span class="type">AnyObject</span>,<span class="string">"xxx"</span>:<span class="string">"feyddy"</span> <span class="keyword">as</span> <span class="type">AnyObject</span>])</div><div class="line">        <span class="built_in">print</span>(s.no)</div><div class="line"><span class="comment">//可以看出我们可以直接通过父类的KVC方法在子类的使用</span></div><div class="line"><span class="comment">//如果我们想在初始化的时候添加上一个不存在的属性"xxx",这个时候就要在KVC构造方法的时候重写setValue(_ value: Any?, forUndefinedKey key: String)看上面的代码</span></div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/21/Swift3学习笔记（五）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/21/Swift3学习笔记（五）/" itemprop="url">
                  Swift3学习笔记（五）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-21T08:18:59+08:00">
                2017-01-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/21/Swift3学习笔记（五）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/21/Swift3学习笔记（五）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/21/Swift3学习笔记（五）/" class="leancloud_visitors" data-flag-title="Swift3学习笔记（五）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="使用Swift实现循环引用"><a href="#使用Swift实现循环引用" class="headerlink" title="使用Swift实现循环引用"></a>使用Swift实现循环引用</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">//定义属性</span></div><div class="line">    <span class="keyword">var</span> completionCallBack: (()-&gt;())?</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="comment">// block 中如果出现self 要特别小心</span></div><div class="line">        <span class="comment">//- 只是闭包对 self 进行了copy,闭包执行完成之后，会自动销毁，同时释放对self的引用</span></div><div class="line">        <span class="comment">//- 同时需要self对闭包引用</span></div><div class="line">        loadData &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="keyword">self</span>.view)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadData</span><span class="params">(completion: @escaping <span class="params">()</span></span></span>-&gt;()) -&gt; () &#123;</div><div class="line">        <span class="comment">//使用属性记录闭包-&gt;self对闭包引用.这个时候deinit不会运行，因为出现了循环引用</span></div><div class="line">        completionCallBack = completion</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//异步</span></div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123; </div><div class="line">            <span class="built_in">print</span>(<span class="string">"耗时操作"</span>)</div><div class="line">            </div><div class="line">            <span class="comment">//尾随闭包</span></div><div class="line">            <span class="type">DispatchQueue</span>.main.async &#123;</div><div class="line">                <span class="comment">//回调执行闭包</span></div><div class="line">                completion()</div><div class="line">                </div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//类似于OC中的dealloc</span></div><div class="line">    <span class="comment">//没有func -&gt; 不让调用</span></div><div class="line">    <span class="comment">//没有() -&gt; 不让重载</span></div><div class="line">    <span class="comment">//在对象被销毁前自动调用</span></div><div class="line">    <span class="keyword">deinit</span> &#123;</div><div class="line">    	<span class="comment">//1.跟踪对象的销毁</span></div><div class="line">    	<span class="comment">//2.必须释放</span></div><div class="line">    		<span class="comment">/**</span></div><div class="line">    			- 通知，不释放不会奔溃，但是会泄露</div><div class="line">    			- KVO，不释放会奔溃</div><div class="line">    			- NSTimer / CADisplayLink ,不销毁会出现循环应用</div><div class="line">    		*/</div><div class="line">    		</div><div class="line">        <span class="built_in">print</span>(<span class="string">"没有循环引用"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="解除循环引用"><a href="#解除循环引用" class="headerlink" title="解除循环引用"></a>解除循环引用</h4><p>还是拿上面的代码进行解决</p>
<ul>
<li><p>OC方式解决循环引用</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//***解除循环引用，需要打断链条</span></div><div class="line">        <span class="comment">//细节1：var ：weak只能修饰var，不能修饰let</span></div><div class="line">        <span class="comment">//‘weak’ must be a mutable variable,because it may change at runtime</span></div><div class="line">        <span class="comment">//weak 可能会在运行时被修改-&gt;指向对象一旦被释放掉，会被自动设置为nil</span></div><div class="line">        <span class="comment">//ViewController?</span></div><div class="line">        </div><div class="line">        <span class="keyword">weak</span> <span class="keyword">var</span> weakSelf = <span class="keyword">self</span></div><div class="line">        loadData &#123;</div><div class="line">            </div><div class="line">            <span class="comment">//细节2：</span></div><div class="line">            <span class="comment">//解包的方式有两种</span></div><div class="line">            <span class="comment">//？可选解包 - 如果 self 已经被释放，不会对对象发送 getter 消息，更加安全</span></div><div class="line">            <span class="comment">//！强行解包 - 如果 self 已经被释放，强行解包会导致奔溃</span></div><div class="line">            </div><div class="line">            <span class="comment">/**</span></div><div class="line">             weakSelf?.view  -  只是单纯的发送消息，没有任的计算</div><div class="line">             强行解包，因为需要计算，可选项不能直接参与计算</div><div class="line">            */</div><div class="line">            </div><div class="line">            <span class="built_in">print</span>(weakSelf?.view)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Swift解决循环引用</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Swift推荐方法</span></div><div class="line">        <span class="comment">//[weak self] 表示&#123;&#125;里面的self都是弱引用，需要注意解包</span></div><div class="line">        loadData &#123;</div><div class="line">            [<span class="keyword">weak</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(<span class="keyword">self</span>?.view)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//Swift另外的用法，不推荐。不安全</span></div><div class="line">        <span class="comment">//[unowned self]表示&#123;&#125;中的所有的self都是assgin的，不会强引用，但是，如果对象释放，指针地址不会变化</span></div><div class="line">        <span class="comment">//如果对象被释放，继续调用，就会出现野指针的问题</span></div><div class="line">        loadData &#123;</div><div class="line">            [<span class="keyword">unowned</span> <span class="keyword">self</span>] <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(<span class="keyword">self</span>.view)</div><div class="line">        &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>OC代码中解决循环引用的两种方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">#import &quot;FDViewController.h&quot;</div><div class="line"></div><div class="line">@interface FDViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation FDViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view.</div><div class="line">    </div><div class="line">    /*</div><div class="line">    //解除引用1：__weak</div><div class="line">    __weak typeof(self) weakSelf = self;</div><div class="line">    </div><div class="line">    [self loadData:^&#123;</div><div class="line">        NSLog(@&quot;%@&quot;,weakSelf.view);</div><div class="line">    &#125;];</div><div class="line">    */</div><div class="line">    </div><div class="line">    //解除引用2:__unsafe_unretained</div><div class="line">    //如果需要自行管理内存，才使用</div><div class="line">    //EXC_BAD_ACCESS 坏内存访问，野指针访问</div><div class="line">    //__unsafe_unretained同样是 assign的引用（MRC中没有weak）</div><div class="line">    //在MRC中如果要弱引用对象都是使用assign，不会增加引用计数，但是一旦对象被释放，地址不会改变，继续访问，出现野指针</div><div class="line">    //ARC weak ,本质上是一个官缠着模式，一旦发现对象被释放，会自动将地址设置为nil，更加安全</div><div class="line">    </div><div class="line">    </div><div class="line">    //效率：weak的效率会略微差一些</div><div class="line">    __unsafe_unretained typeof(self) weakSelf = self;</div><div class="line">    [self loadData:^&#123;</div><div class="line">        NSLog(@&quot;%@&quot;,weakSelf.view);</div><div class="line"></div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)loadData:(void(^)()) completion &#123;</div><div class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        NSLog(@&quot;耗时操作 %@&quot;,[NSThread currentThread]);</div><div class="line">        </div><div class="line">        //睡眠</div><div class="line">        [NSThread sleepForTimeInterval:2.0];</div><div class="line">        </div><div class="line">        dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line">            //执行block</div><div class="line">            </div><div class="line">            completion();</div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>​</p>
<p>​</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/19/Swift3学习笔记（四）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/19/Swift3学习笔记（四）/" itemprop="url">
                  Swift3学习笔记（四）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-19T18:18:04+08:00">
                2017-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/19/Swift3学习笔记（四）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/19/Swift3学习笔记（四）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/19/Swift3学习笔记（四）/" class="leancloud_visitors" data-flag-title="Swift3学习笔记（四）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="闭包的定义格式"><a href="#闭包的定义格式" class="headerlink" title="闭包的定义格式"></a>闭包的定义格式</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     闭包</div><div class="line">     1.提前准备好的代码</div><div class="line">     2.在需要的时候执行</div><div class="line">     3.可以当做参数</div><div class="line">     */</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        <span class="comment">//1&gt;最简单的闭包</span></div><div class="line">        <span class="comment">//() -&gt; ()没有参数，没有返回值的函数</span></div><div class="line">        <span class="comment">//如果没有参数，没有返回值，可以省略，连in都一起省略</span></div><div class="line">        <span class="keyword">let</span> b1 = &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"hello"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//执行闭包</span></div><div class="line">        b1();</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//2&gt;带参数的闭包</span></div><div class="line">        <span class="comment">//闭包中的参数，返回值，实现代码都是写在花括号里面</span></div><div class="line">        <span class="comment">//需要使用一个关键字`in`用来分隔定义和实现</span></div><div class="line">        <span class="comment">//&#123;形参列表 -&gt; 返回值类型 `in` //实现代码&#125;</span></div><div class="line">        <span class="keyword">let</span> b2 = &#123;(x: <span class="type">Int</span>)-&gt;() <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(x)</div><div class="line">        &#125;</div><div class="line">        b2(<span class="number">100</span>)</div><div class="line">        </div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//3&gt;带参数返回值的闭包</span></div><div class="line">        <span class="comment">//(Int)-&gt;(Int)</span></div><div class="line">        <span class="keyword">let</span> b3 = &#123;(x: <span class="type">Int</span>) -&gt; <span class="type">Int</span> <span class="keyword">in</span></div><div class="line">            <span class="keyword">return</span> x + <span class="number">10</span></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(b3(<span class="number">100</span>))</div><div class="line">  </div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="GCD"><a href="#GCD" class="headerlink" title="GCD"></a>GCD</h4><p>将任务添加到队列，指定执行任务的函数，即，队列调度任务（block/闭包），以同步或者异步的方式执行</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//在异步执行任务，获取结果，通过block/闭包回调</span></div><div class="line"><span class="comment">//闭包的应用场景和block完全一致</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">loadData</span><span class="params">()</span></span>  &#123;</div><div class="line">        <span class="comment">//将任务添加到队列，指定执行任务的函数，即，队列调度任务（block/闭包），以同步或者异步的方式执行</span></div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"耗时操作<span class="subst">\(Thread.current)</span>"</span>)</div><div class="line">            </div><div class="line">            <span class="comment">//休眠</span></div><div class="line">            <span class="type">Threa</span></div><div class="line">            </div><div class="line">            <span class="comment">//主队列回调</span></div><div class="line">            <span class="type">DispatchQueue</span>.main.async(execute: &#123; </div><div class="line">                <span class="built_in">print</span>(<span class="string">"主线程更新 UI<span class="subst">\(Thread.current)</span>"</span>)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="通过闭包回调传递参数"><a href="#通过闭包回调传递参数" class="headerlink" title="通过闭包回调传递参数"></a>通过闭包回调传递参数</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">      </div><div class="line">        loadData &#123; (result) <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(<span class="string">"获取数据<span class="subst">\(result)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">  </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//@escaping逃逸闭包，即该闭包实在函数执行完成后才开始执行</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadData</span><span class="params">(completion: @escaping <span class="params">(<span class="number">_</span> result: [String])</span></span></span>-&gt;()) -&gt; ()  &#123;</div><div class="line">        <span class="comment">//将任务添加到队列，指定执行任务的函数，即，队列调度任务（block/闭包），以同步或者异步的方式执行</span></div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"耗时操作<span class="subst">\(Thread.current)</span>"</span>)</div><div class="line">            </div><div class="line">            <span class="comment">//休眠</span></div><div class="line">            <span class="type">Thread</span>.sleep(forTimeInterval: <span class="number">1.0</span>)</div><div class="line">            </div><div class="line">            <span class="comment">//获取结果</span></div><div class="line">            <span class="keyword">let</span> json = [<span class="string">"头条"</span>,<span class="string">"八卦"</span>,<span class="string">"娱乐"</span>]</div><div class="line">            </div><div class="line">            <span class="comment">//主队列回调</span></div><div class="line">            <span class="type">DispatchQueue</span>.main.async(execute:&#123;</div><div class="line">                <span class="built_in">print</span>(<span class="string">"主线程更新 UI<span class="subst">\(Thread.current)</span>"</span>)</div><div class="line">                </div><div class="line">                <span class="comment">//回调 -&gt; 执行闭包（通过参数传递）</span></div><div class="line"></div><div class="line">                <span class="comment">//传递异步获取的结果</span></div><div class="line">            </div><div class="line">                completion(json)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="尾随闭包"><a href="#尾随闭包" class="headerlink" title="尾随闭包"></a>尾随闭包</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">     </div><div class="line">        <span class="comment">//尾随闭包</span></div><div class="line">        <span class="comment">//如果函数的最后一个参数是闭包，函数参数可以提前结束，最后一个参数直接使用&#123;&#125;包装闭包的代码</span></div><div class="line">        <span class="comment">//</span></div><div class="line"><span class="comment">//        loadData(completion: (result: [String]) -&gt; ())</span></div><div class="line"><span class="comment">//        loadData &#123; (result) in</span></div><div class="line"><span class="comment">//            print(result)</span></div><div class="line"><span class="comment">//        &#125;</span></div><div class="line">        </div><div class="line">        <span class="comment">//按照函数本身编写的结果</span></div><div class="line">        loadData(completion: &#123;(result) -&gt; () <span class="keyword">in</span></div><div class="line">            <span class="built_in">print</span>(result)</div><div class="line">        &#125;)</div><div class="line">  </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">demo</span><span class="params">()</span></span> -&gt; () &#123;</div><div class="line">        <span class="comment">//尾随闭包</span></div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123; </div><div class="line">            </div><div class="line">            <span class="comment">//嵌套的GCD Xcode不会改成尾随闭包</span></div><div class="line">            <span class="type">DispatchQueue</span>.main.async(execute: &#123; </div><div class="line">                </div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//尾随闭包</span></div><div class="line">        <span class="type">DispatchQueue</span>.main.async &#123; </div><div class="line">            </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">//@escaping逃逸闭包，即该闭包实在函数执行完成后才开始执行</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">loadData</span><span class="params">(completion: @escaping <span class="params">(<span class="number">_</span> result: [String])</span></span></span>-&gt;()) -&gt; ()  &#123;</div><div class="line">        <span class="comment">//将任务添加到队列，指定执行任务的函数，即，队列调度任务（block/闭包），以同步或者异步的方式执行</span></div><div class="line">        <span class="type">DispatchQueue</span>.global().async &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"耗时操作<span class="subst">\(Thread.current)</span>"</span>)</div><div class="line">            </div><div class="line">            <span class="comment">//休眠</span></div><div class="line">            <span class="type">Thread</span>.sleep(forTimeInterval: <span class="number">1.0</span>)</div><div class="line">            </div><div class="line">            <span class="comment">//获取结果</span></div><div class="line">            <span class="keyword">let</span> json = [<span class="string">"头条"</span>,<span class="string">"八卦"</span>,<span class="string">"娱乐"</span>]</div><div class="line">            </div><div class="line">            <span class="comment">//主队列回调</span></div><div class="line">            <span class="type">DispatchQueue</span>.main.async(execute:&#123;</div><div class="line">                <span class="built_in">print</span>(<span class="string">"主线程更新 UI<span class="subst">\(Thread.current)</span>"</span>)</div><div class="line">                </div><div class="line">                <span class="comment">//回调 -&gt; 执行闭包（通过参数传递）</span></div><div class="line"></div><div class="line">                <span class="comment">//传递异步获取的结果</span></div><div class="line">            </div><div class="line">                completion(json)</div><div class="line">            &#125;)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="OC-的一个坑（作用于）"><a href="#OC-的一个坑（作用于）" class="headerlink" title="OC{}的一个坑（作用于）"></a>OC{}的一个坑（作用于）</h4><p>下面是错误的例子：</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> l = <span class="type">UILabel</span>()</div><div class="line"><span class="comment">//(1)参数结束&#123;尾随闭包&#125;</span></div><div class="line">view.addSubView(l)</div><div class="line"></div><div class="line"><span class="comment">//Extra argument in call</span></div><div class="line"><span class="comment">//调用了·额外·的参数</span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">let</span> l = <span class="type">UILabel</span>()</div><div class="line">	view.addSubView(l)</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/19/Swift3学习笔记（三）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/19/Swift3学习笔记（三）/" itemprop="url">
                  Swift3学习笔记（三）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-19T18:16:30+08:00">
                2017-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/19/Swift3学习笔记（三）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/19/Swift3学习笔记（三）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/19/Swift3学习笔记（三）/" class="leancloud_visitors" data-flag-title="Swift3学习笔记（三）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="函数的基本使用"><a href="#函数的基本使用" class="headerlink" title="函数的基本使用"></a>函数的基本使用</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> UIKit</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ViewController</span>: <span class="title">UIViewController</span> </span>&#123;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">func</span> <span class="title">viewDidLoad</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">super</span>.viewDidLoad()</div><div class="line">        </div><div class="line">        <span class="comment">//调用方法</span></div><div class="line">        <span class="built_in">print</span>(sum(x: <span class="number">10</span>, y: <span class="number">40</span>))</div><div class="line">        </div><div class="line">        <span class="comment">//外部参数的调用</span></div><div class="line">        <span class="built_in">print</span>(sum1(num1: <span class="number">10</span>, num2: <span class="number">100</span>))</div><div class="line">        <span class="built_in">print</span>(sum2(<span class="number">10</span>, <span class="number">20</span>))</div><div class="line">        </div><div class="line">        <span class="comment">//测试默认值</span></div><div class="line">        <span class="built_in">print</span>(defaultValue())</div><div class="line">        <span class="built_in">print</span>(defaultValue(x: <span class="number">10</span>, y: <span class="number">20</span>))</div><div class="line">        <span class="built_in">print</span>(defaultValue(y: <span class="number">20</span>))</div><div class="line">        <span class="built_in">print</span>(defaultValue(x: <span class="number">10</span>))</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//无返回值</span></div><div class="line">        noReturn1()</div><div class="line">        noReturn2()</div><div class="line">        noReturn3()</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line"></div><div class="line">    <span class="comment">// MARK: - 函数定义</span></div><div class="line">    <span class="comment">/// 函数定义的格式：函数名(形参列表) -&gt; 返回值类型</span></div><div class="line">    <span class="comment">///</span></div><div class="line">    <span class="comment">/// - Parameters:</span></div><div class="line">    <span class="comment">///   - x: 形参1</span></div><div class="line">    <span class="comment">///   - y: 形参2</span></div><div class="line">    <span class="comment">/// - Returns: 返回值</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sum</span><span class="params">(x: Int , y: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">return</span> x + y</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// MARK: - 外部参数</span></div><div class="line">    <span class="comment">/// -外部参数就是在函数前面加上一个名字</span></div><div class="line">    <span class="comment">/// -外部参数不会影响函数内部的细节</span></div><div class="line">    <span class="comment">/// -外部参数会让外部调用方法的时候更加直观</span></div><div class="line">    <span class="comment">/// -外部参数如果使用_，在外部调用函数时，会忽略形参的名字</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sum2</span><span class="params">(<span class="number">_</span> x: Int,<span class="number">_</span> y: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//在Swift中 _ 就是可以忽略任意不感兴趣的内容</span></div><div class="line">        <span class="comment">//从来没有被用到的数据可以用_来替代,如下面的i</span></div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">10</span> &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"hello"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">return</span> x+y</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">sum1</span><span class="params">(num1 x: Int, num2 y: Int)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">return</span> x+y</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// MARK: - 默认值</span></div><div class="line">    <span class="comment">//通过给参数设置默认值，在调用的时候，可以任意组合参数，然后没有赋值的参数就是用默认的函数中定义的值</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">defaultValue</span><span class="params">(x: Int = <span class="number">1</span>,y: Int = <span class="number">11</span>)</span></span> -&gt; <span class="type">Int</span> &#123;</div><div class="line">        <span class="keyword">return</span> x+y</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line">    </div><div class="line">    <span class="comment">// MARK: - 无返回值</span></div><div class="line">    <span class="comment">/*</span></div><div class="line">     主要用在闭包</div><div class="line">     - 直接省略</div><div class="line">     - （）</div><div class="line">     - void</div><div class="line">     */</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">noReturn1</span><span class="params">()</span></span> -&gt; <span class="type">Void</span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Void"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">noReturn2</span><span class="params">()</span></span> -&gt; () &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"()"</span>)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">noReturn3</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="built_in">print</span>(<span class="string">"省略"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/19/Swift3-0学习笔记（二）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/19/Swift3-0学习笔记（二）/" itemprop="url">
                  Swift3.0学习笔记（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-19T11:34:23+08:00">
                2017-01-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/19/Swift3-0学习笔记（二）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/19/Swift3-0学习笔记（二）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/19/Swift3-0学习笔记（二）/" class="leancloud_visitors" data-flag-title="Swift3.0学习笔记（二）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">arrayDemo</span><span class="params">()</span></span>  &#123;</div><div class="line">        <span class="comment">//[Int]-&gt;表示存放的都是Int类型的数据</span></div><div class="line">        <span class="comment">//Swift中基本数据类型不需要包装</span></div><div class="line">        <span class="keyword">let</span> array1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</div><div class="line">        <span class="built_in">print</span>(array1)</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//结构体:不需要包装</span></div><div class="line">        <span class="keyword">let</span> p = <span class="type">CGPoint</span>(x: <span class="number">10</span>, y: <span class="number">20</span>)</div><div class="line">        <span class="comment">//[CGPoint]</span></div><div class="line">        <span class="keyword">let</span> array2 = [p];</div><div class="line">        <span class="built_in">print</span>(array2)</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//混合数组：开发中几乎不用，因为数组是靠下标索引</span></div><div class="line">        <span class="comment">//如果数组中的类型不一致，自动推导的结果就是NSObject</span></div><div class="line">        <span class="comment">//Swfit 中还有一个[AnyObject] - &gt; 任意对象</span></div><div class="line">        <span class="comment">//Swift中一个类可以没有任何“父类”</span></div><div class="line">        <span class="comment">//AnyObject范围大于NSObject</span></div><div class="line">        </div><div class="line">        <span class="comment">/**在混合数组中CG结构体需要包装*/</span></div><div class="line">        <span class="comment">//let array3 = ["Feyddy",1,p]//报错：需要包装</span></div><div class="line">        <span class="comment">//现在必须要在后面加上 as [Any]（这个在Swift3.0的时候还不需要的）</span></div><div class="line">        <span class="keyword">let</span> array3 = [<span class="string">"Feyddy"</span>,<span class="number">1</span>,<span class="type">NSValue</span>(cgPoint: p)] <span class="keyword">as</span> [<span class="type">Any</span>]</div><div class="line">        <span class="built_in">print</span>(array3)</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="数组的遍历"><a href="#数组的遍历" class="headerlink" title="数组的遍历"></a>数组的遍历</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//遍历数组</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">arrayTraverse</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> array = [<span class="string">"feyddy"</span>,<span class="string">"crise"</span>,<span class="string">"dirk"</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//1.按照下标遍历</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------按照下标遍历--------"</span>)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;array.<span class="built_in">count</span> &#123;</div><div class="line">            <span class="built_in">print</span>(array[i])</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//2.遍历元素</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------遍历元素--------"</span>)</div><div class="line">        <span class="keyword">for</span> s <span class="keyword">in</span> array &#123;</div><div class="line">            <span class="built_in">print</span>(s)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//3.enum block 遍历，同时遍历下标和内容1</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------同时遍历下标和内容1--------"</span>)</div><div class="line">        <span class="keyword">for</span> e <span class="keyword">in</span> array.enumerated() &#123;</div><div class="line">            <span class="comment">//元组</span></div><div class="line">            <span class="built_in">print</span>(e)</div><div class="line">            </div><div class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(e.offset)</span>,<span class="subst">\(e.element)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//4.同时遍历下标和内容2</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------同时遍历下标和内容2--------"</span>)</div><div class="line">        <span class="comment">//n为下标，s为数组的元素，这两个可以随便写</span></div><div class="line">        <span class="keyword">for</span> (n,s) <span class="keyword">in</span> array.enumerated() &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(n)</span>,<span class="subst">\(s)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">//5.反序遍历</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------反序遍历--------"</span>)</div><div class="line">        <span class="keyword">for</span> e <span class="keyword">in</span> array.reversed() &#123;</div><div class="line">            <span class="built_in">print</span>(e)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//6.反序遍历索引和内容</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------反序遍历索引和内容--------"</span>)</div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------错误的反序遍历索引和内容--------"</span>)</div><div class="line">        <span class="keyword">for</span> (n,s) <span class="keyword">in</span> array.reversed().enumerated() &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(n)</span>:<span class="subst">\(s)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(<span class="string">"--------正确的的反序遍历索引和内容--------"</span>)</div><div class="line">        <span class="keyword">for</span> (n,s) <span class="keyword">in</span> array.enumerated().reversed() &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(n)</span>:<span class="subst">\(s)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="数组的增删改和容量"><a href="#数组的增删改和容量" class="headerlink" title="数组的增删改和容量"></a>数组的增删改和容量</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//增删改</span></div><div class="line">   <span class="function"><span class="keyword">func</span> <span class="title">arrayOperation</span><span class="params">()</span></span> &#123;</div><div class="line">       </div><div class="line">       <span class="comment">//可变数组用var</span></div><div class="line">       <span class="keyword">var</span> array = [<span class="string">"feyddy"</span>,<span class="string">"crise"</span>,<span class="string">"dirk"</span>];</div><div class="line">       </div><div class="line">       <span class="comment">//追加元素</span></div><div class="line">       array.append(<span class="string">"dog"</span>)</div><div class="line">       <span class="built_in">print</span>(array)</div><div class="line">       </div><div class="line">       </div><div class="line">       <span class="comment">//修改,通过下标定位</span></div><div class="line">       array[<span class="number">1</span>] = <span class="string">"wang"</span></div><div class="line">       <span class="built_in">print</span>(array)</div><div class="line">       </div><div class="line">       <span class="comment">//数组越界：Index out of range</span></div><div class="line">       <span class="comment">//array[4] = "xxx"</span></div><div class="line"></div><div class="line">       </div><div class="line">       <span class="comment">//删除</span></div><div class="line">       array.remove(at: <span class="number">3</span>)</div><div class="line">       <span class="built_in">print</span>(array)</div><div class="line">       </div><div class="line">       </div><div class="line">       <span class="comment">//删除全部，并且保留空间</span></div><div class="line">       array.removeAll(keepingCapacity: <span class="literal">true</span>)</div><div class="line">       <span class="built_in">print</span>(<span class="string">"<span class="subst">\(array)</span><span class="subst">\(array.capacity)</span>"</span>)</div><div class="line">       </div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//数组的容量</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">arrayCapacity</span><span class="params">()</span></span>  &#123;</div><div class="line">        <span class="comment">//定义一个数组，指定类型存放Int的数组</span></div><div class="line">        <span class="comment">//var array: [Int]</span></div><div class="line">        </div><div class="line">        <span class="comment">//给数组初始化</span></div><div class="line">        <span class="comment">//array = [Int]()</span></div><div class="line">        </div><div class="line">        <span class="comment">//以上两句代码可以合并成一句</span></div><div class="line">        <span class="keyword">var</span> array = [<span class="type">Int</span>]()</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(<span class="string">"初始容量<span class="subst">\(array.capacity)</span>"</span>)</div><div class="line">        </div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">8</span> &#123;</div><div class="line">            array.append(i)<span class="comment">//插入时如果容量不够了，容量就*2</span></div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(<span class="string">"<span class="subst">\(array)</span>容量<span class="subst">\(array.capacity)</span>"</span>)</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="数组的合并"><a href="#数组的合并" class="headerlink" title="数组的合并"></a>数组的合并</h4><p><strong>注意：</strong>要合并数组的两个数组内的元素的类型必须一致</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//数组的合并</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">arrayMerge</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> array = [<span class="string">"feyddy"</span>,<span class="string">"crise"</span>,<span class="string">"dirk"</span>];</div><div class="line">        <span class="keyword">let</span> array2 = [<span class="string">"linlin"</span>,<span class="string">"chenchen"</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//将array2的内容合并到array上</span></div><div class="line">        <span class="comment">//注意：要合并数组的两个数组内的元素的类型必须一致</span></div><div class="line">        array += array2</div><div class="line">        <span class="built_in">print</span>(array)</div><div class="line">        </div><div class="line">        <span class="comment">//如果要合并一个元素不一样数组</span></div><div class="line"><span class="comment">//        var array3: [NSObject] = ["feyddy" as NSObject,"crise" as NSObject,"dirk" as NSObject];</span></div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="字典操作"><a href="#字典操作" class="headerlink" title="字典操作"></a>字典操作</h4><h6 id="字典的定义"><a href="#字典的定义" class="headerlink" title="字典的定义"></a>字典的定义</h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字典的定义</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dictionaryDefine</span><span class="params">()</span></span>  &#123;</div><div class="line">        </div><div class="line">        <span class="comment">//KEY:VALUE   -&gt;  [String:Any]</span></div><div class="line">        <span class="keyword">let</span> dict = [<span class="string">"name"</span>:<span class="string">"Feyddy"</span>,<span class="string">"age"</span>:<span class="number">25</span>] <span class="keyword">as</span> [<span class="type">String</span> : <span class="type">Any</span>];</div><div class="line">        <span class="built_in">print</span>(dict)</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//定义字典数组-提示  这种格式在开发中使用的最多</span></div><div class="line">        <span class="keyword">let</span> array = [</div><div class="line">            [<span class="string">"name"</span>:<span class="string">"Feyddy"</span>,</div><div class="line">            <span class="string">"age"</span>:<span class="number">25</span>,</div><div class="line">            <span class="string">"sex"</span>:<span class="string">"M"</span>],</div><div class="line">            [<span class="string">"name"</span>:<span class="string">"dirk"</span>,</div><div class="line">             <span class="string">"age"</span>:<span class="number">55</span>,</div><div class="line">             <span class="string">"sex"</span>:<span class="string">"M"</span>],</div><div class="line">            [<span class="string">"name"</span>:<span class="string">"Chen"</span>,</div><div class="line">             <span class="string">"age"</span>:<span class="number">18</span>,</div><div class="line">             <span class="string">"sex"</span>:<span class="string">"F"</span>],</div><div class="line">        ]</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(array)</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h6 id="字典的增删改"><a href="#字典的增删改" class="headerlink" title="字典的增删改"></a>字典的增删改</h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字典的增删改</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dictionaryOperation</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="comment">//可变 var / 不可变 let</span></div><div class="line">        <span class="keyword">var</span> dict = [<span class="string">"name"</span>:<span class="string">"Feyddy"</span>,<span class="string">"age"</span>: <span class="number">25</span>] <span class="keyword">as</span> [<span class="type">String</span> : <span class="type">Any</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//新增 - 如果key不存在就是新增</span></div><div class="line">        dict[<span class="string">"sex"</span>] = <span class="string">"M"</span></div><div class="line">        <span class="built_in">print</span>(dict)</div><div class="line">        </div><div class="line">        <span class="comment">//修改--字典中通过key取值的，key是唯一的</span></div><div class="line">        <span class="comment">//key存在就是修改</span></div><div class="line">        dict[<span class="string">"name"</span>] = <span class="string">"linlin"</span></div><div class="line">        <span class="built_in">print</span>(dict)</div><div class="line">        </div><div class="line">        <span class="comment">//删除 - 直接给定KEY</span></div><div class="line">        <span class="comment">//字典通过KEY来定位。KEY必须可以“hash 哈希” MD5一种</span></div><div class="line">        <span class="comment">//hash 就是将字符串变成唯一的“整数”，便于查找，提高字典的遍历速度</span></div><div class="line">        dict.removeValue(forKey: <span class="string">"age"</span>)</div><div class="line">        <span class="built_in">print</span>(dict)</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h6 id="字典的遍历"><a href="#字典的遍历" class="headerlink" title="字典的遍历"></a>字典的遍历</h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字典的遍历</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dictionaryTraverse</span><span class="params">()</span></span>  &#123;</div><div class="line">        <span class="keyword">let</span> dict = [<span class="string">"name"</span>:<span class="string">"Feyddy"</span>,<span class="string">"age"</span>: <span class="number">25</span>,<span class="string">"sex"</span>:<span class="string">"M"</span>] <span class="keyword">as</span> [<span class="type">String</span> : <span class="type">Any</span>];</div><div class="line">        </div><div class="line">        <span class="comment">//元组形式</span></div><div class="line">        <span class="keyword">for</span> e <span class="keyword">in</span> dict &#123;</div><div class="line">            <span class="comment">//(key:value)</span></div><div class="line">            <span class="built_in">print</span>(e)</div><div class="line">            </div><div class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(e.key)</span>:<span class="subst">\(e.value)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">/*</span></div><div class="line">         前面是key</div><div class="line">         后面是value</div><div class="line">         */</div><div class="line">        <span class="keyword">for</span> (key,value) <span class="keyword">in</span> dict &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"<span class="subst">\(key)</span>:<span class="subst">\(value)</span>"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h6 id="字典的合并"><a href="#字典的合并" class="headerlink" title="字典的合并"></a>字典的合并</h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字典的合并</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">dictionaryMerge</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">var</span> dict = [<span class="string">"name"</span>:<span class="string">"Feyddy"</span>,<span class="string">"age"</span>: <span class="number">25</span>,<span class="string">"sex"</span>:<span class="string">"M"</span>] <span class="keyword">as</span> [<span class="type">String</span> : <span class="type">Any</span>];</div><div class="line">        </div><div class="line">        <span class="keyword">let</span> dict1 = [<span class="string">"title"</span>:<span class="string">"info"</span>]</div><div class="line">        </div><div class="line">        <span class="comment">//字典不能直接相加</span></div><div class="line">        <span class="comment">//遍历dict1 依次设置</span></div><div class="line">        <span class="comment">//如果key存在，直接修改，若不存在，直接添加</span></div><div class="line">        <span class="comment">//添加的地方时无序的</span></div><div class="line">        <span class="keyword">for</span> e <span class="keyword">in</span> dict1 &#123;</div><div class="line">            dict[e.key] = dict1[e.key]</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(dict)</div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/18/Swift3-0学习笔记（一）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/18/Swift3-0学习笔记（一）/" itemprop="url">
                  Swift3.0学习笔记（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-18T22:01:03+08:00">
                2017-01-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Swift/" itemprop="url" rel="index">
                    <span itemprop="name">Swift</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/18/Swift3-0学习笔记（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/18/Swift3-0学习笔记（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/18/Swift3-0学习笔记（一）/" class="leancloud_visitors" data-flag-title="Swift3.0学习笔记（一）">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="增加文档注释"><a href="#增加文档注释" class="headerlink" title="增加文档注释"></a>增加文档注释</h4><p>单行注释(///)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">///单行注释形式</span></div></pre></td></tr></table></figure>
<p>多行注释(<code>/**/</code>)：能够自动识别匹配最近的<code>*/</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*多行注释外圈</span></div><div class="line">     <span class="comment">/*</span></div><div class="line">     多行注释里圈</div><div class="line">     */</div><div class="line">*/</div></pre></td></tr></table></figure>
<p>文档内容解释注释(option+cmd+/)</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/// &lt;#Description#&gt;</span></div><div class="line">    <span class="comment">///</span></div><div class="line">    <span class="comment">/// - Parameters:</span></div><div class="line">    <span class="comment">///   - application: &lt;#application description#&gt;</span></div><div class="line">    <span class="comment">///   - launchOptions: &lt;#launchOptions description#&gt;</span></div><div class="line">    <span class="comment">/// - Returns: &lt;#return value description#&gt;</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">application</span><span class="params">(<span class="number">_</span> application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplicationLaunchOptionsKey: Any]?)</span></span> -&gt; <span class="type">Bool</span> &#123;</div><div class="line">        <span class="comment">// Override point for customization after application launch.</span></div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="xcode8常用特性"><a href="#xcode8常用特性" class="headerlink" title="xcode8常用特性"></a>xcode8常用特性</h4><ul>
<li><p>颜色选择器的显示(color+回车)</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79gy1fbv50vmjjej30f60b476j.jpg" alt=""></p>
</li>
<li><p>图片选择插件</p>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79gy1fbv539br39j30fl02cdg7.jpg" alt=""></p>
</li>
<li><p>MARK标记</p>
<p><img src="https://ww2.sinaimg.cn/large/006tNc79gy1fbv58pkgr7j30di05h3zq.jpg" alt=""></p>
</li>
<li><p>类似于OC中的警告</p>
<ul>
<li>TODO:</li>
</ul>
<p><img src="https://ww3.sinaimg.cn/large/006tNc79gy1fbv5c9lyv0j30fh0awmyy.jpg" alt=""></p>
<p>​</p>
<ul>
<li>FIXME:</li>
</ul>
<p><img src="https://ww4.sinaimg.cn/large/006tNc79gy1fbv5cjkyalj30en08ptaa.jpg" alt=""></p>
<p>​</p>
</li>
</ul>
<h4 id="Swift的常量与变量"><a href="#Swift的常量与变量" class="headerlink" title="Swift的常量与变量"></a>Swift的常量与变量</h4><p><code>let</code>定义常量，一旦定义为常量，将不能修改</p>
<p><code>var</code>定义变量，可以直接修改</p>
<p>变量常量的类型会根据等号右侧的代码推到对应类型</p>
<p><strong>在Swift中对于类型的要求是异常严格的，任何类型之间不允许直接运算，不会做默认的隐式转换，必须有程序员直接转换。</strong></p>
<p><strong>Swift中不存在基本数据类型，都是结构体。Int也是结构体</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">10</span></div><div class="line"><span class="keyword">let</span> y = <span class="number">10.5</span></div><div class="line"><span class="built_in">print</span>(x+y)<span class="comment">//报错</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(x + <span class="type">Int</span>(y))</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//或者直接在定义的时候说明类型(极少使用，一般都是自动推导)</span></div><div class="line"><span class="keyword">let</span> x1: <span class="type">Double</span> = <span class="number">10.1</span></div></pre></td></tr></table></figure>
<h4 id="可选项-Optional"><a href="#可选项-Optional" class="headerlink" title="可选项(Optional)"></a>可选项(Optional)</h4><p><strong>我们在定义一个变量或者常量的时候，一定要记得先初始化</strong></p>
<p>原始的可选项定义</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x: <span class="type">Optional</span> = <span class="number">10</span></div></pre></td></tr></table></figure>
<p>简单的定义</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> y: <span class="type">Int</span>? = <span class="number">40</span><span class="comment">//定义y是一个可选的Int类型，可能为nil，也可能为一个整数</span></div></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="type">Optional</span>(<span class="number">10</span>)<span class="comment">//提示这是一个可选值</span></div></pre></td></tr></table></figure>
<p><strong>不同数据类型之间不能直接运算，如果为nil，那就不是任何的数据类型了，不能参与计算的</strong></p>
<p>强行解包:从可选值中强行获取对应的非空值，如果真的是nil，就会崩溃!</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">print</span>(x!+y!)</div></pre></td></tr></table></figure>
<p>所以，每个程序猿必须对!负责。少用<code>!</code></p>
<h4 id="可选值对变量和常量的不同的影响"><a href="#可选值对变量和常量的不同的影响" class="headerlink" title="可选值对变量和常量的不同的影响"></a>可选值对变量和常量的不同的影响</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">///定义一个y,，没有初始化</span></div><div class="line"><span class="keyword">let</span> y: <span class="type">Int</span>?</div><div class="line"></div><div class="line"><span class="comment">//给常量赋值，初始化的工作只能做一次</span></div><div class="line">y = <span class="number">20</span></div><div class="line"><span class="comment">//两次修改，会报错</span></div><div class="line"><span class="comment">//y = 30</span></div><div class="line"><span class="built_in">print</span>(y)</div><div class="line"></div><div class="line"><span class="comment">//var 的可选值默认为nil</span></div><div class="line"><span class="comment">//let 的可选值没有默认值</span></div><div class="line"><span class="keyword">var</span> x: <span class="type">Int</span>?</div><div class="line">x = <span class="number">100</span></div><div class="line">x = <span class="number">200</span></div><div class="line"></div><div class="line"><span class="built_in">print</span>(x)</div></pre></td></tr></table></figure>
<h4 id="简单的分支"><a href="#简单的分支" class="headerlink" title="简单的分支"></a>简单的分支</h4><p>Swift要求的就是:</p>
<ul>
<li>条件不需要()</li>
<li>语句必须有{}</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">10</span></div><div class="line"><span class="keyword">if</span> x &gt; <span class="number">10</span> &#123;</div><div class="line">  <span class="built_in">print</span>(<span class="string">"大了"</span>)</div><div class="line">&#125;<span class="keyword">else</span> &#123;</div><div class="line">  <span class="built_in">print</span>(<span class="string">"小了"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="三目"><a href="#三目" class="headerlink" title="三目"></a>三目</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x = <span class="number">3</span></div><div class="line">x &gt; <span class="number">5</span> ? <span class="built_in">print</span>(<span class="string">"大了"</span>) : <span class="built_in">print</span>(<span class="string">"小了"</span>)</div><div class="line"></div><div class="line"><span class="comment">//下面的()表示空执行，也就是什么都不做</span></div><div class="line">x &gt; <span class="number">5</span> ? <span class="built_in">print</span>(<span class="string">"大了"</span>) : ()</div></pre></td></tr></table></figure>
<p><strong>??的使用</strong></p>
<p>??其实是一个简单的三目运算符,也是对可选值解包的一种操作方式</p>
<ul>
<li>如果有值，使用值</li>
<li>如果没值，使用??后面的值替代</li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> x: <span class="type">Int</span>? = <span class="literal">nil</span></div><div class="line"><span class="keyword">let</span> y: <span class="type">Int</span>? = <span class="number">10</span></div><div class="line"><span class="built_in">print</span>((x ?? <span class="number">0</span>) + y)<span class="comment">//结果就是10</span></div></pre></td></tr></table></figure>
<p>缺点就是优先级比较低，所以在使用的时候一定要加上<code>()</code></p>
<h4 id="if-let-var的连用语法（判断值）"><a href="#if-let-var的连用语法（判断值）" class="headerlink" title="if let/var的连用语法（判断值）"></a>if let/var的连用语法（判断值）</h4><p><code>if let</code> 连用，判断对象的值是否为 nil，{}内一定有值，但是不可以修改值，可以直接使用，不需要解包</p>
<p><code>if var</code>连用， 判断对象的值是否为 nil，{}内一定有值，但是可以修改值，可以直接使用，不需要解包</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="literal">nil</span></div><div class="line"><span class="keyword">let</span> age: <span class="type">Int</span>? = <span class="number">20</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> <span class="keyword">var</span> myName = name, <span class="keyword">let</span> myAge = age &#123;</div><div class="line"></div><div class="line"><span class="comment">//进入分支后，myName可以修改，myAge不可以修改，但是两者都一定有值，不需要解包</span></div><div class="line"><span class="comment">//myName和myAge的作用于都只在&#123;&#125;</span></div><div class="line">  <span class="built_in">print</span>(myName + <span class="type">String</span>(myAge))</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">  <span class="built_in">print</span>(<span class="string">"Feyddy"</span> + <span class="string">"10"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="guard-守护"><a href="#guard-守护" class="headerlink" title="guard(守护)"></a>guard(守护)</h4><p><code>guard let</code> 和 <code>if let</code>正好相反</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> name: <span class="type">String</span>? = <span class="string">"Feyddy"</span></div><div class="line"><span class="keyword">let</span> age: <span class="type">Int</span>? = <span class="number">20</span></div><div class="line"></div><div class="line"><span class="keyword">guard</span> <span class="keyword">let</span> myName = name, <span class="keyword">let</span> myAge = age <span class="keyword">else</span> &#123;</div><div class="line">  <span class="built_in">print</span>(<span class="string">"姓名或年龄中必有一个为nil"</span>)</div><div class="line">  <span class="keyword">return</span></div><div class="line">&#125; </div><div class="line"></div><div class="line"><span class="comment">//代码执行至此，name和age一定有值</span></div><div class="line"><span class="comment">//通常判断是否有值，会做具体的逻辑实现</span></div><div class="line"><span class="comment">//如果用if let 凭空多了一层分支，guard let 正好减少分支</span></div></pre></td></tr></table></figure>
<h4 id="if-let和guard-let的命名技巧"><a href="#if-let和guard-let的命名技巧" class="headerlink" title="if let和guard let的命名技巧"></a>if let和guard let的命名技巧</h4><p>使用同名的变量接受值，在后续使用的都是非空值，不需要解包</p>
<p><strong>这个变量不能使用var在定义一次，否则会出现重复定义的错误，所以只有在函数里面传参数的时候用</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">demo</span><span class="params">(name: String? , age: Int?)</span></span> &#123;</div><div class="line">      <span class="keyword">guard</span> <span class="keyword">let</span> name = name ,<span class="keyword">let</span> age = age <span class="keyword">else</span> &#123;</div><div class="line">          <span class="keyword">return</span></div><div class="line">      &#125;</div><div class="line">      <span class="built_in">print</span>(name + <span class="type">String</span>(age))</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h4 id="在OC中的常用写法"><a href="#在OC中的常用写法" class="headerlink" title="{}在OC中的常用写法"></a>{}在OC中的常用写法</h4><ul>
<li><p>{}为了限制作用域。里面可以定义一个和上面一样的变量名而不冲突。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(0, 100, 200, 50)];</div><div class="line">label.backgroundColor = [UIColor orangeColor];</div><div class="line">[self.view addSubview:label];</div><div class="line"></div><div class="line">&#123;</div><div class="line">    UILabel *label = [[UILabel alloc] initWithFrame:CGRectMake(0, 200, 200, 50)];</div><div class="line">    label.backgroundColor = [UIColor redColor];</div><div class="line">    [self.view addSubview:label];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<ul>
<li><p>{}包装代码，()表示执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">UILabel *myLabel = (&#123;</div><div class="line">       </div><div class="line">        UILabel *labels = [[UILabel alloc] initWithFrame:CGRectMake(0, 300, 200, 50)];</div><div class="line">        labels.text = @&quot;里面的&quot;;</div><div class="line">        labels.backgroundColor = [UIColor blueColor];</div><div class="line">        </div><div class="line">        labels.textAlignment = NSTextAlignmentCenter;</div><div class="line">        </div><div class="line">        //末尾的labels会给myLabel设置数值</div><div class="line">        labels;</div><div class="line">        </div><div class="line">&#125;);</div><div class="line">    </div><div class="line">[self.view addSubview:myLabel];</div></pre></td></tr></table></figure>
</li>
<li><p>工作中看到最多的就是UITableView</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">UITableView *myTableView = (&#123;</div><div class="line">        UITableView *tableView = [[UITableView alloc] initWithFrame:CGRectMake(0, 350, 300, 100) style:UITableViewStylePlain];</div><div class="line">        </div><div class="line">        //...</div><div class="line">        </div><div class="line">        </div><div class="line">        tableView;</div><div class="line">    &#125;);</div><div class="line">    [self.view addSubview:myTableView];</div></pre></td></tr></table></figure>
<h4 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h4><p>相比OC中的switch用法比较扩展，不再局限于整数</p>
<p><strong>swift中的switch特点：</strong></p>
<ul>
<li>可以对任意类型的值进行分支，不在局限在整数</li>
<li>一般不需要 break</li>
<li>如果多值，使用<code>,</code></li>
<li>所有的分支至少需要一条指令，如果什么都不干才使用<code>break</code></li>
</ul>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">demoSwitch</span><span class="params">(num: String)</span></span> &#123;</div><div class="line">        <span class="keyword">switch</span> num &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">"8"</span>,<span class="string">"9"</span>,<span class="string">"10"</span>:</div><div class="line">            <span class="keyword">let</span> score = <span class="string">"good"</span></div><div class="line">            <span class="built_in">print</span>(score)</div><div class="line">        <span class="keyword">case</span> <span class="string">"7"</span>: <span class="keyword">break</span><span class="comment">//此时的“7”这种情况不执行任何操作，但是至少有一条命令，➕break</span></div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">break</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>case后面加上语句</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">whereDemo</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">let</span> point = <span class="type">CGPoint</span>(x: -<span class="number">10</span>, y: <span class="number">10</span>)</div><div class="line">    <span class="keyword">switch</span> point &#123;</div><div class="line">    <span class="keyword">case</span> <span class="keyword">let</span> p <span class="keyword">where</span> p.x == <span class="number">0</span> &amp;&amp; p.y == <span class="number">0</span>:</div><div class="line">        <span class="built_in">print</span>(<span class="string">"原点"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="keyword">let</span> p <span class="keyword">where</span> p.x == <span class="number">0</span> :</div><div class="line">        <span class="built_in">print</span>(<span class="string">"Y轴"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="keyword">let</span> p <span class="keyword">where</span> p.y == <span class="number">0</span>:</div><div class="line">        <span class="built_in">print</span>(<span class="string">"X轴"</span>)</div><div class="line">    <span class="keyword">case</span> <span class="keyword">let</span> p <span class="keyword">where</span> <span class="built_in">abs</span>(p.x) == <span class="built_in">abs</span>(p.y):<span class="comment">//abs()函数为取绝对值</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"对角线"</span>)</div><div class="line">    <span class="keyword">default</span>:</div><div class="line">        <span class="built_in">print</span>(<span class="string">"其他"</span>)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h4><p>Swift3.0取消了传统的for循环语法</p>
<ul>
<li>传统的for 在swift3.0中被取消</li>
<li>i++/++i 在swift3.0中被取消</li>
</ul>
<p><strong>Swift3.0对空格的要求比较严格</strong></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">forDemo</span><span class="params">()</span></span> &#123;</div><div class="line">        </div><div class="line">    <span class="comment">//变量i 在[0,5] 循环</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>...<span class="number">5</span> &#123;</div><div class="line">        <span class="built_in">print</span>(i)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">print</span>(<span class="string">"-----------------"</span>)</div><div class="line"></div><div class="line">    <span class="comment">//变量i 在[0,5) 循环</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span>..&lt;<span class="number">5</span> &#123;</div><div class="line">        <span class="built_in">print</span>(i)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">       <span class="built_in">print</span>(<span class="string">"-----------------"</span>)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">//提示：范围定义是一个固定的格式</span></div><div class="line">    <span class="comment">//CountableRange</span></div><div class="line">    <span class="keyword">let</span> r1 = <span class="number">0</span>..&lt;<span class="number">10</span></div><div class="line">    <span class="built_in">print</span>(r1)</div><div class="line"></div><div class="line">    <span class="comment">//CountableClosedRange</span></div><div class="line">    <span class="keyword">let</span> r2 = <span class="number">0</span>...<span class="number">10</span></div><div class="line">    <span class="built_in">print</span>(r2)</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="反序遍历"><a href="#反序遍历" class="headerlink" title="反序遍历"></a>反序遍历</h6><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">reversedDemo</span><span class="params">()</span></span> &#123;</div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> (<span class="number">0</span>..&lt;<span class="number">10</span>).reversed() &#123;</div><div class="line">        <span class="built_in">print</span>(i)</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="字符串遍历和长度的三种方法"><a href="#字符串遍历和长度的三种方法" class="headerlink" title="字符串遍历和长度的三种方法"></a>字符串遍历和长度的三种方法</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字符串的遍历</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">characterDemo</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="comment">//NSString 不支持以下方式遍历</span></div><div class="line">        <span class="keyword">let</span> str: <span class="type">String</span> = <span class="string">"我叫Feyddy"</span></div><div class="line">        </div><div class="line">        <span class="keyword">for</span> <span class="built_in">c</span> <span class="keyword">in</span> str.characters &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="built_in">c</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字符串的长度</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">characterLength</span><span class="params">()</span></span>  &#123;</div><div class="line">        <span class="keyword">let</span> str = <span class="string">"Hello world Feyddy 忠林"</span></div><div class="line">        </div><div class="line">        <span class="comment">//1.返回指定编码的对应的字节数量</span></div><div class="line">        <span class="comment">//UTF8 的编码(0~4个)，每个汉字3个字节</span></div><div class="line">        <span class="built_in">print</span>(str.lengthOfBytes(using: .utf8))</div><div class="line">        </div><div class="line">        <span class="comment">//2.字符串长度 - 返回字符的个数(推荐使用)</span></div><div class="line">        <span class="built_in">print</span>(str.characters.<span class="built_in">count</span>)</div><div class="line">        </div><div class="line">        <span class="comment">//3.使用 NSString 中转</span></div><div class="line">        <span class="comment">/**</span></div><div class="line">         str as NSString</div><div class="line">         OC中的写法就是(FeyddyTableViewCell *)[tableView ...]</div><div class="line">         Swift中可以使用  '值' as ‘类型’ 转换</div><div class="line">         */</div><div class="line">        <span class="keyword">let</span> ocStr = str <span class="keyword">as</span> <span class="type">NSString</span></div><div class="line">        <span class="built_in">print</span>(ocStr.length)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="字符串的拼接和格式化"><a href="#字符串的拼接和格式化" class="headerlink" title="字符串的拼接和格式化"></a>字符串的拼接和格式化</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字符串的拼接</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">appendString</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> name = <span class="string">"Feyddy"</span></div><div class="line">        <span class="keyword">let</span> age = <span class="number">25</span></div><div class="line">        <span class="keyword">let</span> title: <span class="type">String</span>? = <span class="string">"Boss"</span></div><div class="line">        <span class="keyword">let</span> point = <span class="type">CGPoint</span>(x: <span class="number">100</span>, y: <span class="number">100</span>)</div><div class="line">        </div><div class="line">        <span class="comment">//\(变量/常量)</span></div><div class="line">        <span class="comment">//拼接字符串需要注意 可选项(Optional)</span></div><div class="line">        <span class="comment">//OC中拼接point的时候:NSStringFromCGPoint(&lt;#CGPoint point#&gt;)</span></div><div class="line">        <span class="keyword">let</span> str = <span class="string">"<span class="subst">\(name)</span><span class="subst">\(age)</span><span class="subst">\(title ?? "")</span><span class="subst">\(point)</span>"</span></div><div class="line">        </div><div class="line">        <span class="built_in">print</span>(str)</div><div class="line">    &#125;</div><div class="line">    </div><div class="line"><span class="comment">//字符串的格式化</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">formatString</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="keyword">let</span> h = <span class="number">10</span></div><div class="line">        <span class="keyword">let</span> m = <span class="number">11</span></div><div class="line">        <span class="keyword">let</span> s = <span class="number">35</span></div><div class="line">        </div><div class="line">        <span class="comment">//使用格式字符串格式化</span></div><div class="line">        <span class="keyword">let</span> dataStr = <span class="type">String</span>(format: <span class="string">"%02d:%02d:%02d"</span>, h,m,s)</div><div class="line">        <span class="built_in">print</span>(dataStr)</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="字符串的子串"><a href="#字符串的子串" class="headerlink" title="字符串的子串"></a>字符串的子串</h4><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//字符串的子串</span></div><div class="line">    <span class="function"><span class="keyword">func</span> <span class="title">subString</span><span class="params">()</span></span> &#123;</div><div class="line">        <span class="comment">//建议：一般使用NSString作为中转，因为Swift取子串的方法一直在改</span></div><div class="line">        <span class="comment">//更加容易理解</span></div><div class="line">        <span class="keyword">let</span> str = <span class="string">"我们一起进步"</span></div><div class="line">        </div><div class="line">        <span class="comment">//1.NSString</span></div><div class="line">        <span class="keyword">let</span> ocString = str <span class="keyword">as</span> <span class="type">NSString</span></div><div class="line">        <span class="keyword">let</span> s1 = ocString.substring(with: <span class="type">NSMakeRange</span>(<span class="number">1</span>, <span class="number">3</span>))<span class="comment">//从索引为1的位置开始往后取3个数</span></div><div class="line">        <span class="built_in">print</span>(s1)</div><div class="line">        </div><div class="line">        </div><div class="line">        <span class="comment">//2.String 的3.0 方法</span></div><div class="line">        <span class="comment">//Index</span></div><div class="line">        <span class="comment">//str.startIndex position = 0</span></div><div class="line">        <span class="comment">//str.endIndex position = str.length</span></div><div class="line">        </div><div class="line">        <span class="keyword">let</span> r1 = str.substring(to: <span class="string">"一起"</span>.endIndex)</div><div class="line">        <span class="comment">//let r11 = str.substring(to: "asd".endIndex)</span></div><div class="line">        <span class="built_in">print</span>(r1)<span class="comment">//取的是“一起”（不包括“一起”）前面的所有的值，这里的“一起”和str里面的没有任何关系</span></div><div class="line">        </div><div class="line">        <span class="comment">//let r2 = str.substring(from: "一起".startIndex)</span></div><div class="line">        <span class="keyword">let</span> r22 = str.substring(from: <span class="string">"abc"</span>.startIndex)</div><div class="line">        <span class="built_in">print</span>(r22)<span class="comment">//取的是str的开始位置为(String).startIndex == 0之后的所有的值</span></div><div class="line"></div><div class="line">        </div><div class="line">        <span class="comment">//3.取范围</span></div><div class="line">        <span class="keyword">guard</span> <span class="keyword">let</span> range = str.range(of: <span class="string">"一起"</span>) <span class="keyword">else</span> &#123;</div><div class="line">            <span class="built_in">print</span>(<span class="string">"没有找到字符串"</span>)</div><div class="line">            <span class="keyword">return</span></div><div class="line">        &#125;</div><div class="line">        <span class="comment">//一定找到字符串</span></div><div class="line">        <span class="built_in">print</span>(<span class="string">"---------"</span>)</div><div class="line">        <span class="built_in">print</span>(range)</div><div class="line">        <span class="built_in">print</span>(str.substring(with: range))</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/网络编程-NSURLConnection基本用法介绍/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/17/网络编程-NSURLConnection基本用法介绍/" itemprop="url">
                  网络编程-NSURLConnection基本用法介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-17T21:17:37+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/17/网络编程-NSURLConnection基本用法介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/17/网络编程-NSURLConnection基本用法介绍/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/17/网络编程-NSURLConnection基本用法介绍/" class="leancloud_visitors" data-flag-title="网络编程-NSURLConnection基本用法介绍">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="NSURLConnection的基本使用"><a href="#NSURLConnection的基本使用" class="headerlink" title="NSURLConnection的基本使用"></a>NSURLConnection的基本使用</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>NSURLConnection 这个名字，实际上是指代的 Foundation 框架的 URL 加载系统中一系列有关联的组件：NSURLRequest、NSURLResponse、NSURLProtocol、 NSURLCache、 NSHTTPCookieStorage、NSURLCredentialStorage 以及同名类 NSURLConnection。</p>
<h4 id="NSURLConnection常用的类"><a href="#NSURLConnection常用的类" class="headerlink" title="NSURLConnection常用的类"></a><strong>NSURLConnection常用的类</strong></h4><p>1、NSURL：根据url生成的请求地址</p>
<p>2、NSURLRequest：封装的一个请求，携带发送给服务器的全部数据，里面包含一个NSURL对象，请求方法，请求头，请求体等等。。</p>
<p>3、NSMutableURLRequest：这个是NSURLRequest的子类，通过名字我们可以看出这是一个可变的对象，我们可以在这里自定义设置发送的服务器的全部数据（超市等待时间、请求方法、请求体、请求头）</p>
<p>4、NSURLResponse：服务的响应类，和NSURLRequest对象，包含服务返回的响应头部数据</p>
<p>5、NSURLConnection：负责发送请求，建立客户端和服务器的连接。发送NSURLRequest的数据给服务器，并收集来自服务器的响应头部数据NSURLResponse或者NSData</p>
<h4 id="NSURLConnection使用步骤"><a href="#NSURLConnection使用步骤" class="headerlink" title="NSURLConnection使用步骤"></a><strong>NSURLConnection使用步骤</strong></h4><p>1、根据url创建一个NSURL对象</p>
<p>2、根据创建的NSURL创建一个NSURLRequest对象，创建请求对象（此对象内容全部都是默认值，如：请求方法默认是GET），如果想要自定数据则创建NSMutableURLRequest对象</p>
<p>3、最后使用NSURLConnection发送创建好的NSURLRequest或者NSMutableURLRequest对象，与服务器建立链接</p>
<h6 id="非代理模式"><a href="#非代理模式" class="headerlink" title="非代理模式"></a><strong>非代理模式</strong></h6><p>非代理模式中有提供了两个方法同步请求和异步请求(block实现)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line">    //1.设置访问的url地址</div><div class="line">    self.imageUrl = @&quot;http://7xt5rm.com2.z0.glb.clouddn.com/picjumbo.com_download.jpg&quot;;</div><div class="line">    //根据url生成的NSURL请求地址</div><div class="line">    NSURL *URL = [NSURL URLWithString:self.imageUrl];</div><div class="line">    //2.创建请求对象(NSMutableURLRequest)</div><div class="line">    self.request = [NSMutableURLRequest requestWithURL:URL];</div><div class="line"></div><div class="line">    //3.设置请求相关的信息</div><div class="line">    //设置请求方式，默认是GET请求</div><div class="line">    request.HTTPMethod = @&quot;GET&quot;;</div><div class="line">    //设置请求超时时间</div><div class="line">    request.timeoutInterval = 60;</div><div class="line"></div><div class="line">    //设置请求头</div><div class="line">    //request.allHTTPHeaderFields = @&#123;</div><div class="line">                                    </div><div class="line">    //                               &#125;;</div><div class="line">    //如果之前的key被设置过，则此方法会用新值覆盖旧值。</div><div class="line">    [request setValue:@&quot;User_Agent&quot; forHTTPHeaderField:@&quot;safari&quot;];</div><div class="line">    //如果之前的key被设置过，则此方法会将新值附加在旧值后，并用合适的符号分隔</div><div class="line">    //[request addValue:&lt;#(NSString *)#&gt; forHTTPHeaderField:&lt;#(NSString *)#&gt;];</div><div class="line">    //设置请求体(get方法没有)</div><div class="line"></div><div class="line">	</div><div class="line"></div><div class="line"></div><div class="line">    //发送同步请求 同步请求在主线程中执行 会一直在等待服务器返回数据，会阻塞主线程的执行，如果服务器没有返回数据，那么在主线程UI会卡住不能继续执行操作</div><div class="line">    //不建议这么做</div><div class="line">    //4.构造NSURLConnection，发送请求</div><div class="line">    NSURLResponse *response = nil;</div><div class="line">    NSError *error = nil;</div><div class="line">    NSData *data = [NSURLConnection sendSynchronousRequest:request returningResponse:&amp;response error:&amp;error];</div><div class="line"></div><div class="line">    //5.获取响应头信息</div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    </div><div class="line">    //获取状态码</div><div class="line">    NSInteger statusCode = httpResponse.statusCode;</div><div class="line">    NSLog(@&quot;状态码:%li&quot;, statusCode);</div><div class="line">    </div><div class="line">    //响应头</div><div class="line">    NSLog(@&quot;响应头:%@&quot;, httpResponse.allHeaderFields);</div><div class="line">    </div><div class="line">    </div><div class="line">    //6.获取响应数据信息</div><div class="line">    if (data != nil) &#123;</div><div class="line">        NSString *jsonString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];</div><div class="line">        _textView.text = jsonString;</div><div class="line">        //JSON解析</div><div class="line">        NSDictionary *dic = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableContainers error:nil];</div><div class="line">        NSLog(@&quot;dic:%@&quot;, dic);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSLog(@&quot;data length = %lu&quot;,(unsigned long)data.length);</div><div class="line"></div><div class="line">    ------------------------------------------------------------------</div><div class="line"></div><div class="line">    //发送异步请求 </div><div class="line">      </div><div class="line">      </div><div class="line">    //3.设置请求体：POST请求的请求参数是放在请求体中的。</div><div class="line">    </div><div class="line">    NSString *paraText = @&quot;cinema_id=1533&quot;;</div><div class="line">    </div><div class="line">    request.HTTPBody = [paraText dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">    </div><div class="line">    //设置压缩策略</div><div class="line">    [request setValue:@&quot;gzip&quot; forHTTPHeaderField:@&quot;Accept-Encoding&quot;];</div><div class="line">    </div><div class="line">    //缓存策略</div><div class="line">    request.cachePolicy = NSURLRequestReturnCacheDataElseLoad;</div><div class="line"></div><div class="line"></div><div class="line">    //异步请求需要一个队列来负责回调代码块的执行，当获取到返回数据是，会在这个线程队列中执行代码块，这里我们使用主队列，</div><div class="line">    NSOperationQueue *queue=[NSOperationQueue mainQueue];</div><div class="line">    //异步请求传入一个^(NSURLResponse *response,NSData *data, NSError *connectionError)block代码块，当请求数据返回时，执行此代码块，此代码块有三个参数，respons响应头 data返回数据 connectionError错误代码</div><div class="line">    [NSURLConnection sendAsynchronousRequest:self.request queue:queue completionHandler:^(NSURLResponse *response,NSData *data, NSError *connectionError)&#123;</div><div class="line">       NSLog(@&quot;response = %@&quot;,response);</div><div class="line">       NSLog(@&quot;data = %@&quot;,data);</div><div class="line">       NSLog(@&quot;error = %@&quot;,connectionError);</div><div class="line">       if (connectionError) &#123;</div><div class="line">            return;</div><div class="line">        &#125;        </div><div class="line">        NSString *jsonString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];</div><div class="line">        </div><div class="line">        //回到主线程更新UI.</div><div class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">            _textView.text = jsonString;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;];</div><div class="line"></div><div class="line"></div><div class="line">//5.如何监听网络传输的进度，使用另一种发送异步请求的方式</div><div class="line">    //构建一个connection对象</div><div class="line">    NSURLConnection *connection = [NSURLConnection connectionWithRequest:request delegate:self];</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    //利用代理对象的协议方法来监听网络传输进度,所有的协议方法是在主线程被回调的，但是网络请求的过程是在多线程中处理的。</div></pre></td></tr></table></figure>
<h6 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a><strong>代理模式</strong></h6><p>使用代理模式需要实现NSURLConnectionDataDelegate协议，此协议提供了几个代理方法，涵盖了请求交互的几个步骤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">#pragma mark - NSURLConnection delegate</div><div class="line"></div><div class="line">//网络请求失败会调用的协议方法</div><div class="line">- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;网络请求失败：%@&quot;, error);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取到响应头时会调用的协议方法</div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response &#123;</div><div class="line">    </div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    </div><div class="line">    //获取状态码</div><div class="line">    NSInteger statusCode = httpResponse.statusCode;</div><div class="line">    NSLog(@&quot;状态码:%li&quot;, statusCode);</div><div class="line">    </div><div class="line">    //响应头</div><div class="line">    NSLog(@&quot;响应头:%@&quot;, httpResponse.allHeaderFields);</div><div class="line">    </div><div class="line">    //定义NSData用来接收数据包</div><div class="line">     _receivedData = [[NSMutableData alloc] init];</div><div class="line"></div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//接收数据时会调用的协议方法，此方法可能被调用多次</div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data &#123;</div><div class="line">    </div><div class="line">    //将每次接收到的数据包附加在_receivedData后</div><div class="line">    [_receivedData appendData:data];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//接收数据完毕时会被调用的协议方法</div><div class="line">- (void)connectionDidFinishLoading:(NSURLConnection *)connection &#123;</div><div class="line">    //将接收到的所有数据转化为NSString</div><div class="line">    </div><div class="line">    NSString *jsonString = [[NSString alloc] initWithData:_receivedData encoding:NSUTF8StringEncoding];</div><div class="line">    </div><div class="line">    _textView.text = jsonString;</div><div class="line"></div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//上传文件时调用的协议方法</div><div class="line">- (void)connection:(NSURLConnection *)connection didSendBodyData:(NSInteger)bytesWritten totalBytesWritten:(NSInteger)totalBytesWritten totalBytesExpectedToWrite:(NSInteger)totalBytesExpectedToWrite &#123;</div><div class="line">    </div><div class="line">//    bytesWritten：本次上传数据字节数</div><div class="line">//    totalBytesWritten:累加上传数据字节数</div><div class="line">//    totalBytesExpectedToWrite :上传文件总字节数</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="音频下载"><a href="#音频下载" class="headerlink" title="音频下载"></a>音频下载</h4><p>接收500KB的数据就写入文件，释放其所占内存，以达到节约内存的目的。</p>
<p>ViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController</div><div class="line">@property (weak, nonatomic) IBOutlet UILabel *progressLabel;</div><div class="line">@property (weak, nonatomic) IBOutlet UIProgressView *progressView;</div><div class="line">- (IBAction)startDownload:(UIButton *)sender;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()&lt;NSURLConnectionDelegate,NSURLConnectionDataDelegate&gt;</div><div class="line">&#123;</div><div class="line">    double _totalLength;//文件大小</div><div class="line">    double _receivedLength;//累加接受的数据的大小</div><div class="line">    NSMutableData *_totalData;//保存下载数据</div><div class="line">    BOOL _isLoading;//文件是否正在下载</div><div class="line">    NSString *_path;//下载文件的路径</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    _isLoading = NO;</div><div class="line">&#125;</div><div class="line">- (IBAction)startLoad:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    if (!_isLoading) &#123;</div><div class="line">        </div><div class="line">        //构造URL</div><div class="line">        NSURL *url = [NSURL URLWithString:@&quot;http://ws.stream.qqmusic.qq.com/59077847.m4a?continfo=73820346915A0B48DECCA0B4538EBAE8D0A505A652637707&amp;vkey=6601BF6508BEFF1A0B01887E58B6B38F63DB66AB2F16AFC2BB3510F0D979BADCC4F156907B95311B963170DFDDE231C33AEC78F6447259D9&amp;guid=beebe00086eb6ea85ed23db8d2d97e12f0214a04&amp;fromtag=53&amp;uin=837223065&quot;];</div><div class="line">        </div><div class="line">        //构造request</div><div class="line">        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">        </div><div class="line">        //发送异步网络请求</div><div class="line">        [NSURLConnection connectionWithRequest:request delegate:self];</div><div class="line">        _isLoading = YES;</div><div class="line">        </div><div class="line">        //创建空文件夹来保存下载下来的数据</div><div class="line">        </div><div class="line">        //设置文件名</div><div class="line">        NSString *file = @&quot;白龙马.mp3&quot;;</div><div class="line">        //设置文件路径</div><div class="line">        _path = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/%@&quot;,file];</div><div class="line">        </div><div class="line">        NSLog(@&quot;%@&quot;,_path);</div><div class="line">        </div><div class="line">        //创建空文件夹</div><div class="line">        [[NSFileManager defaultManager]createFileAtPath:_path contents:nil attributes:nil];</div><div class="line">        </div><div class="line">    &#125;   </div><div class="line">&#125;</div><div class="line"></div><div class="line">//把数据写入文件并到文件的末尾</div><div class="line">-(void)addFile:(NSData *)data</div><div class="line">&#123;</div><div class="line">    if (data.length ==0 || _path.length == 0) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //创建文件句柄</div><div class="line">    NSFileHandle *fileHandle = [NSFileHandle fileHandleForWritingAtPath:_path];</div><div class="line">    </div><div class="line">    //把文件位置放到文件最后</div><div class="line">    [fileHandle seekToEndOfFile];</div><div class="line">    </div><div class="line">    //写入数据</div><div class="line">    [fileHandle writeData:data];</div><div class="line">    </div><div class="line">    //关闭文件</div><div class="line">    [fileHandle closeFile];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - NSURLConnectionDelegate</div><div class="line"></div><div class="line">-(void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response</div><div class="line">&#123;</div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    </div><div class="line">    NSDictionary *fields = httpResponse.allHeaderFields;</div><div class="line">    </div><div class="line">    //获取下载文件大小</div><div class="line">    NSNumber *length = fields[@&quot;content-Length&quot;];</div><div class="line">    </div><div class="line">    _totalLength = [length doubleValue];</div><div class="line">    </div><div class="line">    _receivedLength = 0;//清零</div><div class="line">    </div><div class="line">    _totalData = [[NSMutableData alloc]init];</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    [_totalData appendData:data];</div><div class="line">    </div><div class="line">    //通过当前下载的文件的大小来刷新显示</div><div class="line">    _receivedLength += data.length;</div><div class="line">    double progress = _receivedLength / _totalLength;</div><div class="line">    </div><div class="line">    //刷新UI</div><div class="line">    self.loadLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;,progress*100];</div><div class="line">    </div><div class="line">    self.progressView.progress = progress;</div><div class="line">    </div><div class="line">    //当缓冲的数据超过500KB时，写入数据</div><div class="line">    if (_totalData.length &gt; 500 * 1024) &#123;</div><div class="line">        [self addFile:_totalData];</div><div class="line">        </div><div class="line">        //释放内存</div><div class="line">        _totalData.data = nil;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)connectionDidFinishLoading:(NSURLConnection *)connection</div><div class="line">&#123;</div><div class="line">    //下载完后将文件保存在本地文件夹中 </div><div class="line">    [self addFile:_totalData];</div><div class="line">    </div><div class="line">    //释放内存</div><div class="line">    _totalData.data = nil;</div><div class="line">    </div><div class="line">    self.loadLabel.text = @&quot;Succeese&quot;;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h4><p>有时候数据文件比较大，我们一次不一定能够全部下载，如果之前下载了一部分，之后我们又要下载的话，在重头开始有点不太合适，这时候我们应该如何做呢。。</p>
<p>现在的下载一般是用<code>http</code>协议，<code>http</code>协议的头部有个字段<code>Range</code>，可以满足我们的需求。</p>
<p><code>Range</code>用于请求头中，指定第一个字节的位置和最后一个字节的位置，一般格式：</p>
<p><code>Range:(unit=first byte pos)-[last byte pos]</code></p>
<p>当我们暂停下载的时候我们可以在代理方法<code>- (void)connection:(NSURLConnection *)connection didReceiveData:(nonnull NSData *)data</code>中记录已下载数据的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(nonnull NSData *)data&#123;</div><div class="line">            NSLog(@&quot;接受数据中。。。。。%lu&quot;,(unsigned long)data.length);</div><div class="line">            //要把每一次接收到的数据拼接起来</div><div class="line">        [self.imageData appendData:data];</div><div class="line">        //记录已下载数据的大小</div><div class="line">        range = range + data.length;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>然后在再次下载的时候设置<code>HTTP</code>的<code>Range</code>头部,注意此时<strong>request需要是NSMutableURLRequest对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> //设置请求数据范围</div><div class="line">NSString *rangeValue = [NSString stringWithFormat:@&quot;bytes=%llu-&quot;, range];</div><div class="line">[self.request setValue:rangeValue forHTTPHeaderField:@&quot;Range&quot;];</div><div class="line">[self.request setCachePolicy:NSURLRequestReloadIgnoringLocalCacheData];</div><div class="line">self.connection = [NSURLConnection connectionWithRequest:self.request delegate:self];</div></pre></td></tr></table></figure>
<p>下面做个完整的小demo</p>
<p>需求如下：</p>
<ol>
<li><p>内存优化</p>
<p>当下载数据量达到500KB时，就写入文件，释放内存。</p>
<p>(1)创建空文件保存下载数据。</p>
<p>(2)当下载数据量达到500K时，把数据附加到文件末尾</p>
</li>
</ol>
<ol>
<li><p>断点续传</p>
<p>（1）可以暂停下载，暂停下载时，客户端要记载下载的暂停位置，记录在本地的文件中。</p>
<p>（2）程序退出后，再次进入到此程序中，仍然能从上次下载的暂停位置开始下载。</p>
<p>（3）安全文件操作思想：一个目标目录，一个临时目录，当文件下载未完成时，保存临时文件在临时目录，直到文件下载完成，把此下载完成的临时文件剪切到目标目录。</p>
<p>目标目录：/Documents</p>
<p>临时目录：/Documents/tmp</p>
<p>（4）客户端通过设置请求头来通知服务器继续下载的起始位置</p>
<p>Range:bytes=0-499 表示下载头500个字节</p>
<p>Range:bytes=500-999 表示下载第二个500个字节</p>
<p>Range:bytes=-500 表示下载最后一个500个字节</p>
<p>Range:bytes=500- 表示下载500字节以后内容</p>
<p>Range:bytes=0-0,-1 表示下载第一个字节和最后一个字节</p>
</li>
</ol>
<p>ViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController &lt;NSURLConnectionDelegate, NSURLConnectionDataDelegate&gt;</div><div class="line">@property (weak, nonatomic) IBOutlet UILabel *progressLabel;</div><div class="line">@property (weak, nonatomic) IBOutlet UIProgressView *progressView;</div><div class="line">- (IBAction)startDownload:(UIButton *)sender;</div><div class="line">- (IBAction)cancelDownload:(UIButton *)sender;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#define  kReceivedTotal @&quot;receivedTotal&quot;</div><div class="line">#define kTotal @&quot;total&quot;</div><div class="line">@interface ViewController () &#123;</div><div class="line">    BOOL _isDownLoading; //是否正在下载</div><div class="line">    double _totalLength; //文件大小</div><div class="line">    double _receivedLength; //累加接收的数据包大小</div><div class="line">    NSMutableData *_data; //保存下载数据</div><div class="line">    NSString *_filePath; //临时文件的路径</div><div class="line">    </div><div class="line">    //全局连接对象，用它来取消下载</div><div class="line">    NSURLConnection *_connection;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    //读取本地化的plist文件，获取已下载数据量和文件总大小</div><div class="line">    NSUserDefaults *userDefault = [NSUserDefaults standardUserDefaults];</div><div class="line">    </div><div class="line">//    NSLog(@&quot;userDefault:%@&quot;,userDefault);</div><div class="line">    </div><div class="line">    _receivedLength = [[userDefault objectForKey:kReceivedTotal] doubleValue];</div><div class="line">    _totalLength = [[userDefault objectForKey:kTotal] doubleValue];</div><div class="line">    </div><div class="line">    if (_totalLength &gt; 0) &#123;</div><div class="line">        double progress = _receivedLength / _totalLength;</div><div class="line">        _progressLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;, progress * 100];</div><div class="line">        _progressView.progress = progress;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (IBAction)startDownload:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    if (!_isDownLoading) &#123;</div><div class="line">        </div><div class="line">        //构造URL</div><div class="line">        NSURL *url = [NSURL URLWithString:@&quot;http://music.baidu.com/data/music/file?link=http://yinyueshiting.baidu.com/data2/music/134371896/12313247982800128.mp3?xcode=ffec71a6b8c89b0a0c0d8753917afb85&amp;song_id=123132479&quot;];</div><div class="line">        </div><div class="line">        //构造reuqest</div><div class="line">        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">        </div><div class="line">        //通过http下载请求头来设置继续下载的位置</div><div class="line">        NSString *value = [NSString stringWithFormat:@&quot;bytes=%i-&quot;, (int)_receivedLength];</div><div class="line"></div><div class="line">        [request setValue:value forHTTPHeaderField:@&quot;Range&quot;];</div><div class="line">        </div><div class="line">        NSLog(@&quot;继续下载:%@&quot;, request.allHTTPHeaderFields);</div><div class="line">        </div><div class="line">        //发送异步网络请求</div><div class="line">        _connection = [NSURLConnection connectionWithRequest:request delegate:self];</div><div class="line">        </div><div class="line">        //此时正在下载</div><div class="line">        _isDownLoading = YES;</div><div class="line">        </div><div class="line">        //创建临时目录</div><div class="line">        _filePath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/tmp/%@&quot;, @&quot;file.mp3&quot;];</div><div class="line">        </div><div class="line">        NSLog(@&quot;%@&quot;, _filePath);</div><div class="line">        //判断临时文件是否存在，如果不存在则创建</div><div class="line">        if (![[NSFileManager defaultManager] fileExistsAtPath:_filePath]) &#123;</div><div class="line">            //先创建临时文件夹</div><div class="line">            NSString *dirPath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/tmp&quot;];</div><div class="line">            </div><div class="line">            [[NSFileManager defaultManager] createDirectoryAtPath:dirPath withIntermediateDirectories:YES attributes:nil error:nil];</div><div class="line">            //创建空的临时文件</div><div class="line">            [[NSFileManager defaultManager] createFileAtPath:_filePath contents:nil attributes:nil];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (IBAction)cancelDownload:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    //取消下载</div><div class="line">    [_connection cancel];</div><div class="line">    </div><div class="line">    //把数据包存入文件</div><div class="line">    [self appendFileData:_data];</div><div class="line">    //释放内存</div><div class="line">    _data.data = nil;</div><div class="line">    </div><div class="line">    [_data setData:nil];</div><div class="line">    </div><div class="line">    _isDownLoading = NO;</div><div class="line">    </div><div class="line">    //暂停时，保存已下载数据量和文件总数据量到本地，保证程序退出后下次进入仍能实现断点续传</div><div class="line">    NSUserDefaults *userDefault = [NSUserDefaults standardUserDefaults];</div><div class="line">    [userDefault setObject:@(_receivedLength) forKey:kReceivedTotal];</div><div class="line">    [userDefault setObject:@(_totalLength) forKey:kTotal];</div><div class="line"></div><div class="line">    //把数据同步写入到plist文件</div><div class="line">    [userDefault synchronize];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//封装把数据写入文件，附加到文件的末尾的方法</div><div class="line">- (void)appendFileData:(NSData *)data &#123;</div><div class="line">    </div><div class="line">    if (data.length == 0 || _filePath.length == 0 ) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //(1)创建文件句柄</div><div class="line">    NSFileHandle *fileHandle = [NSFileHandle fileHandleForWritingAtPath:_filePath];</div><div class="line">    </div><div class="line">    //（2）把文件位置指针定位到末尾</div><div class="line">    [fileHandle seekToEndOfFile];</div><div class="line">    </div><div class="line">    //（3）写入数据</div><div class="line">    [fileHandle writeData:data];</div><div class="line">    </div><div class="line">    //(4)关闭文件</div><div class="line">    [fileHandle closeFile];</div><div class="line">    </div><div class="line">&#125;</div><div class="line">#pragma mark - NSURLConnection delegate</div><div class="line"></div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response &#123;</div><div class="line">    </div><div class="line">    //获取要下载的文件的大小</div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    NSDictionary *fields = httpResponse.allHeaderFields;</div><div class="line">    </div><div class="line">    //总大小的获取仅计算一次，后面断点续传不需要计算</div><div class="line">    if (_totalLength == 0) &#123;</div><div class="line">        </div><div class="line">        NSNumber *length = fields[@&quot;Content-Length&quot;];</div><div class="line">        </div><div class="line">        _totalLength = [length doubleValue];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line">    //创建NSData来保存下载的数据</div><div class="line">    _data = [[NSMutableData alloc] init];</div><div class="line">  </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data &#123;</div><div class="line">    </div><div class="line">    [_data appendData:data];</div><div class="line">    </div><div class="line">    //根据当前下载的数据包大小来刷新进度条和Label的显示</div><div class="line">    //double progress = _data.length / _totalLength;</div><div class="line">    _receivedLength += data.length;</div><div class="line">    </div><div class="line">    double progress = _receivedLength / _totalLength;</div><div class="line">    _progressLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;, progress * 100];</div><div class="line">    _progressView.progress = progress;</div><div class="line">    </div><div class="line">    //当缓冲数据包超过500K时，则写入文件</div><div class="line">    if (_data.length &gt; 500 * 1024) &#123;</div><div class="line">        </div><div class="line">        [self appendFileData:_data];</div><div class="line">        </div><div class="line">        //释放内存</div><div class="line">        [_data setData:nil];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)connectionDidFinishLoading:(NSURLConnection *)connection &#123;</div><div class="line">    </div><div class="line">    //下载完成</div><div class="line">    _isDownLoading = NO;</div><div class="line">    </div><div class="line">    [self appendFileData:_data];</div><div class="line">    //释放内存</div><div class="line">    _data.data = nil;</div><div class="line">    </div><div class="line">    self.progressLabel.text = @&quot;下载完成&quot;;</div><div class="line">    </div><div class="line">    //将下载完成的文件从临时目录剪切到目录目录</div><div class="line">    NSFileManager *manager = [NSFileManager defaultManager];</div><div class="line">    </div><div class="line">    //确定目录文件路径</div><div class="line">    NSString *targetFilePath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/%@&quot;, @&quot;file.mp3&quot;];</div><div class="line">    </div><div class="line">    //判断目标文件是否存在，如果存在把旧文件删除，准备剪切操作</div><div class="line">    if ([manager fileExistsAtPath:targetFilePath]) &#123;</div><div class="line">        [manager removeItemAtPath:targetFilePath error:nil];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //剪切方法的限制：不能把已存在文件覆盖，如果此文件存在，在剪切之前需要先删除</div><div class="line">    [manager moveItemAtPath:_filePath toPath:targetFilePath error:nil];</div><div class="line">    </div><div class="line">    //下载完成时，保存已下载数据量和文件总数据量到本地</div><div class="line">    NSUserDefaults *userDefault = [NSUserDefaults standardUserDefaults];</div><div class="line">    [userDefault setObject:@(_receivedLength) forKey:kReceivedTotal];</div><div class="line">    [userDefault setObject:@(_totalLength) forKey:kTotal];</div><div class="line">    </div><div class="line">    //把数据同步写入到plist文件</div><div class="line">    [userDefault synchronize];</div><div class="line">    </div><div class="line">    //下载完成后把已下载数据量和文件总大小清零。</div><div class="line">    _receivedLength = 0;</div><div class="line">    _totalLength = 0;  </div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>关于NSURLConnection的使用到这里也就结束，这里只是简单的介绍了NSURLConnection的使用，其实NSURLConnection的使用还有许多的使用细节，更深入的研究可以参考相应的文档，这里只是抛砖引玉，还请大家多多指教。。</p>
<p>其实，在 2013的WWDC上，苹果推出了NSURLConnection的继任者：NSURLSession，大有取代NSURLConnection之势，我们可以直接研究NSURLSession。</p>
<h3 id="AFNetworking的基本使用"><a href="#AFNetworking的基本使用" class="headerlink" title="AFNetworking的基本使用"></a>AFNetworking的基本使用</h3><h4 id="使用AFNetWorking请求网络的完整流程"><a href="#使用AFNetWorking请求网络的完整流程" class="headerlink" title="使用AFNetWorking请求网络的完整流程"></a>使用AFNetWorking请求网络的完整流程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//1.构造URL</div><div class="line">    NSString *urlString = @&quot;https://api.weibo.com/2/statuses/home_timeline.json&quot;;</div><div class="line">    //2.构造请求对象</div><div class="line">    /*</div><div class="line">     请求参数的格式：</div><div class="line">     1.JSON--&gt;AFJSONRequestSerializer</div><div class="line">     2.XML--&gt;没有给定类，需要自己进行拼接</div><div class="line">     3.KEY=VALUE--》AFHTTPRequestSerializer 默认</div><div class="line">     */</div><div class="line">    NSDictionary *params = @&#123;</div><div class="line">                             @&quot;access_token&quot; : @&quot;2.00TSa6WDewTgPDfa63e0f0883oK2XE&quot;</div><div class="line">                             &#125;;</div><div class="line">    </div><div class="line">    //请求参数格式化对象，会根据类型拼接好给定的格式</div><div class="line">    AFHTTPRequestSerializer *requestSer = [AFHTTPRequestSerializer serializer];</div><div class="line">    </div><div class="line">    //使用请求参数格式化对象来构造一个request</div><div class="line">    NSMutableURLRequest *request = [requestSer requestWithMethod:@&quot;GET&quot; URLString:urlString parameters:params error:nil];</div><div class="line">    </div><div class="line">    </div><div class="line">    //3.构造线程对象 AFHTTPRequestOperation--&gt;AFURLConnectionOPeration--&gt;NSOperation</div><div class="line">    AFHTTPRequestOperation *operation = [[AFHTTPRequestOperation alloc] initWithRequest:request];</div><div class="line">    </div><div class="line">    //4.设置从服务器返回到客户端数据的解析方式,默认是JSON解析</div><div class="line">    operation.responseSerializer = [AFJSONResponseSerializer serializerWithReadingOptions:NSJSONReadingMutableContainers];</div><div class="line">    </div><div class="line">    //5.网络请求事件的监听--&gt;请求成功和失败会回调的block</div><div class="line">    [operation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">        NSLog(@&quot;网络请求成功%@&quot;, responseObject);</div><div class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        NSLog(@&quot;网络请求失败%@&quot;,error);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //6.发送网络请求--&gt;把网络请求任务添加到任务队列中执行</div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">    [queue addOperation:operation];</div></pre></td></tr></table></figure>
<h4 id="使用manager对象来请求网络的方法"><a href="#使用manager对象来请求网络的方法" class="headerlink" title="使用manager对象来请求网络的方法"></a>使用manager对象来请求网络的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//1.获取请求管理对象</div><div class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">    </div><div class="line">    //2.设置请求参数格式化对象，确定请求参数以哪种格式进行传递拼接</div><div class="line">//    manager.requestSerializer = [AFHTTPRequestSerializer serializer];</div><div class="line">    </div><div class="line">    //3.设置返回数据格式化对象，确定返回数据以哪种格式进行解析</div><div class="line">//    manager.responseSerializer = [AFJSONResponseSerializer serializerWithReadingOptions:&lt;#(NSJSONReadingOptions)#&gt;]</div><div class="line">    </div><div class="line">    //4.网络申请</div><div class="line">    NSString *urlString = @&quot;https://api.weibo.com/2/statuses/update.json&quot;;</div><div class="line">    NSDictionary *params = @&#123;</div><div class="line">                             @&quot;status&quot; : @&quot;我在睡觉&quot;,</div><div class="line">                             @&quot;access_token&quot; : @&quot;2.00TSa6WDewTgPDfa63e0f0883oK2XE&quot;</div><div class="line">                             &#125;;</div><div class="line">    [manager POST:urlString parameters:params success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">         NSLog(@&quot;网络请求成功%@&quot;, responseObject);</div><div class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        NSLog(@&quot;网络请求失败%@&quot;,error);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<h4 id="对网络请求进行简单的封装"><a href="#对网络请求进行简单的封装" class="headerlink" title="对网络请求进行简单的封装"></a>对网络请求进行简单的封装</h4><p>首先创建一个继承NSObject的类FDWebDataRequest</p>
<p>FDWebDataRequest.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">@interface FDWebDataRequest : NSObject</div><div class="line"></div><div class="line">//使用NSURLConnection组件来做网络申请</div><div class="line">+ (void)requestData:(NSString *)urlString HTTPMethod:(NSString *)method  params:(NSMutableDictionary *)params completionHandle:(void(^)(id result))completionblock errorHandle:(void(^)(NSError *error))errorblock;</div><div class="line"></div><div class="line">//封装使用AFNetWorking来申请网络的方法（不上传文件）</div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params completionHandle:(void(^)(id result))completionblock errorHandle:(void(^)(NSError *error))errorblock;</div><div class="line"></div><div class="line"></div><div class="line">//封装上传文件的方法:data是和文件上传相关的参数</div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params data:(NSMutableDictionary *)datas completionHandle:(void(^)(id result))completionblock errorHandle:(void(^)(NSError *error))errorblock;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>FDWebDataRequest.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line">#import &quot;FDWebDataRequest.h&quot;</div><div class="line">#define BaseURL @&quot;https://api.weibo.com&quot;</div><div class="line">@implementation FDWebDataRequest</div><div class="line"></div><div class="line">+ (void)requestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params completionHandle:(void (^)(id))completionblock errorHandle:(void (^)(NSError *))errorblock&#123;</div><div class="line">    </div><div class="line">    //1.拼接URL</div><div class="line">    NSString *requestString = [BaseURL stringByAppendingString:urlString];</div><div class="line">    NSURL *url = [NSURL URLWithString:requestString];</div><div class="line">    </div><div class="line">    </div><div class="line">    //2.创建网络请求</div><div class="line">    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">    request.timeoutInterval = 60;</div><div class="line">    request.HTTPMethod = method;</div><div class="line">    </div><div class="line">    </div><div class="line">    //3.处理请求参数</div><div class="line">    //key1=value1&amp;key2=value2</div><div class="line">    NSMutableString *paramString = [NSMutableString string];</div><div class="line">    </div><div class="line">    NSArray *allKeys = params.allKeys;</div><div class="line">    </div><div class="line">    for (NSInteger i = 0; i &lt; params.count; i++) &#123;</div><div class="line">        NSString *key = allKeys[i];</div><div class="line">        NSString *value = params[key];</div><div class="line">        </div><div class="line">        [paramString appendFormat:@&quot;%@=%@&quot;,key,value];</div><div class="line">        </div><div class="line">        if (i &lt; params.count - 1) &#123;</div><div class="line">            [paramString appendString:@&quot;&amp;&quot;];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //4.GET和POST分别处理</div><div class="line">    if ([method isEqualToString:@&quot;GET&quot;]) &#123;</div><div class="line">        </div><div class="line">        //http://www.baidu.com?key1=value1&amp;key2=value2</div><div class="line">        //http://www.baidu.com?key0=value0&amp;key1=value1&amp;key2=value2</div><div class="line">        </div><div class="line">        NSString *seperate = url.query ? @&quot;&amp;&quot; : @&quot;?&quot;;</div><div class="line">        NSString *paramsURLString = [NSString stringWithFormat:@&quot;%@%@%@&quot;,requestString,seperate,paramString];</div><div class="line">        </div><div class="line">        //根据拼接好的URL进行修改</div><div class="line">        request.URL = [NSURL URLWithString:paramsURLString];</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    else if([method isEqualToString:@&quot;POST&quot;]) &#123;</div><div class="line">        //POST请求则把参数放在请求体里</div><div class="line">        NSData *bodyData = [paramString dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">        request.HTTPBody = bodyData;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //5.发送异步网络请求</div><div class="line">    </div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">    [NSURLConnection sendAsynchronousRequest:request queue:queue completionHandler:^(NSURLResponse *response, NSData *data, NSError *connectionError) &#123;</div><div class="line">        </div><div class="line">        if (connectionError) &#123;</div><div class="line">            //出现错误时回调block</div><div class="line">            errorblock(connectionError);</div><div class="line">            </div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        if (data) &#123;</div><div class="line">            </div><div class="line">            //解析JSON</div><div class="line">            NSDictionary *jsonDic = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableContainers error:nil];</div><div class="line">            </div><div class="line">            //把JSON解析后的数据返回给调用者,回调block</div><div class="line">            completionblock(jsonDic);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params completionHandle:(void (^)(id))completionblock errorHandle:(void (^)(NSError *))errorblock &#123;</div><div class="line">    //拼接URL</div><div class="line">    urlString = [BaseURL stringByAppendingString:urlString];</div><div class="line">    </div><div class="line">    //创建管理对象</div><div class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">    </div><div class="line">    //GET和POST分别处理</div><div class="line">    if ([method isEqualToString:@&quot;GET&quot;]) &#123;</div><div class="line">        </div><div class="line">        [manager GET:urlString parameters:params success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">            completionblock(responseObject);</div><div class="line">        &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">            errorblock(error);</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    else if([method isEqualToString:@&quot;POST&quot;]) &#123;</div><div class="line">        [manager POST:urlString parameters:params success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">            completionblock(responseObject);</div><div class="line">        &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">            errorblock(error);</div><div class="line">            </div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//使用multipart-formdata协议上传文件的方法：</div><div class="line">//multipart是HTTP协议为web表单新增的上传文件的协议，数据也是放在请求体中，和普通POST的区别是参数不再是key＝value格式，因此特定的数据格式。</div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params data:(NSMutableDictionary *)datas completionHandle:(void (^)(id result))completionblock errorHandle:(void (^)(NSError *error))errorblock &#123;</div><div class="line">    </div><div class="line">    //拼接URL</div><div class="line">    urlString = [BaseURL stringByAppendingString:urlString];</div><div class="line">    </div><div class="line">    //获取管理对象</div><div class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">    </div><div class="line">    </div><div class="line">    AFHTTPRequestOperation *operation = [manager POST:urlString parameters:params constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt; formData) &#123;</div><div class="line">        </div><div class="line">        //&#123;@&quot;pic&quot; : NSData(图片的二进制数据)&#125;;</div><div class="line">        </div><div class="line">        for (NSString *keyName in datas) &#123;</div><div class="line">           </div><div class="line">            //获取文件的二进制数据</div><div class="line">            NSData *data = datas[keyName];</div><div class="line">            </div><div class="line">            //需要上传的数据添加到formData中</div><div class="line">            [formData appendPartWithFileData:data name:keyName fileName:keyName mimeType:@&quot;image/jpeg&quot;];</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125; success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">        </div><div class="line">        completionblock(responseObject);</div><div class="line">        </div><div class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        errorblock(error);</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [operation setUploadProgressBlock:^(NSUInteger bytesWritten, long long totalBytesWritten, long long totalBytesExpectedToWrite) &#123;</div><div class="line">        </div><div class="line">        CGFloat progress = totalBytesWritten / (totalBytesExpectedToWrite * 1.0);</div><div class="line">        </div><div class="line">        NSLog(@&quot;已上传：%.2f&quot;, progress);</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="下面我们对上面的音频文件进行改进"><a href="#下面我们对上面的音频文件进行改进" class="headerlink" title="下面我们对上面的音频文件进行改进"></a>下面我们对上面的音频文件进行改进</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"> - (IBAction)startDownload:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    if (!isDownloading) &#123;</div><div class="line">        NSString *urlString = @&quot;http://cc.stream.qqmusic.qq.com/50450969.m4a?continfo=F6886073E0D58C26B826A7A6F02C20ED5745045FFCFDBF2D&amp;vkey=6A1FE4B71075955312B4EED3D7413AA3F0FAFBF6B31E13897B51043BD95B754982C276870A6D94720C688006886C90F3CC4683BA537FFBCA&amp;guid=238b3707a54f96885fcf9cabb0e319cda3612706&amp;fromtag=53&amp;uin=21619272&quot;;</div><div class="line">        </div><div class="line">        //NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">        </div><div class="line">        </div><div class="line">        AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">        </div><div class="line">        //设置返回数据的解析方式为不解析</div><div class="line">        manager.responseSerializer = [AFHTTPResponseSerializer serializer];</div><div class="line">        </div><div class="line">        NSString *filePath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/%@&quot;, @&quot;file.m4a&quot;];</div><div class="line">        //NSLog(@&quot;%@&quot;, filePath);</div><div class="line">        </div><div class="line">        //判断文件是否存在，如果不存在则创建</div><div class="line">        if (![[NSFileManager defaultManager] fileExistsAtPath:filePath]) &#123;</div><div class="line">            [[NSFileManager defaultManager] createFileAtPath:filePath contents:nil attributes:nil];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        </div><div class="line">        AFHTTPRequestOperation *operation = [manager GET: urlString parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">            NSLog(@&quot;下载成功&quot;);</div><div class="line">        &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">            NSLog(@&quot;下载失败&quot;);</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">        </div><div class="line">        //设置下载文件不是保存在内存，而是保存到沙盒路径下的文件中。</div><div class="line">        operation.outputStream = [NSOutputStream outputStreamToFileAtPath:filePath append:YES];</div><div class="line">        </div><div class="line">        </div><div class="line">        __weak ViewController *weakSelf = self;</div><div class="line">        [operation setDownloadProgressBlock:^(NSUInteger bytesRead, long long totalBytesRead, long long totalBytesExpectedToRead) &#123;</div><div class="line">            </div><div class="line">            </div><div class="line">            </div><div class="line">            CGFloat progress = totalBytesRead / (totalBytesExpectedToRead * 1.0);</div><div class="line">            </div><div class="line">            __strong ViewController *strongSelf = weakSelf;</div><div class="line">            </div><div class="line">            strongSelf.progressView.progress = progress;</div><div class="line">            strongSelf.progressLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;</div><div class="line">                                       , progress * 100];</div><div class="line">            </div><div class="line">        &#125;];</div><div class="line">        </div><div class="line"></div><div class="line">        </div><div class="line">        isDownloading = YES;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h5><p>我们网络请求的时候array和dictionary无法打印中文</p>
<p>解决方法</p>
<p>通过类目（NSdictionary+Log)的形式复写dictionary的descriptionWithLocale方法，把key和value进行拼接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (NSString *)descriptionWithLocale:(id)locale &#123;</div><div class="line">    NSMutableString *log = [NSMutableString stringWithFormat:@&quot;&#123;\n&quot;];</div><div class="line"></div><div class="line">    for (NSString *key in self) &#123;</div><div class="line"></div><div class="line">        NSString *value = self[key];</div><div class="line">        [log appendFormat:@&quot;    %@=%@; \n&quot;,key,value];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [log appendFormat:@&quot;&#125;&quot;];</div><div class="line">    return log;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/iOS开发-音视频/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/17/iOS开发-音视频/" itemprop="url">
                  iOS开发-音视频
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-17T16:51:19+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/17/iOS开发-音视频/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/01/17/iOS开发-音视频/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/17/iOS开发-音视频/" class="leancloud_visitors" data-flag-title="iOS开发-音视频">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h4 id="访问手机相册"><a href="#访问手机相册" class="headerlink" title="访问手机相册"></a>访问手机相册</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//只能选择单张图片</div><div class="line">    UIImagePickerController *pickVC = [[UIImagePickerController alloc] init];</div><div class="line">    </div><div class="line">    //设置相片的来源</div><div class="line">//    UIImagePickerControllerSourceTypePhotoLibrary 来自于相册库</div><div class="line">//    UIImagePickerControllerSourceTypeCamera 来自于摄像头</div><div class="line">//    UIImagePickerControllerSourceTypeSavedPhotosAlbum 来自于默认相册</div><div class="line">    pickVC.sourceType =  UIImagePickerControllerSourceTypeSavedPhotosAlbum;</div><div class="line">    </div><div class="line">    </div><div class="line">    pickVC.delegate = self;</div><div class="line">    </div><div class="line">    </div><div class="line">    //以模态视图的形式弹出</div><div class="line">    [self presentViewController:pickVC animated:YES completion:NULL];</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/01/17/iOS开发-音视频/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          
        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg"
               alt="Feyddy" />
          <p class="site-author-name" itemprop="name">Feyddy</p>
          <p class="site-description motion-element" itemprop="description">不积跬步，无以至千里；不积小流，无以成江海。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">51</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">52</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Feyddy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/新Feyddy" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Feyddy</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"feyddy"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
