<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="iOS, html5，Swift，自学" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="不积跬步，无以至千里；不积小流，无以成江海。">
<meta property="og:type" content="website">
<meta property="og:title" content="清风明心">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="清风明心">
<meta property="og:description" content="不积跬步，无以至千里；不积小流，无以成江海。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="清风明心">
<meta name="twitter:description" content="不积跬步，无以至千里；不积小流，无以成江海。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"right","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title> 清风明心 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '',
      xfbml      : true,
      version    : 'v2.6'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/zh_Hans/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>











  
  
    
  

  <div class="container one-collumn sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">清风明心</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">天下事有难易乎？为之，则难者亦易矣；不为，则易者亦难矣。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/home" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/网络编程-NSURLConnection基本用法介绍/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/17/网络编程-NSURLConnection基本用法介绍/" itemprop="url">
                  网络编程-NSURLConnection基本用法介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-17T21:17:37+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/17/网络编程-NSURLConnection基本用法介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/17/网络编程-NSURLConnection基本用法介绍/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/17/网络编程-NSURLConnection基本用法介绍/" class="leancloud_visitors" data-flag-title="网络编程-NSURLConnection基本用法介绍">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="NSURLConnection的基本使用"><a href="#NSURLConnection的基本使用" class="headerlink" title="NSURLConnection的基本使用"></a>NSURLConnection的基本使用</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>NSURLConnection 这个名字，实际上是指代的 Foundation 框架的 URL 加载系统中一系列有关联的组件：NSURLRequest、NSURLResponse、NSURLProtocol、 NSURLCache、 NSHTTPCookieStorage、NSURLCredentialStorage 以及同名类 NSURLConnection。</p>
<h4 id="NSURLConnection常用的类"><a href="#NSURLConnection常用的类" class="headerlink" title="NSURLConnection常用的类"></a><strong>NSURLConnection常用的类</strong></h4><p>1、NSURL：根据url生成的请求地址</p>
<p>2、NSURLRequest：封装的一个请求，携带发送给服务器的全部数据，里面包含一个NSURL对象，请求方法，请求头，请求体等等。。</p>
<p>3、NSMutableURLRequest：这个是NSURLRequest的子类，通过名字我们可以看出这是一个可变的对象，我们可以在这里自定义设置发送的服务器的全部数据（超市等待时间、请求方法、请求体、请求头）</p>
<p>4、NSURLResponse：服务的响应类，和NSURLRequest对象，包含服务返回的响应头部数据</p>
<p>5、NSURLConnection：负责发送请求，建立客户端和服务器的连接。发送NSURLRequest的数据给服务器，并收集来自服务器的响应头部数据NSURLResponse或者NSData</p>
<h4 id="NSURLConnection使用步骤"><a href="#NSURLConnection使用步骤" class="headerlink" title="NSURLConnection使用步骤"></a><strong>NSURLConnection使用步骤</strong></h4><p>1、根据url创建一个NSURL对象</p>
<p>2、根据创建的NSURL创建一个NSURLRequest对象，创建请求对象（此对象内容全部都是默认值，如：请求方法默认是GET），如果想要自定数据则创建NSMutableURLRequest对象</p>
<p>3、最后使用NSURLConnection发送创建好的NSURLRequest或者NSMutableURLRequest对象，与服务器建立链接</p>
<h6 id="非代理模式"><a href="#非代理模式" class="headerlink" title="非代理模式"></a><strong>非代理模式</strong></h6><p>非代理模式中有提供了两个方法同步请求和异步请求(block实现)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div></pre></td><td class="code"><pre><div class="line">    //1.设置访问的url地址</div><div class="line">    self.imageUrl = @&quot;http://7xt5rm.com2.z0.glb.clouddn.com/picjumbo.com_download.jpg&quot;;</div><div class="line">    //根据url生成的NSURL请求地址</div><div class="line">    NSURL *URL = [NSURL URLWithString:self.imageUrl];</div><div class="line">    //2.创建请求对象(NSMutableURLRequest)</div><div class="line">    self.request = [NSMutableURLRequest requestWithURL:URL];</div><div class="line"></div><div class="line">    //3.设置请求相关的信息</div><div class="line">    //设置请求方式，默认是GET请求</div><div class="line">    request.HTTPMethod = @&quot;GET&quot;;</div><div class="line">    //设置请求超时时间</div><div class="line">    request.timeoutInterval = 60;</div><div class="line"></div><div class="line">    //设置请求头</div><div class="line">    //request.allHTTPHeaderFields = @&#123;</div><div class="line">                                    </div><div class="line">    //                               &#125;;</div><div class="line">    //如果之前的key被设置过，则此方法会用新值覆盖旧值。</div><div class="line">    [request setValue:@&quot;User_Agent&quot; forHTTPHeaderField:@&quot;safari&quot;];</div><div class="line">    //如果之前的key被设置过，则此方法会将新值附加在旧值后，并用合适的符号分隔</div><div class="line">    //[request addValue:&lt;#(NSString *)#&gt; forHTTPHeaderField:&lt;#(NSString *)#&gt;];</div><div class="line">    //设置请求体(get方法没有)</div><div class="line"></div><div class="line">	</div><div class="line"></div><div class="line"></div><div class="line">    //发送同步请求 同步请求在主线程中执行 会一直在等待服务器返回数据，会阻塞主线程的执行，如果服务器没有返回数据，那么在主线程UI会卡住不能继续执行操作</div><div class="line">    //不建议这么做</div><div class="line">    //4.构造NSURLConnection，发送请求</div><div class="line">    NSURLResponse *response = nil;</div><div class="line">    NSError *error = nil;</div><div class="line">    NSData *data = [NSURLConnection sendSynchronousRequest:request returningResponse:&amp;response error:&amp;error];</div><div class="line"></div><div class="line">    //5.获取响应头信息</div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    </div><div class="line">    //获取状态码</div><div class="line">    NSInteger statusCode = httpResponse.statusCode;</div><div class="line">    NSLog(@&quot;状态码:%li&quot;, statusCode);</div><div class="line">    </div><div class="line">    //响应头</div><div class="line">    NSLog(@&quot;响应头:%@&quot;, httpResponse.allHeaderFields);</div><div class="line">    </div><div class="line">    </div><div class="line">    //6.获取响应数据信息</div><div class="line">    if (data != nil) &#123;</div><div class="line">        NSString *jsonString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];</div><div class="line">        _textView.text = jsonString;</div><div class="line">        //JSON解析</div><div class="line">        NSDictionary *dic = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableContainers error:nil];</div><div class="line">        NSLog(@&quot;dic:%@&quot;, dic);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSLog(@&quot;data length = %lu&quot;,(unsigned long)data.length);</div><div class="line"></div><div class="line">    ------------------------------------------------------------------</div><div class="line"></div><div class="line">    //发送异步请求 </div><div class="line">      </div><div class="line">      </div><div class="line">    //3.设置请求体：POST请求的请求参数是放在请求体中的。</div><div class="line">    </div><div class="line">    NSString *paraText = @&quot;cinema_id=1533&quot;;</div><div class="line">    </div><div class="line">    request.HTTPBody = [paraText dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">    </div><div class="line">    //设置压缩策略</div><div class="line">    [request setValue:@&quot;gzip&quot; forHTTPHeaderField:@&quot;Accept-Encoding&quot;];</div><div class="line">    </div><div class="line">    //缓存策略</div><div class="line">    request.cachePolicy = NSURLRequestReturnCacheDataElseLoad;</div><div class="line"></div><div class="line"></div><div class="line">    //异步请求需要一个队列来负责回调代码块的执行，当获取到返回数据是，会在这个线程队列中执行代码块，这里我们使用主队列，</div><div class="line">    NSOperationQueue *queue=[NSOperationQueue mainQueue];</div><div class="line">    //异步请求传入一个^(NSURLResponse *response,NSData *data, NSError *connectionError)block代码块，当请求数据返回时，执行此代码块，此代码块有三个参数，respons响应头 data返回数据 connectionError错误代码</div><div class="line">    [NSURLConnection sendAsynchronousRequest:self.request queue:queue completionHandler:^(NSURLResponse *response,NSData *data, NSError *connectionError)&#123;</div><div class="line">       NSLog(@&quot;response = %@&quot;,response);</div><div class="line">       NSLog(@&quot;data = %@&quot;,data);</div><div class="line">       NSLog(@&quot;error = %@&quot;,connectionError);</div><div class="line">       if (connectionError) &#123;</div><div class="line">            return;</div><div class="line">        &#125;        </div><div class="line">        NSString *jsonString = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];</div><div class="line">        </div><div class="line">        //回到主线程更新UI.</div><div class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">            _textView.text = jsonString;</div><div class="line">        &#125;);</div><div class="line"></div><div class="line">    &#125;];</div><div class="line"></div><div class="line"></div><div class="line">//5.如何监听网络传输的进度，使用另一种发送异步请求的方式</div><div class="line">    //构建一个connection对象</div><div class="line">    NSURLConnection *connection = [NSURLConnection connectionWithRequest:request delegate:self];</div><div class="line">    </div><div class="line"></div><div class="line">    </div><div class="line">    //利用代理对象的协议方法来监听网络传输进度,所有的协议方法是在主线程被回调的，但是网络请求的过程是在多线程中处理的。</div></pre></td></tr></table></figure>
<h6 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a><strong>代理模式</strong></h6><p>使用代理模式需要实现NSURLConnectionDataDelegate协议，此协议提供了几个代理方法，涵盖了请求交互的几个步骤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">#pragma mark - NSURLConnection delegate</div><div class="line"></div><div class="line">//网络请求失败会调用的协议方法</div><div class="line">- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;网络请求失败：%@&quot;, error);</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//获取到响应头时会调用的协议方法</div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response &#123;</div><div class="line">    </div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    </div><div class="line">    //获取状态码</div><div class="line">    NSInteger statusCode = httpResponse.statusCode;</div><div class="line">    NSLog(@&quot;状态码:%li&quot;, statusCode);</div><div class="line">    </div><div class="line">    //响应头</div><div class="line">    NSLog(@&quot;响应头:%@&quot;, httpResponse.allHeaderFields);</div><div class="line">    </div><div class="line">    //定义NSData用来接收数据包</div><div class="line">     _receivedData = [[NSMutableData alloc] init];</div><div class="line"></div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//接收数据时会调用的协议方法，此方法可能被调用多次</div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data &#123;</div><div class="line">    </div><div class="line">    //将每次接收到的数据包附加在_receivedData后</div><div class="line">    [_receivedData appendData:data];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//接收数据完毕时会被调用的协议方法</div><div class="line">- (void)connectionDidFinishLoading:(NSURLConnection *)connection &#123;</div><div class="line">    //将接收到的所有数据转化为NSString</div><div class="line">    </div><div class="line">    NSString *jsonString = [[NSString alloc] initWithData:_receivedData encoding:NSUTF8StringEncoding];</div><div class="line">    </div><div class="line">    _textView.text = jsonString;</div><div class="line"></div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//上传文件时调用的协议方法</div><div class="line">- (void)connection:(NSURLConnection *)connection didSendBodyData:(NSInteger)bytesWritten totalBytesWritten:(NSInteger)totalBytesWritten totalBytesExpectedToWrite:(NSInteger)totalBytesExpectedToWrite &#123;</div><div class="line">    </div><div class="line">//    bytesWritten：本次上传数据字节数</div><div class="line">//    totalBytesWritten:累加上传数据字节数</div><div class="line">//    totalBytesExpectedToWrite :上传文件总字节数</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="音频下载"><a href="#音频下载" class="headerlink" title="音频下载"></a>音频下载</h4><p>接收500KB的数据就写入文件，释放其所占内存，以达到节约内存的目的。</p>
<p>ViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController</div><div class="line">@property (weak, nonatomic) IBOutlet UILabel *progressLabel;</div><div class="line">@property (weak, nonatomic) IBOutlet UIProgressView *progressView;</div><div class="line">- (IBAction)startDownload:(UIButton *)sender;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()&lt;NSURLConnectionDelegate,NSURLConnectionDataDelegate&gt;</div><div class="line">&#123;</div><div class="line">    double _totalLength;//文件大小</div><div class="line">    double _receivedLength;//累加接受的数据的大小</div><div class="line">    NSMutableData *_totalData;//保存下载数据</div><div class="line">    BOOL _isLoading;//文件是否正在下载</div><div class="line">    NSString *_path;//下载文件的路径</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    _isLoading = NO;</div><div class="line">&#125;</div><div class="line">- (IBAction)startLoad:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    if (!_isLoading) &#123;</div><div class="line">        </div><div class="line">        //构造URL</div><div class="line">        NSURL *url = [NSURL URLWithString:@&quot;http://ws.stream.qqmusic.qq.com/59077847.m4a?continfo=73820346915A0B48DECCA0B4538EBAE8D0A505A652637707&amp;vkey=6601BF6508BEFF1A0B01887E58B6B38F63DB66AB2F16AFC2BB3510F0D979BADCC4F156907B95311B963170DFDDE231C33AEC78F6447259D9&amp;guid=beebe00086eb6ea85ed23db8d2d97e12f0214a04&amp;fromtag=53&amp;uin=837223065&quot;];</div><div class="line">        </div><div class="line">        //构造request</div><div class="line">        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">        </div><div class="line">        //发送异步网络请求</div><div class="line">        [NSURLConnection connectionWithRequest:request delegate:self];</div><div class="line">        _isLoading = YES;</div><div class="line">        </div><div class="line">        //创建空文件夹来保存下载下来的数据</div><div class="line">        </div><div class="line">        //设置文件名</div><div class="line">        NSString *file = @&quot;白龙马.mp3&quot;;</div><div class="line">        //设置文件路径</div><div class="line">        _path = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/%@&quot;,file];</div><div class="line">        </div><div class="line">        NSLog(@&quot;%@&quot;,_path);</div><div class="line">        </div><div class="line">        //创建空文件夹</div><div class="line">        [[NSFileManager defaultManager]createFileAtPath:_path contents:nil attributes:nil];</div><div class="line">        </div><div class="line">    &#125;   </div><div class="line">&#125;</div><div class="line"></div><div class="line">//把数据写入文件并到文件的末尾</div><div class="line">-(void)addFile:(NSData *)data</div><div class="line">&#123;</div><div class="line">    if (data.length ==0 || _path.length == 0) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //创建文件句柄</div><div class="line">    NSFileHandle *fileHandle = [NSFileHandle fileHandleForWritingAtPath:_path];</div><div class="line">    </div><div class="line">    //把文件位置放到文件最后</div><div class="line">    [fileHandle seekToEndOfFile];</div><div class="line">    </div><div class="line">    //写入数据</div><div class="line">    [fileHandle writeData:data];</div><div class="line">    </div><div class="line">    //关闭文件</div><div class="line">    [fileHandle closeFile];</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - NSURLConnectionDelegate</div><div class="line"></div><div class="line">-(void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response</div><div class="line">&#123;</div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    </div><div class="line">    NSDictionary *fields = httpResponse.allHeaderFields;</div><div class="line">    </div><div class="line">    //获取下载文件大小</div><div class="line">    NSNumber *length = fields[@&quot;content-Length&quot;];</div><div class="line">    </div><div class="line">    _totalLength = [length doubleValue];</div><div class="line">    </div><div class="line">    _receivedLength = 0;//清零</div><div class="line">    </div><div class="line">    _totalData = [[NSMutableData alloc]init];</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data</div><div class="line">&#123;</div><div class="line">    </div><div class="line">    [_totalData appendData:data];</div><div class="line">    </div><div class="line">    //通过当前下载的文件的大小来刷新显示</div><div class="line">    _receivedLength += data.length;</div><div class="line">    double progress = _receivedLength / _totalLength;</div><div class="line">    </div><div class="line">    //刷新UI</div><div class="line">    self.loadLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;,progress*100];</div><div class="line">    </div><div class="line">    self.progressView.progress = progress;</div><div class="line">    </div><div class="line">    //当缓冲的数据超过500KB时，写入数据</div><div class="line">    if (_totalData.length &gt; 500 * 1024) &#123;</div><div class="line">        [self addFile:_totalData];</div><div class="line">        </div><div class="line">        //释放内存</div><div class="line">        _totalData.data = nil;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)connectionDidFinishLoading:(NSURLConnection *)connection</div><div class="line">&#123;</div><div class="line">    //下载完后将文件保存在本地文件夹中 </div><div class="line">    [self addFile:_totalData];</div><div class="line">    </div><div class="line">    //释放内存</div><div class="line">    _totalData.data = nil;</div><div class="line">    </div><div class="line">    self.loadLabel.text = @&quot;Succeese&quot;;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="断点续传"><a href="#断点续传" class="headerlink" title="断点续传"></a>断点续传</h4><p>有时候数据文件比较大，我们一次不一定能够全部下载，如果之前下载了一部分，之后我们又要下载的话，在重头开始有点不太合适，这时候我们应该如何做呢。。</p>
<p>现在的下载一般是用<code>http</code>协议，<code>http</code>协议的头部有个字段<code>Range</code>，可以满足我们的需求。</p>
<p><code>Range</code>用于请求头中，指定第一个字节的位置和最后一个字节的位置，一般格式：</p>
<p><code>Range:(unit=first byte pos)-[last byte pos]</code></p>
<p>当我们暂停下载的时候我们可以在代理方法<code>- (void)connection:(NSURLConnection *)connection didReceiveData:(nonnull NSData *)data</code>中记录已下载数据的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(nonnull NSData *)data&#123;</div><div class="line">            NSLog(@&quot;接受数据中。。。。。%lu&quot;,(unsigned long)data.length);</div><div class="line">            //要把每一次接收到的数据拼接起来</div><div class="line">        [self.imageData appendData:data];</div><div class="line">        //记录已下载数据的大小</div><div class="line">        range = range + data.length;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>然后在再次下载的时候设置<code>HTTP</code>的<code>Range</code>头部,注意此时<strong>request需要是NSMutableURLRequest对象</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> //设置请求数据范围</div><div class="line">NSString *rangeValue = [NSString stringWithFormat:@&quot;bytes=%llu-&quot;, range];</div><div class="line">[self.request setValue:rangeValue forHTTPHeaderField:@&quot;Range&quot;];</div><div class="line">[self.request setCachePolicy:NSURLRequestReloadIgnoringLocalCacheData];</div><div class="line">self.connection = [NSURLConnection connectionWithRequest:self.request delegate:self];</div></pre></td></tr></table></figure>
<p>下面做个完整的小demo</p>
<p>需求如下：</p>
<ol>
<li><p>内存优化</p>
<p>当下载数据量达到500KB时，就写入文件，释放内存。</p>
<p>(1)创建空文件保存下载数据。</p>
<p>(2)当下载数据量达到500K时，把数据附加到文件末尾</p>
</li>
</ol>
<ol>
<li><p>断点续传</p>
<p>（1）可以暂停下载，暂停下载时，客户端要记载下载的暂停位置，记录在本地的文件中。</p>
<p>（2）程序退出后，再次进入到此程序中，仍然能从上次下载的暂停位置开始下载。</p>
<p>（3）安全文件操作思想：一个目标目录，一个临时目录，当文件下载未完成时，保存临时文件在临时目录，直到文件下载完成，把此下载完成的临时文件剪切到目标目录。</p>
<p>目标目录：/Documents</p>
<p>临时目录：/Documents/tmp</p>
<p>（4）客户端通过设置请求头来通知服务器继续下载的起始位置</p>
<p>Range:bytes=0-499 表示下载头500个字节</p>
<p>Range:bytes=500-999 表示下载第二个500个字节</p>
<p>Range:bytes=-500 表示下载最后一个500个字节</p>
<p>Range:bytes=500- 表示下载500字节以后内容</p>
<p>Range:bytes=0-0,-1 表示下载第一个字节和最后一个字节</p>
</li>
</ol>
<p>ViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController &lt;NSURLConnectionDelegate, NSURLConnectionDataDelegate&gt;</div><div class="line">@property (weak, nonatomic) IBOutlet UILabel *progressLabel;</div><div class="line">@property (weak, nonatomic) IBOutlet UIProgressView *progressView;</div><div class="line">- (IBAction)startDownload:(UIButton *)sender;</div><div class="line">- (IBAction)cancelDownload:(UIButton *)sender;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#define  kReceivedTotal @&quot;receivedTotal&quot;</div><div class="line">#define kTotal @&quot;total&quot;</div><div class="line">@interface ViewController () &#123;</div><div class="line">    BOOL _isDownLoading; //是否正在下载</div><div class="line">    double _totalLength; //文件大小</div><div class="line">    double _receivedLength; //累加接收的数据包大小</div><div class="line">    NSMutableData *_data; //保存下载数据</div><div class="line">    NSString *_filePath; //临时文件的路径</div><div class="line">    </div><div class="line">    //全局连接对象，用它来取消下载</div><div class="line">    NSURLConnection *_connection;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    //读取本地化的plist文件，获取已下载数据量和文件总大小</div><div class="line">    NSUserDefaults *userDefault = [NSUserDefaults standardUserDefaults];</div><div class="line">    </div><div class="line">//    NSLog(@&quot;userDefault:%@&quot;,userDefault);</div><div class="line">    </div><div class="line">    _receivedLength = [[userDefault objectForKey:kReceivedTotal] doubleValue];</div><div class="line">    _totalLength = [[userDefault objectForKey:kTotal] doubleValue];</div><div class="line">    </div><div class="line">    if (_totalLength &gt; 0) &#123;</div><div class="line">        double progress = _receivedLength / _totalLength;</div><div class="line">        _progressLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;, progress * 100];</div><div class="line">        _progressView.progress = progress;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (IBAction)startDownload:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    if (!_isDownLoading) &#123;</div><div class="line">        </div><div class="line">        //构造URL</div><div class="line">        NSURL *url = [NSURL URLWithString:@&quot;http://music.baidu.com/data/music/file?link=http://yinyueshiting.baidu.com/data2/music/134371896/12313247982800128.mp3?xcode=ffec71a6b8c89b0a0c0d8753917afb85&amp;song_id=123132479&quot;];</div><div class="line">        </div><div class="line">        //构造reuqest</div><div class="line">        NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">        </div><div class="line">        //通过http下载请求头来设置继续下载的位置</div><div class="line">        NSString *value = [NSString stringWithFormat:@&quot;bytes=%i-&quot;, (int)_receivedLength];</div><div class="line"></div><div class="line">        [request setValue:value forHTTPHeaderField:@&quot;Range&quot;];</div><div class="line">        </div><div class="line">        NSLog(@&quot;继续下载:%@&quot;, request.allHTTPHeaderFields);</div><div class="line">        </div><div class="line">        //发送异步网络请求</div><div class="line">        _connection = [NSURLConnection connectionWithRequest:request delegate:self];</div><div class="line">        </div><div class="line">        //此时正在下载</div><div class="line">        _isDownLoading = YES;</div><div class="line">        </div><div class="line">        //创建临时目录</div><div class="line">        _filePath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/tmp/%@&quot;, @&quot;file.mp3&quot;];</div><div class="line">        </div><div class="line">        NSLog(@&quot;%@&quot;, _filePath);</div><div class="line">        //判断临时文件是否存在，如果不存在则创建</div><div class="line">        if (![[NSFileManager defaultManager] fileExistsAtPath:_filePath]) &#123;</div><div class="line">            //先创建临时文件夹</div><div class="line">            NSString *dirPath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/tmp&quot;];</div><div class="line">            </div><div class="line">            [[NSFileManager defaultManager] createDirectoryAtPath:dirPath withIntermediateDirectories:YES attributes:nil error:nil];</div><div class="line">            //创建空的临时文件</div><div class="line">            [[NSFileManager defaultManager] createFileAtPath:_filePath contents:nil attributes:nil];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (IBAction)cancelDownload:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    //取消下载</div><div class="line">    [_connection cancel];</div><div class="line">    </div><div class="line">    //把数据包存入文件</div><div class="line">    [self appendFileData:_data];</div><div class="line">    //释放内存</div><div class="line">    _data.data = nil;</div><div class="line">    </div><div class="line">    [_data setData:nil];</div><div class="line">    </div><div class="line">    _isDownLoading = NO;</div><div class="line">    </div><div class="line">    //暂停时，保存已下载数据量和文件总数据量到本地，保证程序退出后下次进入仍能实现断点续传</div><div class="line">    NSUserDefaults *userDefault = [NSUserDefaults standardUserDefaults];</div><div class="line">    [userDefault setObject:@(_receivedLength) forKey:kReceivedTotal];</div><div class="line">    [userDefault setObject:@(_totalLength) forKey:kTotal];</div><div class="line"></div><div class="line">    //把数据同步写入到plist文件</div><div class="line">    [userDefault synchronize];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//封装把数据写入文件，附加到文件的末尾的方法</div><div class="line">- (void)appendFileData:(NSData *)data &#123;</div><div class="line">    </div><div class="line">    if (data.length == 0 || _filePath.length == 0 ) &#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    //(1)创建文件句柄</div><div class="line">    NSFileHandle *fileHandle = [NSFileHandle fileHandleForWritingAtPath:_filePath];</div><div class="line">    </div><div class="line">    //（2）把文件位置指针定位到末尾</div><div class="line">    [fileHandle seekToEndOfFile];</div><div class="line">    </div><div class="line">    //（3）写入数据</div><div class="line">    [fileHandle writeData:data];</div><div class="line">    </div><div class="line">    //(4)关闭文件</div><div class="line">    [fileHandle closeFile];</div><div class="line">    </div><div class="line">&#125;</div><div class="line">#pragma mark - NSURLConnection delegate</div><div class="line"></div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response &#123;</div><div class="line">    </div><div class="line">    //获取要下载的文件的大小</div><div class="line">    NSHTTPURLResponse *httpResponse = (NSHTTPURLResponse *)response;</div><div class="line">    NSDictionary *fields = httpResponse.allHeaderFields;</div><div class="line">    </div><div class="line">    //总大小的获取仅计算一次，后面断点续传不需要计算</div><div class="line">    if (_totalLength == 0) &#123;</div><div class="line">        </div><div class="line">        NSNumber *length = fields[@&quot;Content-Length&quot;];</div><div class="line">        </div><div class="line">        _totalLength = [length doubleValue];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    </div><div class="line">    //创建NSData来保存下载的数据</div><div class="line">    _data = [[NSMutableData alloc] init];</div><div class="line">  </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data &#123;</div><div class="line">    </div><div class="line">    [_data appendData:data];</div><div class="line">    </div><div class="line">    //根据当前下载的数据包大小来刷新进度条和Label的显示</div><div class="line">    //double progress = _data.length / _totalLength;</div><div class="line">    _receivedLength += data.length;</div><div class="line">    </div><div class="line">    double progress = _receivedLength / _totalLength;</div><div class="line">    _progressLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;, progress * 100];</div><div class="line">    _progressView.progress = progress;</div><div class="line">    </div><div class="line">    //当缓冲数据包超过500K时，则写入文件</div><div class="line">    if (_data.length &gt; 500 * 1024) &#123;</div><div class="line">        </div><div class="line">        [self appendFileData:_data];</div><div class="line">        </div><div class="line">        //释放内存</div><div class="line">        [_data setData:nil];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)connectionDidFinishLoading:(NSURLConnection *)connection &#123;</div><div class="line">    </div><div class="line">    //下载完成</div><div class="line">    _isDownLoading = NO;</div><div class="line">    </div><div class="line">    [self appendFileData:_data];</div><div class="line">    //释放内存</div><div class="line">    _data.data = nil;</div><div class="line">    </div><div class="line">    self.progressLabel.text = @&quot;下载完成&quot;;</div><div class="line">    </div><div class="line">    //将下载完成的文件从临时目录剪切到目录目录</div><div class="line">    NSFileManager *manager = [NSFileManager defaultManager];</div><div class="line">    </div><div class="line">    //确定目录文件路径</div><div class="line">    NSString *targetFilePath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/%@&quot;, @&quot;file.mp3&quot;];</div><div class="line">    </div><div class="line">    //判断目标文件是否存在，如果存在把旧文件删除，准备剪切操作</div><div class="line">    if ([manager fileExistsAtPath:targetFilePath]) &#123;</div><div class="line">        [manager removeItemAtPath:targetFilePath error:nil];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //剪切方法的限制：不能把已存在文件覆盖，如果此文件存在，在剪切之前需要先删除</div><div class="line">    [manager moveItemAtPath:_filePath toPath:targetFilePath error:nil];</div><div class="line">    </div><div class="line">    //下载完成时，保存已下载数据量和文件总数据量到本地</div><div class="line">    NSUserDefaults *userDefault = [NSUserDefaults standardUserDefaults];</div><div class="line">    [userDefault setObject:@(_receivedLength) forKey:kReceivedTotal];</div><div class="line">    [userDefault setObject:@(_totalLength) forKey:kTotal];</div><div class="line">    </div><div class="line">    //把数据同步写入到plist文件</div><div class="line">    [userDefault synchronize];</div><div class="line">    </div><div class="line">    //下载完成后把已下载数据量和文件总大小清零。</div><div class="line">    _receivedLength = 0;</div><div class="line">    _totalLength = 0;  </div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>关于NSURLConnection的使用到这里也就结束，这里只是简单的介绍了NSURLConnection的使用，其实NSURLConnection的使用还有许多的使用细节，更深入的研究可以参考相应的文档，这里只是抛砖引玉，还请大家多多指教。。</p>
<p>其实，在 2013的WWDC上，苹果推出了NSURLConnection的继任者：NSURLSession，大有取代NSURLConnection之势，我们可以直接研究NSURLSession。</p>
<h3 id="AFNetworking的基本使用"><a href="#AFNetworking的基本使用" class="headerlink" title="AFNetworking的基本使用"></a>AFNetworking的基本使用</h3><h4 id="使用AFNetWorking请求网络的完整流程"><a href="#使用AFNetWorking请求网络的完整流程" class="headerlink" title="使用AFNetWorking请求网络的完整流程"></a>使用AFNetWorking请求网络的完整流程</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//1.构造URL</div><div class="line">    NSString *urlString = @&quot;https://api.weibo.com/2/statuses/home_timeline.json&quot;;</div><div class="line">    //2.构造请求对象</div><div class="line">    /*</div><div class="line">     请求参数的格式：</div><div class="line">     1.JSON--&gt;AFJSONRequestSerializer</div><div class="line">     2.XML--&gt;没有给定类，需要自己进行拼接</div><div class="line">     3.KEY=VALUE--》AFHTTPRequestSerializer 默认</div><div class="line">     */</div><div class="line">    NSDictionary *params = @&#123;</div><div class="line">                             @&quot;access_token&quot; : @&quot;2.00TSa6WDewTgPDfa63e0f0883oK2XE&quot;</div><div class="line">                             &#125;;</div><div class="line">    </div><div class="line">    //请求参数格式化对象，会根据类型拼接好给定的格式</div><div class="line">    AFHTTPRequestSerializer *requestSer = [AFHTTPRequestSerializer serializer];</div><div class="line">    </div><div class="line">    //使用请求参数格式化对象来构造一个request</div><div class="line">    NSMutableURLRequest *request = [requestSer requestWithMethod:@&quot;GET&quot; URLString:urlString parameters:params error:nil];</div><div class="line">    </div><div class="line">    </div><div class="line">    //3.构造线程对象 AFHTTPRequestOperation--&gt;AFURLConnectionOPeration--&gt;NSOperation</div><div class="line">    AFHTTPRequestOperation *operation = [[AFHTTPRequestOperation alloc] initWithRequest:request];</div><div class="line">    </div><div class="line">    //4.设置从服务器返回到客户端数据的解析方式,默认是JSON解析</div><div class="line">    operation.responseSerializer = [AFJSONResponseSerializer serializerWithReadingOptions:NSJSONReadingMutableContainers];</div><div class="line">    </div><div class="line">    //5.网络请求事件的监听--&gt;请求成功和失败会回调的block</div><div class="line">    [operation setCompletionBlockWithSuccess:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">        NSLog(@&quot;网络请求成功%@&quot;, responseObject);</div><div class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        NSLog(@&quot;网络请求失败%@&quot;,error);</div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    //6.发送网络请求--&gt;把网络请求任务添加到任务队列中执行</div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">    [queue addOperation:operation];</div></pre></td></tr></table></figure>
<h4 id="使用manager对象来请求网络的方法"><a href="#使用manager对象来请求网络的方法" class="headerlink" title="使用manager对象来请求网络的方法"></a>使用manager对象来请求网络的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">//1.获取请求管理对象</div><div class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">    </div><div class="line">    //2.设置请求参数格式化对象，确定请求参数以哪种格式进行传递拼接</div><div class="line">//    manager.requestSerializer = [AFHTTPRequestSerializer serializer];</div><div class="line">    </div><div class="line">    //3.设置返回数据格式化对象，确定返回数据以哪种格式进行解析</div><div class="line">//    manager.responseSerializer = [AFJSONResponseSerializer serializerWithReadingOptions:&lt;#(NSJSONReadingOptions)#&gt;]</div><div class="line">    </div><div class="line">    //4.网络申请</div><div class="line">    NSString *urlString = @&quot;https://api.weibo.com/2/statuses/update.json&quot;;</div><div class="line">    NSDictionary *params = @&#123;</div><div class="line">                             @&quot;status&quot; : @&quot;我在睡觉&quot;,</div><div class="line">                             @&quot;access_token&quot; : @&quot;2.00TSa6WDewTgPDfa63e0f0883oK2XE&quot;</div><div class="line">                             &#125;;</div><div class="line">    [manager POST:urlString parameters:params success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">         NSLog(@&quot;网络请求成功%@&quot;, responseObject);</div><div class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        NSLog(@&quot;网络请求失败%@&quot;,error);</div><div class="line">    &#125;];</div></pre></td></tr></table></figure>
<h4 id="对网络请求进行简单的封装"><a href="#对网络请求进行简单的封装" class="headerlink" title="对网络请求进行简单的封装"></a>对网络请求进行简单的封装</h4><p>首先创建一个继承NSObject的类FDWebDataRequest</p>
<p>FDWebDataRequest.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line">@interface FDWebDataRequest : NSObject</div><div class="line"></div><div class="line">//使用NSURLConnection组件来做网络申请</div><div class="line">+ (void)requestData:(NSString *)urlString HTTPMethod:(NSString *)method  params:(NSMutableDictionary *)params completionHandle:(void(^)(id result))completionblock errorHandle:(void(^)(NSError *error))errorblock;</div><div class="line"></div><div class="line">//封装使用AFNetWorking来申请网络的方法（不上传文件）</div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params completionHandle:(void(^)(id result))completionblock errorHandle:(void(^)(NSError *error))errorblock;</div><div class="line"></div><div class="line"></div><div class="line">//封装上传文件的方法:data是和文件上传相关的参数</div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params data:(NSMutableDictionary *)datas completionHandle:(void(^)(id result))completionblock errorHandle:(void(^)(NSError *error))errorblock;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>FDWebDataRequest.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div></pre></td><td class="code"><pre><div class="line">#import &quot;FDWebDataRequest.h&quot;</div><div class="line">#define BaseURL @&quot;https://api.weibo.com&quot;</div><div class="line">@implementation FDWebDataRequest</div><div class="line"></div><div class="line">+ (void)requestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params completionHandle:(void (^)(id))completionblock errorHandle:(void (^)(NSError *))errorblock&#123;</div><div class="line">    </div><div class="line">    //1.拼接URL</div><div class="line">    NSString *requestString = [BaseURL stringByAppendingString:urlString];</div><div class="line">    NSURL *url = [NSURL URLWithString:requestString];</div><div class="line">    </div><div class="line">    </div><div class="line">    //2.创建网络请求</div><div class="line">    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">    request.timeoutInterval = 60;</div><div class="line">    request.HTTPMethod = method;</div><div class="line">    </div><div class="line">    </div><div class="line">    //3.处理请求参数</div><div class="line">    //key1=value1&amp;key2=value2</div><div class="line">    NSMutableString *paramString = [NSMutableString string];</div><div class="line">    </div><div class="line">    NSArray *allKeys = params.allKeys;</div><div class="line">    </div><div class="line">    for (NSInteger i = 0; i &lt; params.count; i++) &#123;</div><div class="line">        NSString *key = allKeys[i];</div><div class="line">        NSString *value = params[key];</div><div class="line">        </div><div class="line">        [paramString appendFormat:@&quot;%@=%@&quot;,key,value];</div><div class="line">        </div><div class="line">        if (i &lt; params.count - 1) &#123;</div><div class="line">            [paramString appendString:@&quot;&amp;&quot;];</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //4.GET和POST分别处理</div><div class="line">    if ([method isEqualToString:@&quot;GET&quot;]) &#123;</div><div class="line">        </div><div class="line">        //http://www.baidu.com?key1=value1&amp;key2=value2</div><div class="line">        //http://www.baidu.com?key0=value0&amp;key1=value1&amp;key2=value2</div><div class="line">        </div><div class="line">        NSString *seperate = url.query ? @&quot;&amp;&quot; : @&quot;?&quot;;</div><div class="line">        NSString *paramsURLString = [NSString stringWithFormat:@&quot;%@%@%@&quot;,requestString,seperate,paramString];</div><div class="line">        </div><div class="line">        //根据拼接好的URL进行修改</div><div class="line">        request.URL = [NSURL URLWithString:paramsURLString];</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    else if([method isEqualToString:@&quot;POST&quot;]) &#123;</div><div class="line">        //POST请求则把参数放在请求体里</div><div class="line">        NSData *bodyData = [paramString dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line">        request.HTTPBody = bodyData;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    //5.发送异步网络请求</div><div class="line">    </div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">    [NSURLConnection sendAsynchronousRequest:request queue:queue completionHandler:^(NSURLResponse *response, NSData *data, NSError *connectionError) &#123;</div><div class="line">        </div><div class="line">        if (connectionError) &#123;</div><div class="line">            //出现错误时回调block</div><div class="line">            errorblock(connectionError);</div><div class="line">            </div><div class="line">            return;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        if (data) &#123;</div><div class="line">            </div><div class="line">            //解析JSON</div><div class="line">            NSDictionary *jsonDic = [NSJSONSerialization JSONObjectWithData:data options:NSJSONReadingMutableContainers error:nil];</div><div class="line">            </div><div class="line">            //把JSON解析后的数据返回给调用者,回调block</div><div class="line">            completionblock(jsonDic);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params completionHandle:(void (^)(id))completionblock errorHandle:(void (^)(NSError *))errorblock &#123;</div><div class="line">    //拼接URL</div><div class="line">    urlString = [BaseURL stringByAppendingString:urlString];</div><div class="line">    </div><div class="line">    //创建管理对象</div><div class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">    </div><div class="line">    //GET和POST分别处理</div><div class="line">    if ([method isEqualToString:@&quot;GET&quot;]) &#123;</div><div class="line">        </div><div class="line">        [manager GET:urlString parameters:params success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">            completionblock(responseObject);</div><div class="line">        &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">            errorblock(error);</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    else if([method isEqualToString:@&quot;POST&quot;]) &#123;</div><div class="line">        [manager POST:urlString parameters:params success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">            completionblock(responseObject);</div><div class="line">        &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">            errorblock(error);</div><div class="line">            </div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">//使用multipart-formdata协议上传文件的方法：</div><div class="line">//multipart是HTTP协议为web表单新增的上传文件的协议，数据也是放在请求体中，和普通POST的区别是参数不再是key＝value格式，因此特定的数据格式。</div><div class="line">+ (void)AFRequestData:(NSString *)urlString HTTPMethod:(NSString *)method params:(NSMutableDictionary *)params data:(NSMutableDictionary *)datas completionHandle:(void (^)(id result))completionblock errorHandle:(void (^)(NSError *error))errorblock &#123;</div><div class="line">    </div><div class="line">    //拼接URL</div><div class="line">    urlString = [BaseURL stringByAppendingString:urlString];</div><div class="line">    </div><div class="line">    //获取管理对象</div><div class="line">    AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">    </div><div class="line">    </div><div class="line">    AFHTTPRequestOperation *operation = [manager POST:urlString parameters:params constructingBodyWithBlock:^(id&lt;AFMultipartFormData&gt; formData) &#123;</div><div class="line">        </div><div class="line">        //&#123;@&quot;pic&quot; : NSData(图片的二进制数据)&#125;;</div><div class="line">        </div><div class="line">        for (NSString *keyName in datas) &#123;</div><div class="line">           </div><div class="line">            //获取文件的二进制数据</div><div class="line">            NSData *data = datas[keyName];</div><div class="line">            </div><div class="line">            //需要上传的数据添加到formData中</div><div class="line">            [formData appendPartWithFileData:data name:keyName fileName:keyName mimeType:@&quot;image/jpeg&quot;];</div><div class="line">            </div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125; success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">        </div><div class="line">        completionblock(responseObject);</div><div class="line">        </div><div class="line">    &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">        errorblock(error);</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    [operation setUploadProgressBlock:^(NSUInteger bytesWritten, long long totalBytesWritten, long long totalBytesExpectedToWrite) &#123;</div><div class="line">        </div><div class="line">        CGFloat progress = totalBytesWritten / (totalBytesExpectedToWrite * 1.0);</div><div class="line">        </div><div class="line">        NSLog(@&quot;已上传：%.2f&quot;, progress);</div><div class="line">        </div><div class="line">    &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="下面我们对上面的音频文件进行改进"><a href="#下面我们对上面的音频文件进行改进" class="headerlink" title="下面我们对上面的音频文件进行改进"></a>下面我们对上面的音频文件进行改进</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"> - (IBAction)startDownload:(UIButton *)sender &#123;</div><div class="line">    </div><div class="line">    if (!isDownloading) &#123;</div><div class="line">        NSString *urlString = @&quot;http://cc.stream.qqmusic.qq.com/50450969.m4a?continfo=F6886073E0D58C26B826A7A6F02C20ED5745045FFCFDBF2D&amp;vkey=6A1FE4B71075955312B4EED3D7413AA3F0FAFBF6B31E13897B51043BD95B754982C276870A6D94720C688006886C90F3CC4683BA537FFBCA&amp;guid=238b3707a54f96885fcf9cabb0e319cda3612706&amp;fromtag=53&amp;uin=21619272&quot;;</div><div class="line">        </div><div class="line">        //NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url];</div><div class="line">        </div><div class="line">        </div><div class="line">        AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];</div><div class="line">        </div><div class="line">        //设置返回数据的解析方式为不解析</div><div class="line">        manager.responseSerializer = [AFHTTPResponseSerializer serializer];</div><div class="line">        </div><div class="line">        NSString *filePath = [NSHomeDirectory() stringByAppendingFormat:@&quot;/Documents/%@&quot;, @&quot;file.m4a&quot;];</div><div class="line">        //NSLog(@&quot;%@&quot;, filePath);</div><div class="line">        </div><div class="line">        //判断文件是否存在，如果不存在则创建</div><div class="line">        if (![[NSFileManager defaultManager] fileExistsAtPath:filePath]) &#123;</div><div class="line">            [[NSFileManager defaultManager] createFileAtPath:filePath contents:nil attributes:nil];</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        </div><div class="line">        AFHTTPRequestOperation *operation = [manager GET: urlString parameters:nil success:^(AFHTTPRequestOperation *operation, id responseObject) &#123;</div><div class="line">            NSLog(@&quot;下载成功&quot;);</div><div class="line">        &#125; failure:^(AFHTTPRequestOperation *operation, NSError *error) &#123;</div><div class="line">            NSLog(@&quot;下载失败&quot;);</div><div class="line">        &#125;];</div><div class="line">        </div><div class="line">        </div><div class="line">        //设置下载文件不是保存在内存，而是保存到沙盒路径下的文件中。</div><div class="line">        operation.outputStream = [NSOutputStream outputStreamToFileAtPath:filePath append:YES];</div><div class="line">        </div><div class="line">        </div><div class="line">        __weak ViewController *weakSelf = self;</div><div class="line">        [operation setDownloadProgressBlock:^(NSUInteger bytesRead, long long totalBytesRead, long long totalBytesExpectedToRead) &#123;</div><div class="line">            </div><div class="line">            </div><div class="line">            </div><div class="line">            CGFloat progress = totalBytesRead / (totalBytesExpectedToRead * 1.0);</div><div class="line">            </div><div class="line">            __strong ViewController *strongSelf = weakSelf;</div><div class="line">            </div><div class="line">            strongSelf.progressView.progress = progress;</div><div class="line">            strongSelf.progressLabel.text = [NSString stringWithFormat:@&quot;%.2f%%&quot;</div><div class="line">                                       , progress * 100];</div><div class="line">            </div><div class="line">        &#125;];</div><div class="line">        </div><div class="line"></div><div class="line">        </div><div class="line">        isDownloading = YES;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h5><p>我们网络请求的时候array和dictionary无法打印中文</p>
<p>解决方法</p>
<p>通过类目（NSdictionary+Log)的形式复写dictionary的descriptionWithLocale方法，把key和value进行拼接。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (NSString *)descriptionWithLocale:(id)locale &#123;</div><div class="line">    NSMutableString *log = [NSMutableString stringWithFormat:@&quot;&#123;\n&quot;];</div><div class="line"></div><div class="line">    for (NSString *key in self) &#123;</div><div class="line"></div><div class="line">        NSString *value = self[key];</div><div class="line">        [log appendFormat:@&quot;    %@=%@; \n&quot;,key,value];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    [log appendFormat:@&quot;&#125;&quot;];</div><div class="line">    return log;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/iOS开发-音视频/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/17/iOS开发-音视频/" itemprop="url">
                  iOS开发-音视频
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-17T16:51:19+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/17/iOS开发-音视频/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/17/iOS开发-音视频/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/17/iOS开发-音视频/" class="leancloud_visitors" data-flag-title="iOS开发-音视频">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="访问手机相册"><a href="#访问手机相册" class="headerlink" title="访问手机相册"></a>访问手机相册</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">//只能选择单张图片</div><div class="line">    UIImagePickerController *pickVC = [[UIImagePickerController alloc] init];</div><div class="line">    </div><div class="line">    //设置相片的来源</div><div class="line">//    UIImagePickerControllerSourceTypePhotoLibrary 来自于相册库</div><div class="line">//    UIImagePickerControllerSourceTypeCamera 来自于摄像头</div><div class="line">//    UIImagePickerControllerSourceTypeSavedPhotosAlbum 来自于默认相册</div><div class="line">    pickVC.sourceType =  UIImagePickerControllerSourceTypeSavedPhotosAlbum;</div><div class="line">    </div><div class="line">    </div><div class="line">    pickVC.delegate = self;</div><div class="line">    </div><div class="line">    </div><div class="line">    //以模态视图的形式弹出</div><div class="line">    [self presentViewController:pickVC animated:YES completion:NULL];</div></pre></td></tr></table></figure>
<p>当然一定要实现<code>&lt;UINavigationControllerDelegate,UIImagePickerControllerDelegate&gt;</code>这两个代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">#pragma mark - UIImagePickerController 代理方法</div><div class="line">//监听图片被选择的事件</div><div class="line">- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingMediaWithInfo:(NSDictionary *)info &#123;</div><div class="line">    NSLog(@&quot;%@&quot;, info);</div><div class="line">    //获取选择的图片</div><div class="line">    UIImage *image = info[UIImagePickerControllerOriginalImage];</div><div class="line">    </div><div class="line">    self.imgView.image = image;</div><div class="line">    </div><div class="line">    //判断照片如果来自于摄像头，则要将此图片保存至相册</div><div class="line">    if (picker.sourceType == UIImagePickerControllerSourceTypeCamera) &#123;</div><div class="line">        </div><div class="line">        //图片的保存</div><div class="line">        UIImageWriteToSavedPhotosAlbum(image, self, @selector(image:didFinishSavingWithError:contextInfo:), NULL);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    [picker dismissViewControllerAnimated:YES completion:NULL];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//图片保存成功调用的协议方法</div><div class="line">- (void)image: (UIImage *) image didFinishSavingWithError: (NSError *) error contextInfo: (void *) contextInfo &#123;</div><div class="line">    NSLog(@&quot;保存成功&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="访问照相机"><a href="#访问照相机" class="headerlink" title="访问照相机"></a>访问照相机</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">BOOL isCamera = [UIImagePickerController isCameraDeviceAvailable:UIImagePickerControllerCameraDeviceFront | UIImagePickerControllerCameraDeviceRear];</div><div class="line">   </div><div class="line">   if (!isCamera) &#123;</div><div class="line">       </div><div class="line">       UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:@&quot;提示&quot; message:@&quot;没有可用摄像头&quot; delegate:nil cancelButtonTitle:@&quot;取消&quot; otherButtonTitles:nil, nil];</div><div class="line">       [alertView show];</div><div class="line">       return;</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   </div><div class="line">   UIImagePickerController *pickVC = [[UIImagePickerController alloc] init];</div><div class="line"></div><div class="line">   pickVC.sourceType =  UIImagePickerControllerSourceTypeCamera;</div><div class="line">   </div><div class="line">   </div><div class="line">   pickVC.delegate = self;</div><div class="line">   </div><div class="line">   [self presentViewController:pickVC animated:YES completion:NULL];</div></pre></td></tr></table></figure>
<h4 id="音频播放"><a href="#音频播放" class="headerlink" title="音频播放"></a>音频播放</h4><p>首先导入依赖库<code>AVFoundation</code>和<code>AudioToolbox</code></p>
<p> 1.AVAudioPlayer:只能播放本地音乐。</p>
<p> 2.AVPlayer:可以播放本地音乐和网络音乐。</p>
<p> 系统声音(依赖AudioToolbox框架）：300KB–&gt;150K 对于小的声音文件（铃声，闹钟等），会直接调用系统的声音服务，不使用iOS音频播放组件处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</div><div class="line">#import &lt;AudioToolbox/AudioToolbox.h&gt;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    AVAudioPlayer *player;</div><div class="line">    AVPlayer *avPlayer;</div><div class="line">    BOOL isPlay; //控制avPlayer播放和暂停</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line">//    NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;music&quot; ofType:@&quot;mp3&quot;];</div><div class="line">//    //构造网络URL</div><div class="line">//    //NSURL *url = [NSURL URLWithString:filePath];</div><div class="line">//    //构造本地URL</div><div class="line">//    NSURL *url = [NSURL fileURLWithPath:filePath];</div><div class="line">//    </div><div class="line">//    player = [[AVAudioPlayer alloc] initWithContentsOfURL:url error:nil];</div><div class="line">    </div><div class="line">    </div><div class="line">//    NSURL *url = [NSURL URLWithString:@&quot;http://218.76.27.57:8080/chinaschool_rs02/135275/153903/160861/160867/1370744550357.mp3&quot;];</div><div class="line">//    </div><div class="line">//    avPlayer = [[AVPlayer alloc] initWithURL:url];</div><div class="line">//    </div><div class="line">//    [avPlayer play];</div><div class="line">    </div><div class="line">    NSString *filePath = [[NSBundle mainBundle] pathForResource:@&quot;44&quot; ofType:@&quot;caf&quot;];</div><div class="line">    NSURL *url = [NSURL fileURLWithPath:filePath];</div><div class="line">    //注册为系统声音,soundID具有有效值</div><div class="line">    SystemSoundID soundID = 0;</div><div class="line">    AudioServicesCreateSystemSoundID((__bridge CFURLRef)url, &amp;soundID);</div><div class="line">    </div><div class="line">    AudioServicesPlaySystemSound(soundID);</div><div class="line">    </div><div class="line">    //播放振动</div><div class="line">    AudioServicesPlaySystemSound(kSystemSoundID_Vibrate);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (IBAction)playLocal:(id)sender &#123;</div><div class="line">    UIButton *button = (UIButton *)sender;</div><div class="line">    //播放状态</div><div class="line">    if ([player isPlaying]) &#123;</div><div class="line">        [player pause];</div><div class="line">        [button setTitle:@&quot;播放本地音乐&quot; forState:UIControlStateNormal];</div><div class="line">        </div><div class="line">    &#125; else &#123; //暂停状态</div><div class="line">        [player play];</div><div class="line">        [button setTitle:@&quot;暂停&quot; forState:UIControlStateNormal];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">- (IBAction)playInternet:(id)sender &#123;</div><div class="line">    if (isPlay) &#123;</div><div class="line">        [avPlayer pause];</div><div class="line">    &#125; else &#123;</div><div class="line">        [avPlayer play];</div><div class="line">    &#125;</div><div class="line">    isPlay = !isPlay;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h4 id="远程控制事件"><a href="#远程控制事件" class="headerlink" title="远程控制事件"></a>远程控制事件</h4><p>  1.支持远程控制事件，让线控耳机可以控制音乐的暂停和播放</p>
<p> （1）复写canBecomeFirstResponder</p>
<p> （2）只有第一响应者才可以接收远程控制事件</p>
<p> （3）设置当前应用程序开始接收远程控制事件</p>
<p> 2.让音乐支持后台播放</p>
<p> 一般来讲支持后台运行的任务有三种：</p>
<p> （1）音乐播放</p>
<p> （2）定位</p>
<p> （3）VOIP：网络电话</p>
<p> 进行以下配置才能支持后台播放：</p>
<p> （1）在info.plist文件中加入一项:Required background modes–&gt;播放音乐</p>
<p> （2）获取AVAudioSession对象，并设置其类别为AVAudioSessionCategoryPlayback</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &lt;AVFoundation/AVFoundation.h&gt;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    AVPlayer *_player;</div><div class="line">    BOOL _isPlay;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    //让音频会话支持后台播放,且必须在播放音频文件之前设置</div><div class="line">    [[AVAudioSession sharedInstance] setCategory:AVAudioSessionCategoryPlayback error:nil];</div><div class="line">    </div><div class="line">    </div><div class="line">    NSURL *url = [[NSBundle mainBundle] URLForResource:@&quot;music&quot; withExtension:@&quot;mp3&quot;];</div><div class="line">    </div><div class="line">    _player = [[AVPlayer alloc] initWithURL:url];</div><div class="line">    </div><div class="line">    [_player play];</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//设置当前响应者具备成为第一响应者的能力</div><div class="line">- (BOOL)canBecomeFirstResponder &#123;</div><div class="line">    </div><div class="line">    return YES;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)viewDidAppear:(BOOL)animated &#123;</div><div class="line">    [super viewDidAppear:animated];</div><div class="line">    </div><div class="line">    //设置当前视图控制器为第一响应者，才能接收远程控制事件</div><div class="line">    [self becomeFirstResponder];</div><div class="line">    </div><div class="line">    //设置当前应用程序开始接收远程控制事件</div><div class="line">    [[UIApplication sharedApplication] beginReceivingRemoteControlEvents];</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">- (void)viewDidDisappear:(BOOL)animated &#123;</div><div class="line">    </div><div class="line">    [super viewDidDisappear:animated];</div><div class="line">    </div><div class="line">    //取消第一响应者</div><div class="line">    [self resignFirstResponder];</div><div class="line">    </div><div class="line">    //应用程序停止接收远程控制事件</div><div class="line">    [[UIApplication sharedApplication] endReceivingRemoteControlEvents];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//接收远程控制事件的方法，远程控制事件开始此方法会被触发</div><div class="line">- (void)remoteControlReceivedWithEvent:(UIEvent *)event &#123;</div><div class="line">    if (event.type == UIEventTypeRemoteControl) &#123;</div><div class="line">        switch (event.subtype) &#123;</div><div class="line">            case UIEventSubtypeRemoteControlTogglePlayPause:</div><div class="line">                if (_isPlay) &#123;</div><div class="line">                    [_player pause];</div><div class="line">                &#125; else &#123;</div><div class="line">                    [_player play];</div><div class="line">                &#125;</div><div class="line">                _isPlay = !_isPlay;</div><div class="line">                break;</div><div class="line">            case UIEventSubtypeRemoteControlNextTrack :</div><div class="line">                NSLog(@&quot;下一首&quot;);</div><div class="line">                break;</div><div class="line">            case UIEventSubtypeRemoteControlPreviousTrack :</div><div class="line">                NSLog(@&quot;上一首&quot;);</div><div class="line">                break;</div><div class="line">            default:</div><div class="line">                break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/17/iOS开发技巧-二/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/17/iOS开发技巧-二/" itemprop="url">
                  iOS开发技巧(二)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-17T12:55:04+08:00">
                2017-01-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/17/iOS开发技巧-二/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/17/iOS开发技巧-二/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/17/iOS开发技巧-二/" class="leancloud_visitors" data-flag-title="iOS开发技巧(二)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="获取全局的Delegate对象，这样我们可以调用这个对象里的方法和变量"><a href="#获取全局的Delegate对象，这样我们可以调用这个对象里的方法和变量" class="headerlink" title="获取全局的Delegate对象，这样我们可以调用这个对象里的方法和变量"></a>获取全局的Delegate对象，这样我们可以调用这个对象里的方法和变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[(MyAppDelegate*)[[UIApplication sharedApplication] delegate] MyMethodOrMyVariable];</div></pre></td></tr></table></figure>
<h4 id="获得程序的主Bundle"><a href="#获得程序的主Bundle" class="headerlink" title="获得程序的主Bundle"></a>获得程序的主Bundle</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NSBundle *bundle = [NSBundle mainBundle];</div><div class="line">/*</div><div class="line">Bundle可以理解成一种文件夹，其内容遵循特定的框架。</div><div class="line"></div><div class="line">Main Bundle一种主要用途是使用程序中的资源文件，如图片、声音、plst文件等。</div><div class="line">*/</div><div class="line">NSURL *plistURL = [bundle URLForResource:@&quot;plistFile&quot; withExtension:@&quot;plist&quot;];</div><div class="line"></div><div class="line">//上面的代码获得plistFile.plist文件的路径。</div></pre></td></tr></table></figure>
<h4 id="在程序中播放声音"><a href="#在程序中播放声音" class="headerlink" title="在程序中播放声音"></a>在程序中播放声音</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line">首先在程序添加AudioToolbox：</div><div class="line"></div><div class="line">其次，在有播放声音方法的.m方法添加#import：</div><div class="line"></div><div class="line">#import</div><div class="line">*/</div><div class="line">//接下来，播放声音的代码如下：</div><div class="line"></div><div class="line">NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;soundFileName&quot; ofType:@&quot;wav&quot;];</div><div class="line"></div><div class="line">SystemSoundID soundID;</div><div class="line"></div><div class="line">AudioServicesCreateSystemSoundID ((__bridge CFURLRef)[NSURL fileURLWithPath:path], &amp;soundID);</div><div class="line"></div><div class="line">AudioServicesPlaySystemSound (soundID);</div></pre></td></tr></table></figure>
<h4 id="设置和获取类中属性值"><a href="#设置和获取类中属性值" class="headerlink" title="设置和获取类中属性值"></a>设置和获取类中属性值</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[self setValue: 变量值 forKey: 变量名];</div><div class="line"></div><div class="line">[self valueForKey: 变量名];</div></pre></td></tr></table></figure>
<h4 id="让某一方法在未来某段时间之后执行"><a href="#让某一方法在未来某段时间之后执行" class="headerlink" title="让某一方法在未来某段时间之后执行"></a>让某一方法在未来某段时间之后执行</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self performSelector:@selector(方法名) withObject:nil afterDelay:延迟时间（s）];</div></pre></td></tr></table></figure>
<h4 id="获得设备版本号"><a href="#获得设备版本号" class="headerlink" title="获得设备版本号"></a>获得设备版本号</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">float version = [[[UIDevice currentDevice] systemVersion] floatValue];</div></pre></td></tr></table></figure>
<h4 id="捕捉程序关闭或者进入后台事件"><a href="#捕捉程序关闭或者进入后台事件" class="headerlink" title="捕捉程序关闭或者进入后台事件"></a>捕捉程序关闭或者进入后台事件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">UIApplication *app = [UIApplication sharedApplication];</div><div class="line"></div><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(applicationWillResignActive:) name:UIApplicationWillResignActiveNotification object:app];</div><div class="line"></div><div class="line">//applicationWillResignActive:这个方法中添加想要的操作</div></pre></td></tr></table></figure>
<h4 id="查看设备支持的字体"><a href="#查看设备支持的字体" class="headerlink" title="查看设备支持的字体"></a>查看设备支持的字体</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">for (NSString *family in [UIFont familyNames]) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;%@&quot;, family);</div><div class="line"></div><div class="line">for (NSString *font in [UIFont fontNamesForFamilyName:family]) &#123;</div><div class="line"></div><div class="line">NSLog(@&quot;\t%@&quot;, font);</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="为UIImageView添加单击事件"><a href="#为UIImageView添加单击事件" class="headerlink" title="为UIImageView添加单击事件"></a>为UIImageView添加单击事件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">imageView.userInteractionEnabled = YES;</div><div class="line"></div><div class="line">UITapGestureRecognizer *singleTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(yourHandlingCode:)];</div><div class="line"></div><div class="line">[imageView addGestureRecognizer:singleTap];</div></pre></td></tr></table></figure>
<h4 id="页面切换效果设置"><a href="#页面切换效果设置" class="headerlink" title="页面切换效果设置"></a>页面切换效果设置</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">controller.modalTransitionStyle = UIModalTransitionStyleCoverVertical;</div><div class="line"></div><div class="line">[self presentModalViewController:controller animated:YES];</div><div class="line">/*</div><div class="line">可供使用的效果：</div><div class="line"></div><div class="line">UIModalTransitionStyleCoverVertical</div><div class="line"></div><div class="line">UIModalTransitionStyleFlipHorizontal</div><div class="line"></div><div class="line">UIModalTransitionStyleCrossDissolve</div><div class="line"></div><div class="line">UIModalTransitionStylePartialCurl</div><div class="line">*/</div><div class="line">//恢复之前的页面：</div><div class="line"></div><div class="line">[self dismissModalViewControllerAnimated:YES];</div></pre></td></tr></table></figure>
<h4 id="视频、音频调取"><a href="#视频、音频调取" class="headerlink" title="视频、音频调取"></a>视频、音频调取</h4><h6 id="iOS视频播放代码（添加MediaPlayer-framework和-import）"><a href="#iOS视频播放代码（添加MediaPlayer-framework和-import）" class="headerlink" title="iOS视频播放代码（添加MediaPlayer.framework和#import）"></a>iOS视频播放代码（添加MediaPlayer.framework和#import）</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">-(void)playMovie:(NSString *)fileName&#123;</div><div class="line"></div><div class="line">//视频文件路径</div><div class="line"></div><div class="line">NSString *path = [[NSBundle mainBundle] pathForResource:fileName ofType:@&quot;mp4&quot;];</div><div class="line"></div><div class="line">//视频URL</div><div class="line"></div><div class="line">NSURL *url = [NSURL fileURLWithPath:path];</div><div class="line"></div><div class="line">//视频播放对象</div><div class="line"></div><div class="line">MPMoviePlayerController *movie = [[MPMoviePlayerController alloc] initWithContentURL:url];</div><div class="line"></div><div class="line">movie.controlStyle = MPMovieControlStyleFullscreen;</div><div class="line"></div><div class="line">[movie.view setFrame:self.view.bounds];</div><div class="line"></div><div class="line">movie.initialPlaybackTime = -1;</div><div class="line"></div><div class="line">[self.view addSubview:movie.view];</div><div class="line"></div><div class="line">// 注册一个播放结束的通知</div><div class="line"></div><div class="line">[[NSNotificationCenter defaultCenter] addObserver:self</div><div class="line"></div><div class="line">selector:@selector(myMovieFinishedCallback:)</div><div class="line"></div><div class="line">name:MPMoviePlayerPlaybackDidFinishNotification</div><div class="line"></div><div class="line">object:movie];</div><div class="line"></div><div class="line">[movie play];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark -------------------视频播放结束委托--------------------</div><div class="line"></div><div class="line">-(void)myMovieFinishedCallback:(NSNotification*)notify</div><div class="line"></div><div class="line">&#123;</div><div class="line"></div><div class="line">//视频播放对象</div><div class="line"></div><div class="line">MPMoviePlayerController* theMovie = [notify object];</div><div class="line"></div><div class="line">//销毁播放通知</div><div class="line"></div><div class="line">[[NSNotificationCenter defaultCenter] removeObserver:self</div><div class="line"></div><div class="line">name:MPMoviePlayerPlaybackDidFinishNotification</div><div class="line"></div><div class="line">object:theMovie];</div><div class="line"></div><div class="line">[theMovie.view removeFromSuperview];</div><div class="line"></div><div class="line">// 释放视频对象</div><div class="line"></div><div class="line">[theMovie release];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="播放背景音乐，利用类进行播放"><a href="#播放背景音乐，利用类进行播放" class="headerlink" title="播放背景音乐，利用类进行播放"></a>播放背景音乐，利用类进行播放</h6><p>背景音乐播放 支持mp3格式 循环播放长音乐这种播放音乐的方式导入框架#import<avfoundation avfoundation.h=""></avfoundation></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//设置属性：必须在h文件中实例化。不知道为什么，直接在M文件中实例化，会播不出来声音。</div><div class="line">&#123;</div><div class="line">AVAudioPlayer *myBackMusic;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">//.m</div><div class="line">-（void)viewDidLoad</div><div class="line"></div><div class="line">&#123;</div><div class="line"></div><div class="line">NSString *musicFilePath = [[NSBundle mainBundle] pathForResource:@&quot;changan&quot; ofType:@&quot;mp3&quot;]; //创建音乐文件路径</div><div class="line"></div><div class="line">NSURL *musicURL = [[NSURL alloc] initFileURLWithPath:musicFilePath];</div><div class="line"></div><div class="line">AVAudioPlayer *thePlayer = [[AVAudioPlayer alloc] initWithContentsOfURL:musicURL error:nil];</div><div class="line"></div><div class="line">//创建播放器</div><div class="line"></div><div class="line">myBackMusic = thePlayer; //赋值给自己定义的类变量</div><div class="line"></div><div class="line">[musicURL release];</div><div class="line"></div><div class="line">[thePlayer release];</div><div class="line"></div><div class="line">[myBackMusic prepareToPlay];</div><div class="line"></div><div class="line">[myBackMusic setVolume:1]; //设置音量大小</div><div class="line"></div><div class="line">myBackMusic.numberOfLoops = -1;//设置音乐播放次数 -1为一直循环 ，将音频播放器的numberOfLoops属性设为负数使得播放无限循环</div><div class="line"></div><div class="line">NSLog(@&quot;%f seconds played so far&quot;, audioPlayer.currentTime); //查看播放的初始时间，也就是从多少秒开始播放</div><div class="line"></div><div class="line">audioPlayer.currentTime = 10; // jump to the 10 second mark //设置播放开始的时间</div><div class="line"></div><div class="line">[myBackMusic play]; //播放</div><div class="line"></div><div class="line">[myBackMusic pause];</div><div class="line"></div><div class="line">[myBackMusic stop];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h6 id="iOS播放一段声音（添加AudioToolbox-framework和-import）"><a href="#iOS播放一段声音（添加AudioToolbox-framework和-import）" class="headerlink" title="iOS播放一段声音（添加AudioToolbox.framework和#import）"></a>iOS播放一段声音（添加AudioToolbox.framework和#import<avfoundation avfoundation.h="">）</avfoundation></h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSString *path = [[NSBundle mainBundle] pathForResource:@&quot;soundFileName&quot; ofType:@&quot;wav&quot;];</div><div class="line"></div><div class="line">SystemSoundID soundID;</div><div class="line"></div><div class="line">AudioServicesCreateSystemSoundID ((__bridge CFURLRef)[NSURL fileURLWithPath:path], &amp;soundID);</div><div class="line"></div><div class="line">AudioServicesPlaySystemSound (soundID);</div></pre></td></tr></table></figure>
<h4 id="文本框输入时使当前TextField移动到弹出的键盘顶部"><a href="#文本框输入时使当前TextField移动到弹出的键盘顶部" class="headerlink" title="文本框输入时使当前TextField移动到弹出的键盘顶部"></a><strong>文本框输入时使当前TextField移动到弹出的键盘顶部</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">//首先先设置TextField的代理为self，并添加&lt;UITextFieldDelegate&gt;</div><div class="line">//然后通过代理方法来处理视图的上下移动</div><div class="line"></div><div class="line">#pragma mark - TextField delegete 处理键盘弹出时视图的上下移动</div><div class="line">//键盘上移</div><div class="line">- (void)textFieldDidBeginEditing:(UITextField *)textField</div><div class="line">&#123;</div><div class="line">    CGRect frame = textField.frame;</div><div class="line">    CGFloat heights = self.view.frame.size.height;</div><div class="line">    // 当前点击textfield的坐标的Y值 + 当前点击textFiled的高度 - （屏幕高度- 键盘高度 - 键盘上tabbar高度）</div><div class="line">    // 在这一部 就是了一个 当前textfile的的最大Y值 和 键盘的最全高度的差值，用来计算整个view的偏移量</div><div class="line">    int offset = frame.origin.y + frame.size.height - ( heights - 216.0-49.0);//键盘高度216</div><div class="line">    NSTimeInterval animationDuration = 0.30f;</div><div class="line">    [UIView beginAnimations:@&quot;ResizeForKeyBoard&quot; context:nil];</div><div class="line">    [UIView setAnimationDuration:animationDuration];</div><div class="line">    float width = self.view.frame.size.width;</div><div class="line">    float height = self.view.frame.size.height;</div><div class="line">    if(offset &gt; 0)</div><div class="line">    &#123;</div><div class="line">        CGRect rect = CGRectMake(0.0f, -offset,width,height);</div><div class="line">        self.view.frame = rect;</div><div class="line">    &#125;</div><div class="line">    [UIView commitAnimations];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//屏幕恢复原样</div><div class="line">-(void)textFieldDidEndEditing:(UITextField *)textField</div><div class="line">&#123;</div><div class="line">    //滑动效果</div><div class="line">    NSTimeInterval animationDuration = 0.30f;</div><div class="line">    [UIView beginAnimations:@&quot;ResizeForKeyboard&quot; context:nil];</div><div class="line">    [UIView setAnimationDuration:animationDuration];</div><div class="line">    //恢复屏幕</div><div class="line">    self.view.frame = CGRectMake(0.0f, 0.0f, self.view.frame.size.width, self.view.frame.size.height);//64-216</div><div class="line">    [UIView commitAnimations];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//return返回</div><div class="line">- (BOOL)textFieldShouldReturn:(UITextField *)textField &#123;</div><div class="line">    [self.contentView endEditing:YES];</div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断是否为正确的手机号码"><a href="#判断是否为正确的手机号码" class="headerlink" title="判断是否为正确的手机号码"></a><strong>判断是否为正确的手机号码</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">#pragma mark - 判断用户输入的手机号码是否正确</div><div class="line">- (BOOL)isMobileNumber:(NSString *)mobileNum &#123;</div><div class="line"></div><div class="line">    //    电信号段:133/153/180/181/189/177</div><div class="line">    //    联通号段:130/131/132/155/156/185/186/145/176</div><div class="line">    //    移动号段:134/135/136/137/138/139/150/151/152/157/158/159/182/183/184/187/188/147/178</div><div class="line">    //    虚拟运营商:170</div><div class="line"></div><div class="line">    NSString *MOBILE = @&quot;^1(3[0-9]|4[57]|5[0-35-9]|8[0-9]|7[06-8])\\d&#123;8&#125;$&quot;;</div><div class="line">    NSPredicate *regextestmobile = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, MOBILE];</div><div class="line">    return [regextestmobile evaluateWithObject:mobileNum];</div><div class="line">&#125;</div><div class="line"></div><div class="line">/*</div><div class="line">        case let .email(str):</div><div class="line">            predicateStr = &quot;^([a-z0-9_\\.-]+)@([\\da-z\\.-]+)\\.([a-z\\.]&#123;2,6&#125;)$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .phoneNum(str):</div><div class="line">            predicateStr = &quot;^((13[0-9])|(15[^4,\\D]) |(17[0,0-9])|(18[0,0-9]))\\d&#123;8&#125;$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .carNum(str):</div><div class="line">            predicateStr = &quot;^[A-Za-z]&#123;1&#125;[A-Za-z_0-9]&#123;5&#125;$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .username(str):</div><div class="line">            predicateStr = &quot;^[A-Za-z0-9]&#123;6,20&#125;+$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .password(str):</div><div class="line">            predicateStr = &quot;^[a-zA-Z0-9]&#123;6,20&#125;+$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .nickname(str):</div><div class="line">            predicateStr = &quot;^[\\u4e00-\\u9fa5]&#123;4,8&#125;$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .URL(str):</div><div class="line">            predicateStr = &quot;^(https?:\\/\\/)?([\\da-z\\.-]+)\\.([a-z\\.]&#123;2,6&#125;)([\\/\\w \\.-]*)*\\/?$&quot;</div><div class="line">            currObject = str</div><div class="line">        case let .IP(str):</div><div class="line">            predicateStr = &quot;^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.)&#123;3&#125;(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$&quot;</div><div class="line">            currObject = str</div><div class="line">        &#125;</div><div class="line">*/</div></pre></td></tr></table></figure>
<h4 id="判断当前版本号"><a href="#判断当前版本号" class="headerlink" title="判断当前版本号"></a><strong>判断当前版本号</strong></h4><p>业务逻辑：从服务器获得最新的版本号和是否要强制更新的字段，当用户版本与服务器版本不同时，弹出警告框让用户更新，若用户点击确定则跳转到appStore下载，点击取消则判断服务器返回的强制更新字段是否有值，有则关闭app不让用户使用(当后台接口改变时会出现这种情况)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">#pragma mark - 判断版本号</div><div class="line">- (void)getVersion&#123;</div><div class="line">      //通过发送网络请求从服务器上获取最新版本号</div><div class="line">[manager GET:kGetVersion parameters:parameters progress:nil success:^(NSURLSessionDataTask * _Nonnull task, NSDictionary *responseObject) &#123;</div><div class="line">        //得到服务器版本</div><div class="line">        NSString *updataVersion = responseObject[@&quot;currVesion&quot;];</div><div class="line">        //获取当前设备中应用的版本号</div><div class="line">        NSDictionary *infoDic = [[NSBundle mainBundle] infoDictionary];</div><div class="line">        NSString *currentVersion = [infoDic objectForKey:@&quot;CFBundleShortVersionString&quot;];</div><div class="line">        //判断两个版本是否相同</div><div class="line">        if ([updataVersion compare:currentVersion options:NSNumericSearch] == NSOrderedDescending) &#123;</div><div class="line">            UIAlertController *alert = [UIAlertController alertControllerWithTitle:@&quot;更新&quot; message:@&quot;您当前版本过低，请更新&quot; preferredStyle:UIAlertControllerStyleAlert];</div><div class="line">            UIAlertAction *update = [UIAlertAction actionWithTitle:@&quot;更新&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</div><div class="line">                //跳转到响应地址进行更新</div><div class="line">                //appID根据上传的应用取得</div><div class="line">                NSString *appID = @&quot;114XXXXXXX&quot;;</div><div class="line">                NSString *appUrl = @&quot;http://itunes.apple.com/lookup?id=&quot;;</div><div class="line">                NSString *urlStr = [NSString stringWithFormat:@&quot;%@%@&quot;, appUrl, appID];</div><div class="line">                NSURL *url = [NSURL URLWithString:urlStr];</div><div class="line">                //                    NSURL *url = [NSURL URLWithString:[NSString stringWithFormat:@&quot;http://%@&quot;,infoDict[@&quot;currVesionDetail&quot;]]];</div><div class="line">                [[UIApplication sharedApplication] openURL:url];</div><div class="line">            &#125;];</div><div class="line">            UIAlertAction *cancel = [UIAlertAction actionWithTitle:@&quot;取消&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction * _Nonnull action) &#123;</div><div class="line">                //判断是否要强制更新</div><div class="line">                if (responseObject[@&quot;checkVesion&quot;]) &#123;</div><div class="line">                    //说明要强制更新，则杀死程序</div><div class="line">                    UIApplication *app = [UIApplication sharedApplication];</div><div class="line">                    UIWindow *window = app.keyWindow;</div><div class="line">                    [UIView animateWithDuration:1.0f animations:^&#123;</div><div class="line">                        window.alpha = 0;</div><div class="line">                        window.frame = CGRectMake(0, window.bounds.size.width, 0, 0);</div><div class="line">                    &#125; completion:^(BOOL finished) &#123;</div><div class="line">                        exit(0);</div><div class="line">                    &#125;];</div><div class="line">                    //exit(0);</div><div class="line"></div><div class="line">                &#125;</div><div class="line">            &#125;];</div><div class="line">            [alert addAction:update];</div><div class="line">            [alert addAction:cancel];</div><div class="line"></div><div class="line">            [self presentViewController:alert animated:YES completion:nil];</div><div class="line">        &#125;</div><div class="line">    &#125; failure:^(NSURLSessionDataTask * _Nullable task, NSError * _Nonnull error) &#123;</div><div class="line"></div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="使用SDWebImage当收到内存警告时清除缓存"><a href="#使用SDWebImage当收到内存警告时清除缓存" class="headerlink" title="使用SDWebImage当收到内存警告时清除缓存"></a><strong>使用SDWebImage当收到内存警告时清除缓存</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (void)applicationDidReceiveMemoryWarning:(UIApplication *)application</div><div class="line">&#123;</div><div class="line">    SDWebImageManager *mrg = [SDWebImageManager sharedManager];</div><div class="line">    //1,取消下砸操作</div><div class="line">    [mrg cancelAll];</div><div class="line">    //2,清除内存缓存</div><div class="line">    [mrg.imageCache clearMemory];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="KVO模式监听数组的变化"><a href="#KVO模式监听数组的变化" class="headerlink" title="KVO模式监听数组的变化"></a><strong>KVO模式监听数组的变化</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad&#123;</div><div class="line">    ....</div><div class="line">    [self addObserver:self forKeyPath:@&quot;array&quot; options:NSKeyValueObservingOptionNew context:nil];</div><div class="line">    ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">//这样监听是无效的</div><div class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSString *,id&gt; *)change context:(void *)context&#123;</div><div class="line">    //实现监听方法</div><div class="line">&#125;</div><div class="line"></div><div class="line">//下面方法才有效</div><div class="line">//注意，方法名中inArrayAtIndex,其中Array要根据属性名和改变</div><div class="line">-(void)insertObject:(id)object inArrayAtIndex:(NSUInteger)index&#123;</div><div class="line">    //向数组中插入数据</div><div class="line">    [self.array insertObject:object atIndex:index];</div><div class="line">&#125;</div><div class="line">-(void)removeObjectFromArrayAtIndex:(NSUInteger)index&#123;</div><div class="line">    //向数组中删除数据</div><div class="line">    [self.array removeObjectAtIndex:index];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>当要往数组上增加/删除数据，要通过上面两个方法，而不是直接使用self.array addObject：添加</p>
<p>更多方法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">-(void)insertArray:(NSArray *)array atIndexes:(NSIndexSet *)indexes&#123;&#125;</div><div class="line">-(void)removeArrayAtIndexes:(NSIndexSet *)indexes&#123;&#125;</div><div class="line">-(void)replaceArrayAtIndexes:(NSIndexSet*)indexes withArray:(NSArray *)array&#123;&#125;</div><div class="line">-(void)replaceObjectInArrayAtIndex:(NSUInteger)index withObject:(id)object&#123;&#125;</div></pre></td></tr></table></figure>
<h4 id="ScrollView及其子类下拉放大头部图片"><a href="#ScrollView及其子类下拉放大头部图片" class="headerlink" title="ScrollView及其子类下拉放大头部图片"></a><strong>ScrollView及其子类下拉放大头部图片</strong></h4><p>原理:让ScrollView顶部缩进要放的headerView的高度,在拖动ScrollView时,保持headerView的y始终在原位,而高度加上偏移值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidLoad &#123;</div><div class="line">  ...</div><div class="line">  //设置tableView的缩进</div><div class="line">  tableView.contentInset = UIEdgeInsetsMake(headerViewHeight, 0, 0, 0);</div><div class="line">  //设置headerView</div><div class="line">  imageView.frame = CGRectMake(0, -headerViewHeight, self.view.frame.size.width, headerViewHeight);</div><div class="line">  imageView.contentMode = UIViewContentModeScaleAspectFill;</div><div class="line">  //将imageView插入到tableView的最上层,盖住空白处</div><div class="line">  [self.tableView insertSubview:imageView atIndex:0];</div><div class="line">  ...</div><div class="line">&#125;</div><div class="line"></div><div class="line">#pragma mark - delegate</div><div class="line">//偏移改变headerView大小</div><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">    CGFloat y = scrollView.contentOffset.y ; //如果有导航栏则要加上64</div><div class="line">    if (y&lt; -headerViewHeight) &#123;</div><div class="line">        CGRect frame = self.headerView.frame;</div><div class="line">        frame.origin.y = y;</div><div class="line">        frame.size.height = -y;</div><div class="line">        self.headerView.frame = frame;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断手机号码格式是否正确，利用正则表达式验证"><a href="#判断手机号码格式是否正确，利用正则表达式验证" class="headerlink" title="判断手机号码格式是否正确，利用正则表达式验证"></a><strong>判断手机号码格式是否正确，利用正则表达式验证</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)isMobileNumber:(NSString *)mobileNum</div><div class="line">&#123;</div><div class="line">    if (mobileNum.length != 11)</div><div class="line">    &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">    /**</div><div class="line">     * 手机号码:</div><div class="line">     * 13[0-9], 14[5,7], 15[0, 1, 2, 3, 5, 6, 7, 8, 9], 17[6, 7, 8], 18[0-9], 170[0-9]</div><div class="line">     * 移动号段: 134,135,136,137,138,139,150,151,152,157,158,159,182,183,184,187,188,147,178,1705</div><div class="line">     * 联通号段: 130,131,132,155,156,185,186,145,176,1709</div><div class="line">     * 电信号段: 133,153,180,181,189,177,1700</div><div class="line">     */</div><div class="line">    NSString *MOBILE = @&quot;^1(3[0-9]|4[57]|5[0-35-9]|8[0-9]|70)\d&#123;8&#125;$&quot;;</div><div class="line">    /**</div><div class="line">     * 中国移动：China Mobile</div><div class="line">     * 134,135,136,137,138,139,150,151,152,157,158,159,182,183,184,187,188,147,178,1705</div><div class="line">     */</div><div class="line">    NSString *CM = @&quot;(^1(3[4-9]|4[7]|5[0-27-9]|7[8]|8[2-478])\d&#123;8&#125;$)|(^1705\d&#123;7&#125;$)&quot;;</div><div class="line">    /**</div><div class="line">     * 中国联通：China Unicom</div><div class="line">     * 130,131,132,155,156,185,186,145,176,1709</div><div class="line">     */</div><div class="line">    NSString *CU = @&quot;(^1(3[0-2]|4[5]|5[56]|7[6]|8[56])\d&#123;8&#125;$)|(^1709\d&#123;7&#125;$)&quot;;</div><div class="line">    /**</div><div class="line">     * 中国电信：China Telecom</div><div class="line">     * 133,153,180,181,189,177,1700</div><div class="line">     */</div><div class="line">    NSString *CT = @&quot;(^1(33|53|77|8[019])\d&#123;8&#125;$)|(^1700\d&#123;7&#125;$)&quot;;</div><div class="line">    NSPredicate *regextestmobile = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, MOBILE];</div><div class="line">    NSPredicate *regextestcm = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, CM];</div><div class="line">    NSPredicate *regextestcu = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, CU];</div><div class="line">    NSPredicate *regextestct = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, CT];</div><div class="line">    if (([regextestmobile evaluateWithObject:mobileNum] == YES)</div><div class="line">        || ([regextestcm evaluateWithObject:mobileNum] == YES)</div><div class="line">        || ([regextestct evaluateWithObject:mobileNum] == YES)</div><div class="line">        || ([regextestcu evaluateWithObject:mobileNum] == YES))</div><div class="line">    &#123;</div><div class="line">        return YES;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断邮箱格式是否正确，利用正则表达式验证"><a href="#判断邮箱格式是否正确，利用正则表达式验证" class="headerlink" title="判断邮箱格式是否正确，利用正则表达式验证"></a><strong>判断邮箱格式是否正确，利用正则表达式验证</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)isAvailableEmail:(NSString *)email</div><div class="line">&#123;</div><div class="line">    NSString *emailRegex = @&quot;[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]&#123;2,4&#125;&quot;;</div><div class="line">    NSPredicate *emailTest = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES %@&quot;, emailRegex];</div><div class="line">    return [emailTest evaluateWithObject:email];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断字符串中是否含有空格"><a href="#判断字符串中是否含有空格" class="headerlink" title="判断字符串中是否含有空格"></a><strong>判断字符串中是否含有空格</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)isHaveSpaceInString:(NSString *)string&#123;</div><div class="line">    NSRange _range = [string rangeOfString:@&quot; &quot;];</div><div class="line">    if (_range.location != NSNotFound) &#123;</div><div class="line">        return YES;</div><div class="line">    &#125;else &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断字符串中是否含有中文"><a href="#判断字符串中是否含有中文" class="headerlink" title="判断字符串中是否含有中文"></a><strong>判断字符串中是否含有中文</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)isHaveChineseInString:(NSString *)string</div><div class="line">&#123;</div><div class="line">    for(NSInteger i = 0; i &lt; [string length]; i++)&#123;</div><div class="line">        int a = [string characterAtIndex:i];</div><div class="line">        if (a &gt; 0x4e00 &amp;&amp; a &lt; 0x9fff) &#123;</div><div class="line">            return YES;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断字符串是否全部为数字"><a href="#判断字符串是否全部为数字" class="headerlink" title="判断字符串是否全部为数字"></a><strong>判断字符串是否全部为数字</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)isAllNum:(NSString *)string</div><div class="line">&#123;</div><div class="line">    unichar c;</div><div class="line">    for (int i=0; i&lt;string.length; i++) &#123;</div><div class="line">      c=[string characterAtIndex:i];</div><div class="line">      if (!isdigit(c)) </div><div class="line">      &#123;</div><div class="line">        return no;</div><div class="line">      &#125; </div><div class="line">    &#125;return yes;</div><div class="line"></div><div class="line">&#125;</div><div class="line">//判断是否是纯数字</div><div class="line">+ (BOOL)isPureInteger:(NSString *)str &#123;</div><div class="line">    NSScanner *scanner = [NSScanner scannerWithString:str];</div><div class="line">    NSInteger val;</div><div class="line">    return [scanner scanInteger:&amp;val] &amp;&amp; [scanner isAtEnd];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="过滤一些特殊字符-似乎只能去除头尾的特殊字符-不准"><a href="#过滤一些特殊字符-似乎只能去除头尾的特殊字符-不准" class="headerlink" title="过滤一些特殊字符 似乎只能去除头尾的特殊字符(不准)"></a>过滤一些特殊字符 似乎只能去除头尾的特殊字符(不准)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">+ (NSString *)filterSpecialWithString:(NSString *)string</div><div class="line">&#123;</div><div class="line">    // 定义一个特殊字符的集合</div><div class="line">    NSCharacterSet *set = [NSCharacterSet characterSetWithCharactersInString:</div><div class="line">                   @&quot;@／：；: ;（）?「」＂、[]&#123;&#125;#%-*+=_|~＜＞$?^?&apos;@#$%^&amp;*()_+&apos;&quot;];</div><div class="line">    // 过滤字符串的特殊字符</div><div class="line">    NSString *newString = [string stringByTrimmingCharactersInSet:set];</div><div class="line">    return newString;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="让iOS应用直接退出"><a href="#让iOS应用直接退出" class="headerlink" title="让iOS应用直接退出"></a>让iOS应用直接退出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+ (void)backOutApp &#123;</div><div class="line">    UIWindow *window = [[UIApplication sharedApplication].delegate window];</div><div class="line">    [UIView animateWithDuration:1.0f animations:^&#123;</div><div class="line">        window.alpha = 0;</div><div class="line">    &#125; completion:^(BOOL finished) &#123;</div><div class="line">        exit(0);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="验证身份证-本人试过-还挺准的"><a href="#验证身份证-本人试过-还挺准的" class="headerlink" title="验证身份证(本人试过,还挺准的)"></a>验证身份证(本人试过,还挺准的)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)checkIdentityCardNo:(NSString*)value &#123;</div><div class="line">    value = [value stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceAndNewlineCharacterSet]];</div><div class="line">    NSInteger length =0;</div><div class="line">    if (!value) &#123;</div><div class="line">        return NO;</div><div class="line">    &#125;else &#123;</div><div class="line">        length = value.length;</div><div class="line">        if (length !=15 &amp;&amp; length !=18) &#123;</div><div class="line">            return NO;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    // 省份代码</div><div class="line">    NSArray *areasArray =@[@&quot;11&quot;,@&quot;12&quot;, @&quot;13&quot;,@&quot;14&quot;, @&quot;15&quot;,@&quot;21&quot;, @&quot;22&quot;,@&quot;23&quot;, @&quot;31&quot;,@&quot;32&quot;, @&quot;33&quot;,@&quot;34&quot;, @&quot;35&quot;,@&quot;36&quot;, @&quot;37&quot;,@&quot;41&quot;, @&quot;42&quot;,@&quot;43&quot;, @&quot;44&quot;,@&quot;45&quot;, @&quot;46&quot;,@&quot;50&quot;, @&quot;51&quot;,@&quot;52&quot;, @&quot;53&quot;,@&quot;54&quot;, @&quot;61&quot;,@&quot;62&quot;, @&quot;63&quot;,@&quot;64&quot;, @&quot;65&quot;,@&quot;71&quot;, @&quot;81&quot;,@&quot;82&quot;, @&quot;91&quot;];</div><div class="line">    NSString *valueStart2 = [value substringToIndex:2];</div><div class="line">    BOOL areaFlag =NO;</div><div class="line">    for (NSString *areaCode in areasArray) &#123;</div><div class="line">        if ([areaCode isEqualToString:valueStart2]) &#123;</div><div class="line">            areaFlag =YES;</div><div class="line">            break;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    if (!areaFlag) &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    NSRegularExpression *regularExpression;</div><div class="line">    NSUInteger numberofMatch;</div><div class="line">    NSInteger year =0;</div><div class="line">    switch (length) &#123;</div><div class="line">        case 15:</div><div class="line">            year = [[value substringWithRange:NSMakeRange(6,2)] integerValue] +1900;</div><div class="line">            if (year %4 ==0 || (year 0 ==0 &amp;&amp; year %4 ==0)) &#123;</div><div class="line">                regularExpression = [[NSRegularExpression alloc]initWithPattern:@&quot;^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;$&quot;</div><div class="line">                                                                       options:NSRegularExpressionCaseInsensitive</div><div class="line">                                                                         error:nil];//测试出生日期的合法性</div><div class="line">            &#125;else &#123;</div><div class="line">                regularExpression = [[NSRegularExpression alloc]initWithPattern:@&quot;^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;$&quot;</div><div class="line">                                                                       options:NSRegularExpressionCaseInsensitive</div><div class="line">                                                                         error:nil];//测试出生日期的合法性</div><div class="line">            &#125;</div><div class="line">            numberofMatch = [regularExpression numberOfMatchesInString:value                                                 options:NSMatchingReportProgress</div><div class="line">                           range:NSMakeRange(0, value.length)];</div><div class="line">            if(numberofMatch &gt;0) &#123;</div><div class="line">                return YES;</div><div class="line">            &#125;else &#123;</div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">        case 18:</div><div class="line">            year = [value substringWithRange:NSMakeRange(6,4)].intValue;</div><div class="line">            if (year %4 ==0 || (year 0 ==0 &amp;&amp; year %4 ==0)) &#123;</div><div class="line">                regularExpression = [[NSRegularExpression alloc]initWithPattern:@&quot;^[1-9][0-9]&#123;5&#125;19[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;[0-9Xx]$&quot;</div><div class="line">options:NSRegularExpressionCaseInsensitive                                                                     error:nil];//测试出生日期的合法性</div><div class="line">            &#125;else &#123;</div><div class="line">                regularExpression = [[NSRegularExpression alloc]initWithPattern:@&quot;^[1-9][0-9]&#123;5&#125;19[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;[0-9Xx]$&quot;                                                                      options:NSRegularExpressionCaseInsensitive                                                                     error:nil];//测试出生日期的合法性</div><div class="line">            &#125;</div><div class="line">            numberofMatch = [regularExpression numberOfMatchesInString:value                                                 options:NSMatchingReportProgress                                                     range:NSMakeRange(0, value.length)];</div><div class="line">            if(numberofMatch &gt;0) &#123;</div><div class="line">                int S = ([value substringWithRange:NSMakeRange(0,1)].intValue + [value substringWithRange:NSMakeRange(10,1)].intValue) *7 + ([value substringWithRange:NSMakeRange(1,1)].intValue + [value substringWithRange:NSMakeRange(11,1)].intValue) *9 + ([value substringWithRange:NSMakeRange(2,1)].intValue + [value substringWithRange:NSMakeRange(12,1)].intValue) *10 + ([value substringWithRange:NSMakeRange(3,1)].intValue + [value substringWithRange:NSMakeRange(13,1)].intValue) *5 + ([value substringWithRange:NSMakeRange(4,1)].intValue + [value substringWithRange:NSMakeRange(14,1)].intValue) *8 + ([value substringWithRange:NSMakeRange(5,1)].intValue + [value substringWithRange:NSMakeRange(15,1)].intValue) *4 + ([value substringWithRange:NSMakeRange(6,1)].intValue + [value substringWithRange:NSMakeRange(16,1)].intValue) *2 + [value substringWithRange:NSMakeRange(7,1)].intValue *1 + [value substringWithRange:NSMakeRange(8,1)].intValue *6 + [value substringWithRange:NSMakeRange(9,1)].intValue *3;</div><div class="line">                int Y = S ;</div><div class="line">                NSString *M =@&quot;F&quot;;</div><div class="line">                NSString *JYM =@&quot;10X98765432&quot;;</div><div class="line">                M = [JYM substringWithRange:NSMakeRange(Y,1)];// 判断校验位</div><div class="line">                if ([M isEqualToString:[value substringWithRange:NSMakeRange(17,1)]]) &#123;</div><div class="line">                    return YES;// 检测ID的校验位</div><div class="line">                &#125;else &#123;</div><div class="line">                    return NO;</div><div class="line">                &#125;</div><div class="line">            &#125;else &#123;</div><div class="line">                return NO;</div><div class="line">            &#125;</div><div class="line">        default:</div><div class="line">            return false;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="设置Label里的字符有不同的颜色"><a href="#设置Label里的字符有不同的颜色" class="headerlink" title="设置Label里的字符有不同的颜色"></a>设置Label里的字符有不同的颜色</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">//可根据自己的需求进行增删改</div><div class="line">- (void)stringColorSet &#123;</div><div class="line">    NSString*string = @&quot;如何使得Label里的字符有不同的颜色？&quot;;</div><div class="line">    NSRange range = [string rangeOfString: @&quot;Label&quot;];</div><div class="line">    NSMutableAttributedString*attribute = [[NSMutableAttributedString alloc] initWithString: string];</div><div class="line">    [attribute addAttributes: @&#123;NSForegroundColorAttributeName: [UIColor redColor]&#125;range: range];</div><div class="line">    [attribute addAttributes: @&#123;NSForegroundColorAttributeName: [UIColor greenColor]&#125;range: NSMakeRange(0, range.location)];</div><div class="line">    [attribute addAttributes: @&#123;NSForegroundColorAttributeName: [UIColor cyanColor]&#125;range: NSMakeRange(range.location+ range.length, 5)];</div><div class="line">    UILabel *label = [[UILabel alloc] initWithFrame: CGRectMake(0.0f, 100.0f, 320.0f, 100.0f)];</div><div class="line">    [label setText: string];</div><div class="line">    [label setAttributedText: attribute];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="磁盘总空间大小"><a href="#磁盘总空间大小" class="headerlink" title="磁盘总空间大小"></a>磁盘总空间大小</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">+ (CGFloat)diskOfAllSizeMBytes</div><div class="line">&#123;</div><div class="line">    CGFloat size = 0.0;</div><div class="line">    NSError *error;</div><div class="line">    NSDictionary *dic = [[NSFileManager defaultManager] attributesOfFileSystemForPath:NSHomeDirectory() error:&amp;error];</div><div class="line">    if (error) &#123;</div><div class="line">#ifdef DEBUG</div><div class="line">        NSLog(@&quot;error: %@&quot;, error.localizedDescription);</div><div class="line">#endif</div><div class="line">    &#125;else&#123;</div><div class="line">        NSNumber *number = [dic objectForKey:NSFileSystemSize];</div><div class="line">        size = [number floatValue]/1024/1024;</div><div class="line">    &#125;</div><div class="line">    return size;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="磁盘可用空间大小"><a href="#磁盘可用空间大小" class="headerlink" title="磁盘可用空间大小"></a>磁盘可用空间大小</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">+ (CGFloat)diskOfFreeSizeMBytes</div><div class="line">&#123;</div><div class="line">    CGFloat size = 0.0;</div><div class="line">    NSError *error;</div><div class="line">    NSDictionary *dic = [[NSFileManager defaultManager] attributesOfFileSystemForPath:NSHomeDirectory() error:&amp;error];</div><div class="line">    if (error) &#123;</div><div class="line">#ifdef DEBUG</div><div class="line">        NSLog(@&quot;error: %@&quot;, error.localizedDescription);</div><div class="line">#endif</div><div class="line">    &#125;else&#123;</div><div class="line">        NSNumber *number = [dic objectForKey:NSFileSystemFreeSize];</div><div class="line">        size = [number floatValue]/1024/1024;</div><div class="line">    &#125;</div><div class="line">    return size;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="将字符串数组按照元素首字母顺序进行排序分组"><a href="#将字符串数组按照元素首字母顺序进行排序分组" class="headerlink" title="将字符串数组按照元素首字母顺序进行排序分组"></a>将字符串数组按照元素首字母顺序进行排序分组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">+ (NSDictionary *)dictionaryOrderByCharacterWithOriginalArray:(NSArray *)array</div><div class="line">&#123;</div><div class="line">    if (array.count == 0) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    for (id obj in array) &#123;</div><div class="line">        if (![obj isKindOfClass:[NSString class]]) &#123;</div><div class="line">            return nil;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    UILocalizedIndexedCollation *indexedCollation = [UILocalizedIndexedCollation currentCollation];</div><div class="line">    NSMutableArray *objects = [NSMutableArray arrayWithCapacity:indexedCollation.sectionTitles.count];</div><div class="line">    //创建27个分组数组</div><div class="line">    for (int i = 0; i &lt; indexedCollation.sectionTitles.count; i++) &#123;</div><div class="line">        NSMutableArray *obj = [NSMutableArray array];</div><div class="line">        [objects addObject:obj];</div><div class="line">    &#125;</div><div class="line">    NSMutableArray *keys = [NSMutableArray arrayWithCapacity:objects.count];</div><div class="line">    //按字母顺序进行分组</div><div class="line">    NSInteger lastIndex = -1;</div><div class="line">    for (int i = 0; i &lt; array.count; i++) &#123;</div><div class="line">        NSInteger index = [indexedCollation sectionForObject:array[i] collationStringSelector:@selector(uppercaseString)];</div><div class="line">        [[objects objectAtIndex:index] addObject:array[i]];</div><div class="line">        lastIndex = index;</div><div class="line">    &#125;</div><div class="line">    //去掉空数组</div><div class="line">    for (int i = 0; i &lt; objects.count; i++) &#123;</div><div class="line">        NSMutableArray *obj = objects[i];</div><div class="line">        if (obj.count == 0) &#123;</div><div class="line">            [objects removeObject:obj];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    //获取索引字母</div><div class="line">    for (NSMutableArray *obj in objects) &#123;</div><div class="line">        NSString *str = obj[0];</div><div class="line">        NSString *key = [self firstCharacterWithString:str];</div><div class="line">        [keys addObject:key];</div><div class="line">    &#125;</div><div class="line">    NSMutableDictionary *dic = [NSMutableDictionary dictionary];</div><div class="line">    [dic setObject:objects forKey:keys];</div><div class="line">    return dic;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="将字符串数组按照元素首字母顺序进行排序分组-1"><a href="#将字符串数组按照元素首字母顺序进行排序分组-1" class="headerlink" title="将字符串数组按照元素首字母顺序进行排序分组"></a>将字符串数组按照元素首字母顺序进行排序分组</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">+ (NSDictionary *)dictionaryOrderByCharacterWithOriginalArray:(NSArray *)array</div><div class="line">&#123;</div><div class="line">    if (array.count == 0) &#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">    for (id obj in array) &#123;</div><div class="line">        if (![obj isKindOfClass:[NSString class]]) &#123;</div><div class="line">            return nil;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    UILocalizedIndexedCollation *indexedCollation = [UILocalizedIndexedCollation currentCollation];</div><div class="line">    NSMutableArray *objects = [NSMutableArray arrayWithCapacity:indexedCollation.sectionTitles.count];</div><div class="line">    //创建27个分组数组</div><div class="line">    for (int i = 0; i &lt; indexedCollation.sectionTitles.count; i++) &#123;</div><div class="line">        NSMutableArray *obj = [NSMutableArray array];</div><div class="line">        [objects addObject:obj];</div><div class="line">    &#125;</div><div class="line">    NSMutableArray *keys = [NSMutableArray arrayWithCapacity:objects.count];</div><div class="line">    //按字母顺序进行分组</div><div class="line">    NSInteger lastIndex = -1;</div><div class="line">    for (int i = 0; i &lt; array.count; i++) &#123;</div><div class="line">        NSInteger index = [indexedCollation sectionForObject:array[i] collationStringSelector:@selector(uppercaseString)];</div><div class="line">        [[objects objectAtIndex:index] addObject:array[i]];</div><div class="line">        lastIndex = index;</div><div class="line">    &#125;</div><div class="line">    //去掉空数组</div><div class="line">    for (int i = 0; i &lt; objects.count; i++) &#123;</div><div class="line">        NSMutableArray *obj = objects[i];</div><div class="line">        if (obj.count == 0) &#123;</div><div class="line">            [objects removeObject:obj];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    //获取索引字母</div><div class="line">    for (NSMutableArray *obj in objects) &#123;</div><div class="line">        NSString *str = obj[0];</div><div class="line">        NSString *key = [self firstCharacterWithString:str];</div><div class="line">        [keys addObject:key];</div><div class="line">    &#125;</div><div class="line">    NSMutableDictionary *dic = [NSMutableDictionary dictionary];</div><div class="line">    [dic setObject:objects forKey:keys];</div><div class="line">    return dic;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="对图片进行滤镜处理"><a href="#对图片进行滤镜处理" class="headerlink" title="对图片进行滤镜处理"></a>对图片进行滤镜处理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">// 怀旧 --&gt; CIPhotoEffectInstant                         单色 --&gt; CIPhotoEffectMono</div><div class="line">// 黑白 --&gt; CIPhotoEffectNoir                            褪色 --&gt; CIPhotoEffectFade</div><div class="line">// 色调 --&gt; CIPhotoEffectTonal                           冲印 --&gt; CIPhotoEffectProcess</div><div class="line">// 岁月 --&gt; CIPhotoEffectTransfer                        铬黄 --&gt; CIPhotoEffectChrome</div><div class="line">// CILinearToSRGBToneCurve, CISRGBToneCurveToLinear, CIGaussianBlur, CIBoxBlur, CIDiscBlur, CISepiaTone, CIDepthOfField</div><div class="line">+ (UIImage *)filterWithOriginalImage:(UIImage *)image filterName:(NSString *)name</div><div class="line">&#123;</div><div class="line">    CIContext *context = [CIContext contextWithOptions:nil];</div><div class="line">    CIImage *inputImage = [[CIImage alloc] initWithImage:image];</div><div class="line">    CIFilter *filter = [CIFilter filterWithName:name];</div><div class="line">    [filter setValue:inputImage forKey:kCIInputImageKey];</div><div class="line">    CIImage *result = [filter valueForKey:kCIOutputImageKey];</div><div class="line">    CGImageRef cgImage = [context createCGImage:result fromRect:[result extent]];</div><div class="line">    UIImage *resultImage = [UIImage imageWithCGImage:cgImage];</div><div class="line">    CGImageRelease(cgImage);</div><div class="line">    return resultImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="对图片进行模糊处理"><a href="#对图片进行模糊处理" class="headerlink" title="对图片进行模糊处理"></a>对图片进行模糊处理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">// CIGaussianBlur ---&gt; 高斯模糊</div><div class="line">// CIBoxBlur      ---&gt; 均值模糊(Available in iOS 9.0 and later)</div><div class="line">// CIDiscBlur     ---&gt; 环形卷积模糊(Available in iOS 9.0 and later)</div><div class="line">// CIMedianFilter ---&gt; 中值模糊, 用于消除图像噪点, 无需设置radius(Available in iOS 9.0 and later)</div><div class="line">// CIMotionBlur   ---&gt; 运动模糊, 用于模拟相机移动拍摄时的扫尾效果(Available in iOS 9.0 and later)</div><div class="line">+ (UIImage *)blurWithOriginalImage:(UIImage *)image </div><div class="line">                            blurName:(NSString *)name </div><div class="line">                            radius:(NSInteger)radius</div><div class="line">&#123;</div><div class="line">    CIContext *context = [CIContext contextWithOptions:nil];</div><div class="line">    CIImage *inputImage = [[CIImage alloc] initWithImage:image];</div><div class="line">    CIFilter *filter;</div><div class="line">    if (name.length != 0) &#123;</div><div class="line">        filter = [CIFilter filterWithName:name];</div><div class="line">        [filter setValue:inputImage forKey:kCIInputImageKey];</div><div class="line">        if (![name isEqualToString:@&quot;CIMedianFilter&quot;]) &#123;</div><div class="line">            [filter setValue:@(radius) forKey:@&quot;inputRadius&quot;];</div><div class="line">        &#125;</div><div class="line">        CIImage *result = [filter valueForKey:kCIOutputImageKey];</div><div class="line">        CGImageRef cgImage = [context createCGImage:result fromRect:[result extent]];</div><div class="line">        UIImage *resultImage = [UIImage imageWithCGImage:cgImage];</div><div class="line">        CGImageRelease(cgImage);</div><div class="line">        return resultImage;</div><div class="line">    &#125;else&#123;</div><div class="line">        return nil;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="跳转到系统的相关界面"><a href="#跳转到系统的相关界面" class="headerlink" title="跳转到系统的相关界面"></a>跳转到系统的相关界面</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> *  需要添加一个字段</div><div class="line"> *  蓝色的项目工程文件 -&gt; Info -&gt; URL Types -&gt; 添加一个 -&gt; 设置URL  Sch**** 为 prefs的url</div><div class="line">  </div><div class="line"> NSURL *url = [NSURL URLWithString:@&quot;prefs:root=WIFI&quot;];</div><div class="line"> if ([[UIApplication sharedApplication] canOpenURL:url])</div><div class="line">&#123;</div><div class="line">[[UIApplication sharedApplication] openURL:url];</div><div class="line">&#125;</div><div class="line">  </div><div class="line"> 跳转到其他的界面的字段(不全,详细看链接)</div><div class="line">About — prefs:root=General&amp;path=About  </div><div class="line"></div><div class="line">Accessibility — prefs:root=General&amp;path=ACCESSIBILITY  </div><div class="line"></div><div class="line">AirplaneModeOn— prefs:root=AIRPLANE_MODE  </div><div class="line"></div><div class="line">Auto-Lock — prefs:root=General&amp;path=AUTOLOCK  </div><div class="line"></div><div class="line">Brightness — prefs:root=Brightness  </div><div class="line"></div><div class="line">Bluetooth — prefs:root=General&amp;path=Bluetooth</div><div class="line"></div><div class="line">Date&amp; Time — prefs:root=General&amp;path=DATE_AND_TIME  </div><div class="line"></div><div class="line">FaceTime — prefs:root=FACETIME</div><div class="line"></div><div class="line">General— prefs:root=General</div><div class="line"></div><div class="line">Keyboard — prefs:root=General&amp;path=Keyboard  </div><div class="line"></div><div class="line">iCloud — prefs:root=CASTLE  iCloud </div><div class="line"></div><div class="line">Storage &amp; Backup — prefs:root=CASTLE&amp;path=STORAGE_AND_BACKUP  </div><div class="line"></div><div class="line">International — prefs:root=General&amp;path=INTERNATIONAL  </div><div class="line"></div><div class="line">Location Services — prefs:root=LOCATION_SERVICES  </div><div class="line"></div><div class="line">Music — prefs:root=MUSIC  </div><div class="line"></div><div class="line">Music Equalizer — prefs:root=MUSIC&amp;path=EQ  </div><div class="line"></div><div class="line">Music VolumeLimit— prefs:root=MUSIC&amp;path=VolumeLimit  </div><div class="line"></div><div class="line">Network — prefs:root=General&amp;path=Network  </div><div class="line"></div><div class="line">Nike + iPod — prefs:root=NIKE_PLUS_IPOD  </div><div class="line"></div><div class="line">Notes — prefs:root=NOTES  </div><div class="line"></div><div class="line">Notification — prefs:root=NOTIFICATIONS_ID  </div><div class="line"></div><div class="line">Phone — prefs:root=Phone  </div><div class="line"></div><div class="line">Photos — prefs:root=Photos  </div><div class="line"></div><div class="line">Profile — prefs:root=General&amp;path=ManagedConfigurationList  </div><div class="line"></div><div class="line">Reset — prefs:root=General&amp;path=Reset  </div><div class="line"></div><div class="line">Safari — prefs:root=Safari  Siri — prefs:root=General&amp;path=Assistant  </div><div class="line"></div><div class="line">Sounds — prefs:root=Sounds  </div><div class="line"></div><div class="line">SoftwareUpdate— prefs:root=General&amp;path=SOFTWARE_UPDATE_LINK  </div><div class="line"></div><div class="line">Store — prefs:root=STORE  </div><div class="line"></div><div class="line">Twitter — prefs:root=TWITTER  </div><div class="line"></div><div class="line">Usage — prefs:root=General&amp;path=USAGE  </div><div class="line"></div><div class="line">VPN — prefs:root=General&amp;path=Network/VPN  </div><div class="line"></div><div class="line">Wallpaper — prefs:root=Wallpaper  </div><div class="line"></div><div class="line">Wi-Fi — prefs:root=WIFI</div><div class="line"></div><div class="line">Setting—prefs:root=INTERNET_TETHERING</div><div class="line">  </div><div class="line"> */</div></pre></td></tr></table></figure>
<h4 id="创建一张实时模糊效果-View-毛玻璃效果"><a href="#创建一张实时模糊效果-View-毛玻璃效果" class="headerlink" title="创建一张实时模糊效果 View (毛玻璃效果)"></a>创建一张实时模糊效果 View (毛玻璃效果)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//Avilable in iOS 8.0 and later</div><div class="line">+ (UIVisualEffectView *)effectViewWithFrame:(CGRect)frame</div><div class="line">&#123;</div><div class="line">    UIBlurEffect *effect = [UIBlurEffect effectWithStyle:UIBlurEffectStyleLight];</div><div class="line">    UIVisualEffectView *effectView = [[UIVisualEffectView alloc] initWithEffect:effect];</div><div class="line">    effectView.frame = frame;</div><div class="line">    return effectView;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="设置Label的行间距"><a href="#设置Label的行间距" class="headerlink" title="设置Label的行间距"></a>设置Label的行间距</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">+ (void)setLineSpaceWithString:(UILabel *)label</div><div class="line">&#123;</div><div class="line">     </div><div class="line">    NSMutableAttributedString *attributedString =</div><div class="line">    [[NSMutableAttributedString alloc] initWithString:label.text];</div><div class="line">    NSMutableParagraphStyle *paragraphStyle =  [[NSMutableParagraphStyle alloc] init];</div><div class="line">    [paragraphStyle setLineSpacing:3];</div><div class="line">     </div><div class="line">    //调整行间距</div><div class="line">    [attributedString addAttribute:NSParagraphStyleAttributeName</div><div class="line">                             value:paragraphStyle</div><div class="line">                             range:NSMakeRange(0, [label.text length])];</div><div class="line">    label.attributedText = attributedString;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="让Plain风格的TableView的区头可以”不悬停”-可以直接百度搜到"><a href="#让Plain风格的TableView的区头可以”不悬停”-可以直接百度搜到" class="headerlink" title="让Plain风格的TableView的区头可以”不悬停”(可以直接百度搜到):"></a>让Plain风格的TableView的区头可以”不悬停”(可以直接百度搜到):</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView </div><div class="line">&#123;</div><div class="line">     if(scrollView == self.myTab) &#123;</div><div class="line">         CGFloat sectionHeaderHeight = 40;</div><div class="line">         if (scrollView.contentOffset.y=0) &#123;</div><div class="line">              </div><div class="line">             scrollView.contentInset = UIEdgeInsetsMake(-scrollView.contentOffset.y, 0, 0, 0);</div><div class="line">         &#125; else if (scrollView.contentOffset.y&gt;=sectionHeaderHeight) &#123;</div><div class="line">              </div><div class="line">             scrollView.contentInset = UIEdgeInsetsMake(-sectionHeaderHeight, 0, 0, 0);</div><div class="line">         &#125;</div><div class="line">     &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="清理缓存功能的实现"><a href="#清理缓存功能的实现" class="headerlink" title="清理缓存功能的实现"></a>清理缓存功能的实现</h4><p>移动应用在处理网络资源时，一般都会做离线缓存处理，其中以图片缓存最为典型，其中很流行的离线缓存框架为SDWebImage。</p>
<p>但是，离线缓存会占用手机存储空间，所以缓存清理功能基本成为资讯、购物、阅读类app的标配功能。</p>
<p>下面介绍的离线缓存功能的实现，主要分为缓存文件大小的获取、删除缓存文件的实现。</p>
<h5 id="获取缓存文件的大小"><a href="#获取缓存文件的大小" class="headerlink" title="获取缓存文件的大小"></a><strong>获取缓存文件的大小</strong></h5><p>由于缓存文件存在沙箱中，我们可以通过NSFileManager API来实现对缓存文件大小的计算。</p>
<h5 id="计算单个文件大小"><a href="#计算单个文件大小" class="headerlink" title="计算单个文件大小"></a><strong>计算单个文件大小</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">+(float)fileSizeAtPath:(NSString *)path&#123;</div><div class="line">    NSFileManager *fileManager=[NSFileManager defaultManager];</div><div class="line">    if([fileManager fileExistsAtPath:path])&#123;</div><div class="line">        long long size=[fileManager attributesOfItemAtPath:path error:nil].fileSize;</div><div class="line">        return size/1024.0/1024.0;</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="计算目录大小"><a href="#计算目录大小" class="headerlink" title="计算目录大小"></a><strong>计算目录大小</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">+(float)folderSizeAtPath:(NSString *)path&#123;</div><div class="line">    NSFileManager *fileManager=[NSFileManager defaultManager];</div><div class="line">    float folderSize;</div><div class="line">    if ([fileManager fileExistsAtPath:path]) &#123;</div><div class="line">        NSArray *childerFiles=[fileManager subpathsAtPath:path];</div><div class="line">        for (NSString *fileName in childerFiles) &#123;</div><div class="line">            NSString *absolutePath=[path stringByAppendingPathComponent:fileName];</div><div class="line">            folderSize +=[FileService fileSizeAtPath:absolutePath];</div><div class="line">        &#125;</div><div class="line">　　　　　//SDWebImage框架自身计算缓存的实现</div><div class="line">        folderSize+=[[SDImageCache sharedImageCache] getSize]/1024.0/1024.0;</div><div class="line">        return folderSize;</div><div class="line">    &#125;</div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="清理缓存文件"><a href="#清理缓存文件" class="headerlink" title="清理缓存文件"></a><strong>清理缓存文件</strong></h5><p>同样也是利用NSFileManager API进行文件操作，SDWebImage框架自己实现了清理缓存操作，我们可以直接调用。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+(void)clearCache:(NSString *)path&#123;</div><div class="line">    NSFileManager *fileManager=[NSFileManager defaultManager];</div><div class="line">    if ([fileManager fileExistsAtPath:path]) &#123;</div><div class="line">        NSArray *childerFiles=[fileManager subpathsAtPath:path];</div><div class="line">        for (NSString *fileName in childerFiles) &#123;</div><div class="line">            //如有需要，加入条件，过滤掉不想删除的文件</div><div class="line">            NSString *absolutePath=[path stringByAppendingPathComponent:fileName];</div><div class="line">            [fileManager removeItemAtPath:absolutePath error:nil];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    [[SDImageCache sharedImageCache] cleanDisk];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="比较number型的数据是否相同"><a href="#比较number型的数据是否相同" class="headerlink" title="比较number型的数据是否相同"></a>比较number型的数据是否相同</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSNumber *num1 = [[NSNumber alloc]initWithInt:10];</div><div class="line">NSNumber *num2 = [NSNumber numberWithInt:10];</div><div class="line">//isEqualToNumber: 比较的是对象中存储的数据</div><div class="line">BOOL isEqual = [num1 isEqualToNumber:num2];</div><div class="line">NSLog(@&quot;isEqual=%d&quot;, isEqual);</div><div class="line">    </div><div class="line">NSNumber *num = [NSNumber numberWithInt:score];</div></pre></td></tr></table></figure>
<h4 id="比较字符串的大小"><a href="#比较字符串的大小" class="headerlink" title="比较字符串的大小"></a>比较字符串的大小</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">NSString *str1=@&quot;xuzhonglin&quot;;</div><div class="line">NSString *str2=@&quot;sunkeqiang&quot;;</div><div class="line">NSComparisonResult result = [str1 caseInsensitiveCompare:str2];</div><div class="line">if (result == NSOrderedAscending)&#123;</div><div class="line">    NSLog(@&quot;升序，str1&lt;str2&quot;);</div><div class="line">&#125;else if(result == NSOrderedSame)&#123;</div><div class="line">    NSLog(@&quot;大小相同&quot;);</div><div class="line">&#125;else if (result == NSOrderedDescending)&#123;</div><div class="line">    NSLog(@&quot;降序，str1&gt;str2&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/16/iOS开发技巧/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/16/iOS开发技巧/" itemprop="url">
                  iOS开发技巧(一)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-16T22:53:03+08:00">
                2017-01-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/16/iOS开发技巧/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/16/iOS开发技巧/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/16/iOS开发技巧/" class="leancloud_visitors" data-flag-title="iOS开发技巧(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="常用代码块"><a href="#常用代码块" class="headerlink" title="常用代码块"></a>常用代码块</h2><h4 id="遍历可变数组的同时删除数组元素"><a href="#遍历可变数组的同时删除数组元素" class="headerlink" title="遍历可变数组的同时删除数组元素"></a>遍历可变数组的同时删除数组元素</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSMutableArray *copyArray = [NSMutableArray arrayWithArray:array];   </div><div class="line">NSString *str1 = @“zhangsan”;  </div><div class="line">for (AddressPerson *perName in copyArray) &#123;  </div><div class="line">    if ([[perName name] isEqualToString:str1]) &#123;  </div><div class="line">        [array removeObject:perName];  </div><div class="line">   &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取系统当前语言"><a href="#获取系统当前语言" class="headerlink" title="获取系统当前语言"></a><strong>获取系统当前语言</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">NSString *currentLanguage = [[NSLocale preferredLanguages] objectAtIndex:0];</div><div class="line">NSLog(@&quot;currentlanguage = %@&quot;,currentLanguage);</div><div class="line"></div><div class="line">if ([currentLanguage containsString:@&quot;zh-Hans&quot;]) &#123;</div><div class="line">    NSLog(@&quot;zh-Hans简体中文&quot;);</div><div class="line">&#125;else if ([currentLanguage containsString:@&quot;zh-Hant&quot;]) &#123;</div><div class="line">    NSLog(@&quot;zh-Hant繁体中文&quot;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// 当前所在地信息</div><div class="line">NSString *identifier = [[NSLocalecurrentLocale] localeIdentifier];</div><div class="line">NSString *displayName = [[NSLocale currentLocale] displayNameForKey:NSLocaleIdentifiervalue:identifier];</div><div class="line">NSLog(@&apos;%@&apos;, displayName);</div><div class="line">// 当前所在地的使用语言</div><div class="line">NSLocale *currentLocale = [NSLocale currentLocale];</div><div class="line">NSLog(@&apos;Language Code is %@&apos;, [currentLocale objectForKey:NSLocaleLanguageCode]);</div><div class="line">// 系统语言</div><div class="line">NSArray *arLanguages = [[NSUserDefaultsstandardUserDefaults] objectForKey:@&apos;AppleLanguages&apos;];</div><div class="line">NSString *strLang = [arLanguages objectAtIndex:0];</div><div class="line">NSLog(@&apos;LANG:%@&apos;,strLang);</div></pre></td></tr></table></figure>
<h4 id="UITableView的Group样式下顶部空白处理"><a href="#UITableView的Group样式下顶部空白处理" class="headerlink" title="UITableView的Group样式下顶部空白处理"></a><strong>UITableView的Group样式下顶部空白处理</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UIView *view = [[UIView alloc] initWithFrame:CGRectMake(0, 0, 0, 0.1)];</div><div class="line">self.tableView.tableHeaderView = view;</div></pre></td></tr></table></figure>
<h4 id="UITableView的plain样式下，取消区头停滞效果"><a href="#UITableView的plain样式下，取消区头停滞效果" class="headerlink" title="UITableView的plain样式下，取消区头停滞效果"></a><strong>UITableView的plain样式下，取消区头停滞效果</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">    CGFloat sectionHeaderHeight = sectionHead.height;</div><div class="line">    if (scrollView.contentOffset.y&lt;=sectionHeaderHeight&amp;&amp;scrollView;.contentOffset.y&gt;=0)</div><div class="line">    &#123;</div><div class="line">        scrollView.contentInset = UIEdgeInsetsMake(-scrollView.contentOffset.y, 0, 0, 0);</div><div class="line">    &#125;</div><div class="line">    else if(scrollView.contentOffset.y&gt;=sectionHeaderHeight)</div><div class="line">    &#123;</div><div class="line">        scrollView.contentInset = UIEdgeInsetsMake(-sectionHeaderHeight, 0, 0, 0);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取某个view所在的控制器"><a href="#获取某个view所在的控制器" class="headerlink" title="获取某个view所在的控制器"></a><strong>获取某个view所在的控制器</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (UIViewController *)viewController</div><div class="line">&#123;</div><div class="line">  UIViewController *viewController = nil;  </div><div class="line">  UIResponder *next = self.nextResponder;</div><div class="line">  while (next)</div><div class="line">  &#123;</div><div class="line">    if ([next isKindOfClass:[UIViewController class]])</div><div class="line">    &#123;</div><div class="line">      viewController = (UIViewController *)next;      </div><div class="line">      break;    </div><div class="line">    &#125;    </div><div class="line">    next = next.nextResponder;  </div><div class="line">  &#125; </div><div class="line">    return viewController;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="两种方法删除NSUserDefaults所有记录"><a href="#两种方法删除NSUserDefaults所有记录" class="headerlink" title="两种方法删除NSUserDefaults所有记录"></a><strong>两种方法删除NSUserDefaults所有记录</strong></h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">//方法一</div><div class="line">NSString *appDomain = [[NSBundle mainBundle] bundleIdentifier];</div><div class="line">[[NSUserDefaults standardUserDefaults] removePersistentDomainForName:appDomain];</div><div class="line"></div><div class="line"></div><div class="line">//方法二</div><div class="line">- (void)resetDefaults</div><div class="line">&#123;</div><div class="line">    NSUserDefaults * defs = [NSUserDefaults standardUserDefaults];</div><div class="line">    NSDictionary * dict = [defs dictionaryRepresentation];</div><div class="line">    for (id key in dict)</div><div class="line">    &#123;</div><div class="line">        [defs removeObjectForKey:key];</div><div class="line">    &#125;</div><div class="line">    [defs synchronize];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="打印系统所有已注册的字体名称"><a href="#打印系统所有已注册的字体名称" class="headerlink" title="打印系统所有已注册的字体名称"></a><strong>打印系统所有已注册的字体名称</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">void enumerateFonts()</div><div class="line">&#123;</div><div class="line">    for(NSString *familyName in [UIFont familyNames])</div><div class="line">   &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,familyName);               </div><div class="line">        NSArray *fontNames = [UIFont fontNamesForFamilyName:familyName];       </div><div class="line">        for(NSString *fontName in fontNames)</div><div class="line">       &#123;</div><div class="line">            NSLog(@&quot;\t|- %@&quot;,fontName);</div><div class="line">       &#125;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取图片某一点的颜色"><a href="#获取图片某一点的颜色" class="headerlink" title="获取图片某一点的颜色"></a><strong>获取图片某一点的颜色</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">- (UIColor*) getPixelColorAtLocation:(CGPoint)point inImage:(UIImage *)image</div><div class="line">&#123;</div><div class="line"></div><div class="line">    UIColor* color = nil;</div><div class="line">    CGImageRef inImage = image.CGImage;</div><div class="line">    CGContextRef cgctx = [self createARGBBitmapContextFromImage:inImage];</div><div class="line"></div><div class="line">    if (cgctx == NULL) &#123;</div><div class="line">        return nil; /* error */</div><div class="line">    &#125;</div><div class="line">    size_t w = CGImageGetWidth(inImage);</div><div class="line">    size_t h = CGImageGetHeight(inImage);</div><div class="line">    CGRect rect = &#123;&#123;0,0&#125;,&#123;w,h&#125;&#125;;</div><div class="line"></div><div class="line">    CGContextDrawImage(cgctx, rect, inImage);</div><div class="line">    unsigned char* data = CGBitmapContextGetData (cgctx);</div><div class="line">    if (data != NULL) &#123;</div><div class="line">        int offset = 4*((w*round(point.y))+round(point.x));</div><div class="line">        int alpha =  data[offset];</div><div class="line">        int red = data[offset+1];</div><div class="line">        int green = data[offset+2];</div><div class="line">        int blue = data[offset+3];</div><div class="line">        color = [UIColor colorWithRed:(red/255.0f) green:(green/255.0f) blue:</div><div class="line">                 (blue/255.0f) alpha:(alpha/255.0f)];</div><div class="line">    &#125;</div><div class="line">    CGContextRelease(cgctx);</div><div class="line">    if (data) &#123;</div><div class="line">        free(data);</div><div class="line">    &#125;</div><div class="line">    return color;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="字符串反转"><a href="#字符串反转" class="headerlink" title="字符串反转"></a><strong>字符串反转</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//第一种：</div><div class="line">- (NSString *)reverseWordsInString:(NSString *)str</div><div class="line">&#123;    </div><div class="line">    NSMutableString *newString = [[NSMutableString alloc] initWithCapacity:str.length];</div><div class="line">    for (NSInteger i = str.length - 1; i &gt;= 0 ; i --)</div><div class="line">    &#123;</div><div class="line">        unichar ch = [str characterAtIndex:i];       </div><div class="line">        [newString appendFormat:@&quot;%c&quot;, ch];    </div><div class="line">    &#125;    </div><div class="line">     return newString;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//第二种：</div><div class="line">- (NSString*)reverseWordsInString:(NSString*)str</div><div class="line">&#123;    </div><div class="line">     NSMutableString *reverString = [NSMutableString stringWithCapacity:str.length];    </div><div class="line">     [str enumerateSubstringsInRange:NSMakeRange(0, str.length) options:NSStringEnumerationReverse | NSStringEnumerationByComposedCharacterSequences  usingBlock:^(NSString *substring, NSRange substringRange, NSRange enclosingRange, BOOL *stop) &#123; </div><div class="line">          [reverString appendString:substring];                         </div><div class="line">      &#125;];    </div><div class="line">     return reverString;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="禁止锁屏"><a href="#禁止锁屏" class="headerlink" title="禁止锁屏"></a><strong>禁止锁屏</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//第一种</div><div class="line">[UIApplication sharedApplication].idleTimerDisabled = YES;</div><div class="line">//第二种</div><div class="line">[[UIApplication sharedApplication] setIdleTimerDisabled:YES];</div></pre></td></tr></table></figure>
<h4 id="模态推出透明界面"><a href="#模态推出透明界面" class="headerlink" title="模态推出透明界面"></a><strong>模态推出透明界面</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">UIViewController *vc = [[UIViewController alloc] init];</div><div class="line">UINavigationController *na = [[UINavigationController alloc] initWithRootViewController:vc];</div><div class="line"></div><div class="line">if ([[[UIDevice currentDevice] systemVersion] floatValue] &gt;= 8.0)</div><div class="line">&#123;</div><div class="line">     na.modalPresentationStyle = UIModalPresentationOverCurrentContext;</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">     self.modalPresentationStyle=UIModalPresentationCurrentContext;</div><div class="line">&#125;</div><div class="line"></div><div class="line">[self presentViewController:na animated:YES completion:nil];</div></pre></td></tr></table></figure>
<h4 id="iOS跳转到App-Store下载应用评分"><a href="#iOS跳转到App-Store下载应用评分" class="headerlink" title="iOS跳转到App Store下载应用评分"></a><strong>iOS跳转到App Store下载应用评分</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@&quot;itms-apps://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?type=Purple+Software&amp;id=APPID&quot;]];</div></pre></td></tr></table></figure>
<h4 id="手动更改iOS状态栏的颜色"><a href="#手动更改iOS状态栏的颜色" class="headerlink" title="手动更改iOS状态栏的颜色"></a><strong>手动更改iOS状态栏的颜色</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)setStatusBarBackgroundColor:(UIColor *)color</div><div class="line">&#123;</div><div class="line">    UIView *statusBar = [[[UIApplication sharedApplication] valueForKey:@&quot;statusBarWindow&quot;] valueForKey:@&quot;statusBar&quot;];</div><div class="line"></div><div class="line">    if ([statusBar respondsToSelector:@selector(setBackgroundColor:)])</div><div class="line">    &#123;</div><div class="line">        statusBar.backgroundColor = color;    </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断当前ViewController是push还是present的方式显示"><a href="#判断当前ViewController是push还是present的方式显示" class="headerlink" title="判断当前ViewController是push还是present的方式显示"></a><strong>判断当前ViewController是push还是present的方式显示</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">NSArray *viewcontrollers=self.navigationController.viewControllers;</div><div class="line"></div><div class="line">if (viewcontrollers.count &gt; 1)</div><div class="line">&#123;</div><div class="line">    if ([viewcontrollers objectAtIndex:viewcontrollers.count - 1] == self)</div><div class="line">    &#123;</div><div class="line">        //push方式</div><div class="line">       [self.navigationController popViewControllerAnimated:YES];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">else</div><div class="line">&#123;</div><div class="line">    //present方式</div><div class="line">    [self dismissViewControllerAnimated:YES completion:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取实际使用的LaunchImage图片"><a href="#获取实际使用的LaunchImage图片" class="headerlink" title="获取实际使用的LaunchImage图片"></a><strong>获取实际使用的LaunchImage图片</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">- (NSString *)getLaunchImageName</div><div class="line">&#123;</div><div class="line">    CGSize viewSize = self.window.bounds.size;</div><div class="line">    // 竖屏    </div><div class="line">    NSString *viewOrientation = @&quot;Portrait&quot;;  </div><div class="line">    NSString *launchImageName = nil;    </div><div class="line">    NSArray* imagesDict = [[[NSBundle mainBundle] infoDictionary] valueForKey:@&quot;UILaunchImages&quot;];</div><div class="line">    for (NSDictionary* dict in imagesDict)</div><div class="line">    &#123;</div><div class="line">        CGSize imageSize = CGSizeFromString(dict[@&quot;UILaunchImageSize&quot;]);</div><div class="line">        if (CGSizeEqualToSize(imageSize, viewSize) &amp;&amp; [viewOrientation isEqualToString:dict[@&quot;UILaunchImageOrientation&quot;]])</div><div class="line">        &#123;</div><div class="line">            launchImageName = dict[@&quot;UILaunchImageName&quot;];        </div><div class="line">        &#125;    </div><div class="line">    &#125;    </div><div class="line">    return launchImageName;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="iOS在当前屏幕获取第一响应"><a href="#iOS在当前屏幕获取第一响应" class="headerlink" title="iOS在当前屏幕获取第一响应"></a><strong>iOS在当前屏幕获取第一响应</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UIWindow * keyWindow = [[UIApplication sharedApplication] keyWindow];</div><div class="line">UIView * firstResponder = [keyWindow performSelector:@selector(firstResponder)];</div></pre></td></tr></table></figure>
<h4 id="判断对象是否遵循了某协议"><a href="#判断对象是否遵循了某协议" class="headerlink" title="判断对象是否遵循了某协议"></a><strong>判断对象是否遵循了某协议</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">if ([self.selectedController conformsToProtocol:@protocol(RefreshPtotocol)])</div><div class="line">&#123;</div><div class="line">     [self.selectedController performSelector:@selector(onTriggerRefresh)];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="判断view是不是指定视图的子视图"><a href="#判断view是不是指定视图的子视图" class="headerlink" title="判断view是不是指定视图的子视图"></a><strong>判断view是不是指定视图的子视图</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">BOOL isView = [textView isDescendantOfView:self.view];</div></pre></td></tr></table></figure>
<h4 id="NSArray-快速求总和-最大值-最小值-和-平均值"><a href="#NSArray-快速求总和-最大值-最小值-和-平均值" class="headerlink" title="NSArray 快速求总和 最大值 最小值 和 平均值"></a><strong>NSArray 快速求总和 最大值 最小值 和 平均值</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSArray *array = [NSArray arrayWithObjects:@&quot;2.0&quot;, @&quot;2.3&quot;, @&quot;3.0&quot;, @&quot;4.0&quot;, @&quot;10&quot;, nil];</div><div class="line">CGFloat sum = [[array valueForKeyPath:@&quot;@sum.floatValue&quot;] floatValue];</div><div class="line">CGFloat avg = [[array valueForKeyPath:@&quot;@avg.floatValue&quot;] floatValue];</div><div class="line">CGFloat max =[[array valueForKeyPath:@&quot;@max.floatValue&quot;] floatValue];</div><div class="line">CGFloat min =[[array valueForKeyPath:@&quot;@min.floatValue&quot;] floatValue];</div><div class="line">NSLog(@&quot;%f\n%f\n%f\n%f&quot;,sum,avg,max,min);</div></pre></td></tr></table></figure>
<h4 id="修改UITextField中Placeholder的文字颜色"><a href="#修改UITextField中Placeholder的文字颜色" class="headerlink" title="修改UITextField中Placeholder的文字颜色"></a><strong>修改UITextField中Placeholder的文字颜色</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[textField setValue:[UIColor redColor] forKeyPath:@&quot;_placeholderLabel.textColor&quot;];</div></pre></td></tr></table></figure>
<h4 id="获取一个类的所有子类"><a href="#获取一个类的所有子类" class="headerlink" title="获取一个类的所有子类"></a><strong>获取一个类的所有子类</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">+ (NSArray *) allSubclasses</div><div class="line">&#123;</div><div class="line">    Class myClass = [self class];</div><div class="line">    NSMutableArray *mySubclasses = [NSMutableArray array];</div><div class="line">    unsigned int numOfClasses;</div><div class="line">    Class *classes = objc_copyClassList(&amp;numOfClasses;);</div><div class="line">    for (unsigned int ci = 0; ci &lt; numOfClasses; ci++)</div><div class="line">    &#123;</div><div class="line">        Class superClass = classes[ci];</div><div class="line">        do&#123;</div><div class="line">            superClass = class_getSuperclass(superClass);</div><div class="line">        &#125; while (superClass &amp;&amp; superClass != myClass);</div><div class="line"></div><div class="line">        if (superClass)</div><div class="line">        &#123;</div><div class="line">            [mySubclasses addObject: classes[ci]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    free(classes);</div><div class="line">    return mySubclasses;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="阿拉伯数字转中文格式"><a href="#阿拉伯数字转中文格式" class="headerlink" title="阿拉伯数字转中文格式"></a><strong>阿拉伯数字转中文格式</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">+(NSString *)translation:(NSString *)arebic</div><div class="line">&#123;  </div><div class="line">    NSString *str = arebic;</div><div class="line">    NSArray *arabic_numerals = @[@&quot;1&quot;,@&quot;2&quot;,@&quot;3&quot;,@&quot;4&quot;,@&quot;5&quot;,@&quot;6&quot;,@&quot;7&quot;,@&quot;8&quot;,@&quot;9&quot;,@&quot;0&quot;];</div><div class="line">    NSArray *chinese_numerals = @[@&quot;一&quot;,@&quot;二&quot;,@&quot;三&quot;,@&quot;四&quot;,@&quot;五&quot;,@&quot;六&quot;,@&quot;七&quot;,@&quot;八&quot;,@&quot;九&quot;,@&quot;零&quot;];</div><div class="line">    NSArray *digits = @[@&quot;个&quot;,@&quot;十&quot;,@&quot;百&quot;,@&quot;千&quot;,@&quot;万&quot;,@&quot;十&quot;,@&quot;百&quot;,@&quot;千&quot;,@&quot;亿&quot;,@&quot;十&quot;,@&quot;百&quot;,@&quot;千&quot;,@&quot;兆&quot;];</div><div class="line">    NSDictionary *dictionary = [NSDictionary dictionaryWithObjects:chinese_numerals forKeys:arabic_numerals];</div><div class="line"></div><div class="line">    NSMutableArray *sums = [NSMutableArray array];</div><div class="line">    for (int i = 0; i &lt; str.length; i ++) &#123;</div><div class="line">        NSString *substr = [str substringWithRange:NSMakeRange(i, 1)];</div><div class="line">        NSString *a = [dictionary objectForKey:substr];</div><div class="line">        NSString *b = digits[str.length -i-1];</div><div class="line">        NSString *sum = [a stringByAppendingString:b];</div><div class="line">        if ([a isEqualToString:chinese_numerals[9]])</div><div class="line">        &#123;</div><div class="line">            if([b isEqualToString:digits[4]] || [b isEqualToString:digits[8]])</div><div class="line">            &#123;</div><div class="line">                sum = b;</div><div class="line">                if ([[sums lastObject] isEqualToString:chinese_numerals[9]])</div><div class="line">                &#123;</div><div class="line">                    [sums removeLastObject];</div><div class="line">                &#125;</div><div class="line">            &#125;else</div><div class="line">            &#123;</div><div class="line">                sum = chinese_numerals[9];</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            if ([[sums lastObject] isEqualToString:sum])</div><div class="line">            &#123;</div><div class="line">                continue;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        [sums addObject:sum];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    NSString *sumStr = [sums componentsJoinedByString:@&quot;&quot;];</div><div class="line">    NSString *chinese = [sumStr substringToIndex:sumStr.length-1];</div><div class="line">    NSLog(@&quot;%@&quot;,str);</div><div class="line">    NSLog(@&quot;%@&quot;,chinese);</div><div class="line">    return chinese;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="取消UICollectionView的隐式动画"><a href="#取消UICollectionView的隐式动画" class="headerlink" title="取消UICollectionView的隐式动画"></a><strong>取消UICollectionView的隐式动画</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//方法一</div><div class="line">[UIView performWithoutAnimation:^&#123;</div><div class="line">    [collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//方法二</div><div class="line">[UIView animateWithDuration:0 animations:^&#123;</div><div class="line">    [collectionView performBatchUpdates:^&#123;</div><div class="line">        [collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]];</div><div class="line">    &#125; completion:nil];</div><div class="line">&#125;];</div><div class="line"></div><div class="line">//方法三</div><div class="line">[UIView setAnimationsEnabled:NO];</div><div class="line">[self.trackPanel performBatchUpdates:^&#123;</div><div class="line">    [collectionView reloadItemsAtIndexPaths:@[[NSIndexPath indexPathForItem:index inSection:0]]];</div><div class="line">&#125; completion:^(BOOL finished) &#123;</div><div class="line">    [UIView setAnimationsEnabled:YES];</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<h4 id="判断邮箱格式是否正确的代码"><a href="#判断邮箱格式是否正确的代码" class="headerlink" title="判断邮箱格式是否正确的代码"></a><strong>判断邮箱格式是否正确的代码</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-(BOOL)isValidateEmail:(NSString *)email</div><div class="line"></div><div class="line">　　&#123;</div><div class="line"></div><div class="line">　　NSString *emailRegex = @&quot;[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]&#123;2,4&#125;&quot;;</div><div class="line"></div><div class="line">　　NSPredicate *emailTest = [NSPredicate predicateWithFormat:@&quot;SELF MATCHES%@&quot;,emailRegex];</div><div class="line"></div><div class="line">　　return [emailTest evaluateWithObject:email];</div><div class="line"></div><div class="line">　　&#125;</div></pre></td></tr></table></figure>
<h4 id="iOS中UITextField的字数限制"><a href="#iOS中UITextField的字数限制" class="headerlink" title="iOS中UITextField的字数限制"></a><strong>iOS中UITextField的字数限制</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">//在viewDidLoad中注册&lt;UITextFieldTextDidChangeNotification&gt;通知</div><div class="line">[[NSNotificationCenter defaultCenter]addObserver:self selector:@selector(textFiledEditChanged:) </div><div class="line">          name:@&quot;UITextFieldTextDidChangeNotification&quot; object:myTextField];</div><div class="line">//实现监听方法</div><div class="line">#pragma mark - Notification Method</div><div class="line">-(void)textFieldEditChanged:(NSNotification *)obj</div><div class="line">&#123;</div><div class="line">    UITextField *textField = (UITextField *)obj.object;</div><div class="line">    NSString *toBeString = textField.text;</div><div class="line"></div><div class="line">    //获取高亮部分</div><div class="line">    UITextRange *selectedRange = [textField markedTextRange];</div><div class="line">    UITextPosition *position = [textField positionFromPosition:selectedRange.start offset:0];</div><div class="line"></div><div class="line">    // 没有高亮选择的字，则对已输入的文字进行字数统计和限制</div><div class="line">    if (!position)</div><div class="line">    &#123;</div><div class="line">        if (toBeString.length &gt; MAX_STARWORDS_LENGTH)</div><div class="line">        &#123;</div><div class="line">            NSRange rangeIndex = [toBeString rangeOfComposedCharacterSequenceAtIndex:MAX_STARWORDS_LENGTH];</div><div class="line">            if (rangeIndex.length == 1)</div><div class="line">            &#123;</div><div class="line">                textField.text = [toBeString substringToIndex:MAX_STARWORDS_LENGTH];</div><div class="line">            &#125;</div><div class="line">            else</div><div class="line">            &#123;</div><div class="line">                NSRange rangeRange = [toBeString rangeOfComposedCharacterSequencesForRange:NSMakeRange(0, MAX_STARWORDS_LENGTH)];</div><div class="line">                textField.text = [toBeString substringWithRange:rangeRange];</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="GCD定时器"><a href="#GCD定时器" class="headerlink" title="GCD定时器"></a><strong>GCD定时器</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0,queue);</div><div class="line">dispatch_source_set_timer(timer,dispatch_walltime(NULL, 0),1.0*NSEC_PER_SEC, 0); //每秒执行</div><div class="line">dispatch_source_set_event_handler(timer, ^&#123;</div><div class="line">    //倒计时结束，关闭</div><div class="line">    dispatch_source_cancel(timer); </div><div class="line">    dispatch_async(dispatch_get_main_queue(), ^&#123;</div><div class="line"></div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line">dispatch_resume(timer);</div></pre></td></tr></table></figure>
<h4 id="图片上绘制文字"><a href="#图片上绘制文字" class="headerlink" title="图片上绘制文字"></a><strong>图片上绘制文字</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">- (UIImage *)imageWithTitle:(NSString *)title fontSize:(CGFloat)fontSize</div><div class="line">&#123;</div><div class="line">    //画布大小</div><div class="line">    CGSize size=CGSizeMake(self.size.width,self.size.height);</div><div class="line">    //创建一个基于位图的上下文</div><div class="line">    UIGraphicsBeginImageContextWithOptions(size,NO,0.0);//opaque:NO  scale:0.0</div><div class="line"></div><div class="line">    [self drawAtPoint:CGPointMake(0.0,0.0)];</div><div class="line"></div><div class="line">    //文字居中显示在画布上</div><div class="line">    NSMutableParagraphStyle* paragraphStyle = [[NSParagraphStyle defaultParagraphStyle] mutableCopy];</div><div class="line">    paragraphStyle.lineBreakMode = NSLineBreakByCharWrapping;</div><div class="line"></div><div class="line">    paragraphStyle.alignment=NSTextAlignmentCenter;//文字居中</div><div class="line"></div><div class="line">    //计算文字所占的size,文字居中显示在画布上</div><div class="line">    CGSize sizeText=[title boundingRectWithSize:self.size options:NSStringDrawingUsesLineFragmentOrigin</div><div class="line">                                     attributes:@&#123;NSFontAttributeName:[UIFont systemFontOfSize:fontSize]&#125;context:nil].size;</div><div class="line">    CGFloat width = self.size.width;</div><div class="line">    CGFloat height = self.size.height;</div><div class="line"></div><div class="line">    CGRect rect = CGRectMake((width-sizeText.width)/2, (height-sizeText.height)/2, sizeText.width, sizeText.height);</div><div class="line">    //绘制文字</div><div class="line">    [title drawInRect:rect withAttributes:@&#123; NSFontAttributeName:[UIFont systemFontOfSize:fontSize],NSForegroundColorAttributeName:[ UIColor whiteColor],NSParagraphStyleAttributeName:paragraphStyle&#125;];</div><div class="line"></div><div class="line">    //返回绘制的新图形</div><div class="line">    UIImage *newImage= UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line">    return newImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="查找一个视图的所有子视图"><a href="#查找一个视图的所有子视图" class="headerlink" title="查找一个视图的所有子视图"></a><strong>查找一个视图的所有子视图</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">- (NSMutableArray *)allSubViewsForView:(UIView *)view</div><div class="line">&#123;</div><div class="line">    NSMutableArray *array = [NSMutableArray arrayWithCapacity:0];</div><div class="line">    for (UIView *subView in view.subviews)</div><div class="line">    &#123;</div><div class="line">        [array addObject:subView];</div><div class="line">        if (subView.subviews.count &gt; 0)</div><div class="line">        &#123;</div><div class="line">            [array addObjectsFromArray:[self allSubViewsForView:subView]];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return array;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="计算文件大小"><a href="#计算文件大小" class="headerlink" title="计算文件大小"></a><strong>计算文件大小</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">//文件大小</div><div class="line">- (long long)fileSizeAtPath:(NSString *)path</div><div class="line">&#123;</div><div class="line">    NSFileManager *fileManager = [NSFileManager defaultManager];</div><div class="line"></div><div class="line">    if ([fileManager fileExistsAtPath:path])</div><div class="line">    &#123;</div><div class="line">        long long size = [fileManager attributesOfItemAtPath:path error:nil].fileSize;</div><div class="line">        return size;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//文件夹大小</div><div class="line">- (long long)folderSizeAtPath:(NSString *)path</div><div class="line">&#123;</div><div class="line">    NSFileManager *fileManager = [NSFileManager defaultManager];</div><div class="line"></div><div class="line">    long long folderSize = 0;</div><div class="line"></div><div class="line">    if ([fileManager fileExistsAtPath:path])</div><div class="line">    &#123;</div><div class="line">        NSArray *childerFiles = [fileManager subpathsAtPath:path];</div><div class="line">        for (NSString *fileName in childerFiles)</div><div class="line">        &#123;</div><div class="line">            NSString *fileAbsolutePath = [path stringByAppendingPathComponent:fileName];</div><div class="line">            if ([fileManager fileExistsAtPath:fileAbsolutePath])</div><div class="line">            &#123;</div><div class="line">                long long size = [fileManager attributesOfItemAtPath:fileAbsolutePath error:nil].fileSize;</div><div class="line">                folderSize += size;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return folderSize;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="UIView的设置部分圆角"><a href="#UIView的设置部分圆角" class="headerlink" title="UIView的设置部分圆角"></a><strong>UIView的设置部分圆角</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">CGRect rect = view.bounds;</div><div class="line">CGSize radio = CGSizeMake(30, 30);//圆角尺寸</div><div class="line">UIRectCorner corner = UIRectCornerTopLeft|UIRectCornerTopRight;//这只圆角位置</div><div class="line">UIBezierPath *path = [UIBezierPath bezierPathWithRoundedRect:rect byRoundingCorners:corner cornerRadii:radio];</div><div class="line">CAShapeLayer *masklayer = [[CAShapeLayer alloc]init];//创建shapelayer</div><div class="line">masklayer.frame = view.bounds;</div><div class="line">masklayer.path = path.CGPath;//设置路径</div><div class="line">view.layer.mask = masklayer;</div></pre></td></tr></table></figure>
<h4 id="计算字符串字符长度，一个汉字算两个字符"><a href="#计算字符串字符长度，一个汉字算两个字符" class="headerlink" title="计算字符串字符长度，一个汉字算两个字符"></a><strong>计算字符串字符长度，一个汉字算两个字符</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">//方法一：</div><div class="line">- (int)convertToInt:(NSString*)strtemp</div><div class="line">&#123;</div><div class="line">    int strlength = 0;</div><div class="line">    char* p = (char*)[strtemp cStringUsingEncoding:NSUnicodeStringEncoding];</div><div class="line">    for (int i=0 ; i&lt;[strtemp lengthOfBytesUsingEncoding:NSUnicodeStringEncoding] ;i++)</div><div class="line">    &#123;</div><div class="line">        if (*p)</div><div class="line">        &#123;</div><div class="line">            p++;</div><div class="line">            strlength++;</div><div class="line">        &#125;</div><div class="line">        else</div><div class="line">        &#123;</div><div class="line">            p++;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">    return strlength;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//方法二：</div><div class="line">-(NSUInteger) unicodeLengthOfString: (NSString *) text</div><div class="line">&#123;</div><div class="line">    NSUInteger asciiLength = 0;</div><div class="line">    for (NSUInteger i = 0; i &lt; text.length; i++)</div><div class="line">    &#123;</div><div class="line">        unichar uc = [text characterAtIndex: i];</div><div class="line">        asciiLength += isascii(uc) ? 1 : 2;</div><div class="line">    &#125;</div><div class="line">    return asciiLength;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="防止滚动视图手势覆盖侧滑手势"><a href="#防止滚动视图手势覆盖侧滑手势" class="headerlink" title="防止滚动视图手势覆盖侧滑手势"></a><strong>防止滚动视图手势覆盖侧滑手势</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[scrollView.panGestureRecognizer requireGestureRecognizerToFail:self.navigationController.interactivePopGestureRecognizer];</div></pre></td></tr></table></figure>
<h4 id="去掉导航栏返回的标题"><a href="#去掉导航栏返回的标题" class="headerlink" title="去掉导航栏返回的标题"></a><strong>去掉导航栏返回的标题</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[UIBarButtonItem appearance]setBackButtonTitlePositionAdjustment:UIOffsetMake(0, -60)forBarMetrics:UIBarMetricsDefault];</div></pre></td></tr></table></figure>
<h4 id="字符串中是否含有中文"><a href="#字符串中是否含有中文" class="headerlink" title="字符串中是否含有中文"></a><strong>字符串中是否含有中文</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+ (BOOL)checkIsChinese:(NSString *)string</div><div class="line">&#123;</div><div class="line">    for (int i=0; i&lt;string.length; i++)</div><div class="line">    &#123;</div><div class="line">        unichar ch = [string characterAtIndex:i];</div><div class="line">        if (0x4E00 &lt;= ch  &amp;&amp; ch &lt;= 0x9FA5)</div><div class="line">        &#123;</div><div class="line">            return YES;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="dispatch-group的使用"><a href="#dispatch-group的使用" class="headerlink" title="dispatch_group的使用"></a><strong>dispatch_group的使用</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">dispatch_group_t dispatchGroup = dispatch_group_create();</div><div class="line">    dispatch_group_enter(dispatchGroup);</div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        NSLog(@&quot;第一个请求完成&quot;);</div><div class="line">        dispatch_group_leave(dispatchGroup);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    dispatch_group_enter(dispatchGroup);</div><div class="line"></div><div class="line">    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(10 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123;</div><div class="line">        NSLog(@&quot;第二个请求完成&quot;);</div><div class="line">        dispatch_group_leave(dispatchGroup);</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    dispatch_group_notify(dispatchGroup, dispatch_get_main_queue(), ^()&#123;</div><div class="line">        NSLog(@&quot;请求完成&quot;);</div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h4 id="UITextField每四位加一个空格，实现代理"><a href="#UITextField每四位加一个空格，实现代理" class="headerlink" title="UITextField每四位加一个空格，实现代理"></a><strong>UITextField每四位加一个空格，实现代理</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string</div><div class="line">&#123;</div><div class="line">    // 四位加一个空格</div><div class="line">    if ([string isEqualToString:@&quot;&quot;])</div><div class="line">    &#123;</div><div class="line">        // 删除字符</div><div class="line">        if ((textField.text.length - 2) % 5 == 0)</div><div class="line">        &#123;</div><div class="line">            textField.text = [textField.text substringToIndex:textField.text.length - 1];</div><div class="line">        &#125;</div><div class="line">        return YES;</div><div class="line">    &#125;</div><div class="line">    else</div><div class="line">    &#123;</div><div class="line">        if (textField.text.length % 5 == 0)</div><div class="line">        &#123;</div><div class="line">            textField.text = [NSString stringWithFormat:@&quot;%@ &quot;, textField.text];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取手机安装的应用"><a href="#获取手机安装的应用" class="headerlink" title="获取手机安装的应用"></a><strong>获取手机安装的应用</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Class c =NSClassFromString(@&quot;LSApplicationWorkspace&quot;);</div><div class="line">id s = [(id)c performSelector:NSSelectorFromString(@&quot;defaultWorkspace&quot;)];</div><div class="line">NSArray *array = [s performSelector:NSSelectorFromString(@&quot;allInstalledApplications&quot;)];</div><div class="line">for (id item in array)</div><div class="line">&#123;</div><div class="line">    NSLog(@&quot;%@&quot;,[item performSelector:NSSelectorFromString(@&quot;applicationIdentifier&quot;)]);</div><div class="line">    NSLog(@&quot;%@&quot;,[item performSelector:NSSelectorFromString(@&quot;bundleVersion&quot;)]);</div><div class="line">    NSLog(@&quot;%@&quot;,[item performSelector:NSSelectorFromString(@&quot;shortVersionString&quot;)]);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="应用内打开系统设置界面"><a href="#应用内打开系统设置界面" class="headerlink" title="应用内打开系统设置界面"></a><strong>应用内打开系统设置界面</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">//iOS8之后</div><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:UIApplicationOpenSettingsURLString]];</div><div class="line">//如果App没有添加权限，显示的是设定界面。如果App有添加权限（例如通知），显示的是App的设定界面。</div><div class="line"></div><div class="line">//iOS8之前</div><div class="line">//先添加一个url type，在代码中调用如下代码,即可跳转到设置页面的对应项</div><div class="line">[[UIApplication sharedApplication] openURL:[NSURL URLWithString:@&quot;prefs:root=WIFI&quot;]];</div><div class="line"></div><div class="line">/*</div><div class="line">可选值如下：</div><div class="line">About — prefs:root=General&amp;path=About</div><div class="line">Accessibility — prefs:root=General&amp;path=ACCESSIBILITY</div><div class="line">Airplane Mode On — prefs:root=AIRPLANE_MODE</div><div class="line">Auto-Lock — prefs:root=General&amp;path=AUTOLOCK</div><div class="line">Brightness — prefs:root=Brightness</div><div class="line">Bluetooth — prefs:root=General&amp;path=Bluetooth</div><div class="line">Date &amp; Time — prefs:root=General&amp;path=DATE_AND_TIME</div><div class="line">FaceTime — prefs:root=FACETIME</div><div class="line">General — prefs:root=General</div><div class="line">Keyboard — prefs:root=General&amp;path=Keyboard</div><div class="line">iCloud — prefs:root=CASTLE</div><div class="line">iCloud Storage &amp; Backup — prefs:root=CASTLE&amp;path=STORAGE_AND_BACKUP</div><div class="line">International — prefs:root=General&amp;path=INTERNATIONAL</div><div class="line">Location Services — prefs:root=LOCATION_SERVICES</div><div class="line">Music — prefs:root=MUSIC</div><div class="line">Music Equalizer — prefs:root=MUSIC&amp;path=EQ</div><div class="line">Music Volume Limit — prefs:root=MUSIC&amp;path=VolumeLimit</div><div class="line">Network — prefs:root=General&amp;path=Network</div><div class="line">Nike + iPod — prefs:root=NIKE_PLUS_IPOD</div><div class="line">Notes — prefs:root=NOTES</div><div class="line">Notification — prefs:root=NOTIFICATI*****_ID</div><div class="line">Phone — prefs:root=Phone</div><div class="line">Photos — prefs:root=Photos</div><div class="line">Profile — prefs:root=General&amp;path=ManagedConfigurationList</div><div class="line">Reset — prefs:root=General&amp;path=Reset</div><div class="line">Safari — prefs:root=Safari</div><div class="line">Siri — prefs:root=General&amp;path=Assistant</div><div class="line">Sounds — prefs:root=Sounds</div><div class="line">Software Update — prefs:root=General&amp;path=SOFTWARE_UPDATE_LINK</div><div class="line">Store — prefs:root=STORE</div><div class="line">Twitter — prefs:root=TWITTER</div><div class="line">Usage — prefs:root=General&amp;path=USAGE</div><div class="line">VPN — prefs:root=General&amp;path=Network/VPN</div><div class="line">Wallpaper — prefs:root=Wallpaper</div><div class="line">Wi-Fi — prefs:root=WIFI</div><div class="line">  */</div></pre></td></tr></table></figure>
<h4 id="动画暂停再开始"><a href="#动画暂停再开始" class="headerlink" title="动画暂停再开始"></a><strong>动画暂停再开始</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">-(void)pauseLayer:(CALayer *)layer</div><div class="line">&#123;</div><div class="line">    CFTimeInterval pausedTime = [layer convertTime:CACurrentMediaTime() fromLayer:nil];</div><div class="line">    layer.speed = 0.0;</div><div class="line">    layer.timeOffset = pausedTime;</div><div class="line">&#125;</div><div class="line"></div><div class="line">-(void)resumeLayer:(CALayer *)layer</div><div class="line">&#123;</div><div class="line">    CFTimeInterval pausedTime = [layer timeOffset];</div><div class="line">    layer.speed = 1.0;</div><div class="line">    layer.timeOffset = 0.0;</div><div class="line">    layer.beginTime = 0.0;</div><div class="line">    CFTimeInterval timeSincePause = [layer convertTime:CACurrentMediaTime() fromLayer:nil] - pausedTime;</div><div class="line">    layer.beginTime = timeSincePause;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="iOS版中数字的格式化"><a href="#iOS版中数字的格式化" class="headerlink" title="iOS版中数字的格式化"></a><strong>iOS版中数字的格式化</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">//通过NSNumberFormatter，同样可以设置NSNumber输出的格式。例如如下代码：</div><div class="line">NSNumberFormatter *formatter = [[NSNumberFormatter alloc] init];</div><div class="line">formatter.numberStyle = NSNumberFormatterDecimalStyle;</div><div class="line">NSString *string = [formatter stringFromNumber:[NSNumber numberWithInt:123456789]];</div><div class="line">NSLog(@&quot;Formatted number string:%@&quot;,string);</div><div class="line">//输出结果为：[1223:403] Formatted number string:123,456,789</div><div class="line"></div><div class="line">//其中NSNumberFormatter类有个属性numberStyle，它是一个枚举型，设置不同的值可以输出不同的数字格式。该枚举包括：</div><div class="line">typedef NS_ENUM(NSUInteger, NSNumberFormatterStyle) &#123;</div><div class="line">    NSNumberFormatterNoStyle = kCFNumberFormatterNoStyle,</div><div class="line">    NSNumberFormatterDecimalStyle = kCFNumberFormatterDecimalStyle,</div><div class="line">    NSNumberFormatterCurrencyStyle = kCFNumberFormatterCurrencyStyle,</div><div class="line">    NSNumberFormatterPercentStyle = kCFNumberFormatterPercentStyle,</div><div class="line">    NSNumberFormatterScientificStyle = kCFNumberFormatterScientificStyle,</div><div class="line">    NSNumberFormatterSpellOutStyle = kCFNumberFormatterSpellOutStyle</div><div class="line">&#125;;</div><div class="line">//各个枚举对应输出数字格式的效果如下：其中第三项和最后一项的输出会根据系统设置的语言区域的不同而不同。</div><div class="line">[1243:403] Formatted number string:123456789</div><div class="line">[1243:403] Formatted number string:123,456,789</div><div class="line">[1243:403] Formatted number string:￥123,456,789.00</div><div class="line">[1243:403] Formatted number string:-539,222,988%</div><div class="line">[1243:403] Formatted number string:1.23456789E8</div><div class="line">[1243:403] Formatted number string:一亿二千三百四十五万六千七百八十九</div></pre></td></tr></table></figure>
<h4 id="如何获取的WebView所有的图片地址"><a href="#如何获取的WebView所有的图片地址" class="headerlink" title="如何获取的WebView所有的图片地址"></a><strong>如何获取的WebView所有的图片地址</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">//UIWebView</div><div class="line">- (void)webViewDidFinishLoad:(UIWebView *)webView</div><div class="line">&#123;</div><div class="line">    //这里是js，主要目的实现对url的获取</div><div class="line">    static  NSString * const jsGetImages =</div><div class="line">    @&quot;function getImages()&#123;\</div><div class="line">    var objs = document.getElementsByTagName(\&quot;img\&quot;);\</div><div class="line">    var imgScr = &apos;&apos;;\</div><div class="line">    for(var i=0;i&lt;objs.length;i++)&#123;\</div><div class="line">    imgScr = imgScr + objs[i].src + &apos;+&apos;;\</div><div class="line">    &#125;;\</div><div class="line">    return imgScr;\</div><div class="line">    &#125;;&quot;;</div><div class="line"></div><div class="line">    [webView stringByEvaluatingJavaScriptFromString:jsGetImages];//注入js方法</div><div class="line">    NSString *urlResult = [webView stringByEvaluatingJavaScriptFromString:@&quot;getImages()&quot;];</div><div class="line">    NSArray *urlArray = [NSMutableArray arrayWithArray:[urlResult componentsSeparatedByString:@&quot;+&quot;]];</div><div class="line">    //urlResurlt 就是获取到得所有图片的url的拼接；mUrlArray就是所有Url的数组</div><div class="line">&#125;</div><div class="line"></div><div class="line">//WKWebView</div><div class="line">- (void)webView:(WKWebView *)webView didFinishNavigation:(null_unspecified WKNavigation *)navigation</div><div class="line">&#123;</div><div class="line">    static  NSString * const jsGetImages =</div><div class="line">    @&quot;function getImages()&#123;\</div><div class="line">    var objs = document.getElementsByTagName(\&quot;img\&quot;);\</div><div class="line">    var imgScr = &apos;&apos;;\</div><div class="line">    for(var i=0;i&lt;objs.length;i++)&#123;\</div><div class="line">    imgScr = imgScr + objs[i].src + &apos;+&apos;;\</div><div class="line">    &#125;;\</div><div class="line">    return imgScr;\</div><div class="line">    &#125;;&quot;;</div><div class="line"></div><div class="line">    [webView evaluateJavaScript:jsGetImages completionHandler:nil];</div><div class="line">    [webView evaluateJavaScript:@&quot;getImages()&quot; completionHandler:^(id _Nullable result, NSError * _Nullable error) &#123;</div><div class="line">        NSLog(@&quot;%@&quot;,result);</div><div class="line">    &#125;];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="获取到的WebView的高度"><a href="#获取到的WebView的高度" class="headerlink" title="获取到的WebView的高度"></a><strong>获取到的WebView的高度</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGFloat height = [[self.webView stringByEvaluatingJavaScriptFromString:@&quot;document.body.offsetHeight&quot;] floatValue];</div></pre></td></tr></table></figure>
<h4 id="导航栏变为纯透明"><a href="#导航栏变为纯透明" class="headerlink" title="导航栏变为纯透明"></a><strong>导航栏变为纯透明</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//第一种方法</div><div class="line">//导航栏纯透明</div><div class="line">[self.navigationBar setBackgroundImage:[UIImage new] forBarMetrics:UIBarMetricsDefault];</div><div class="line">//去掉导航栏底部的黑线</div><div class="line">self.navigationBar.shadowImage = [UIImage new];</div><div class="line"></div><div class="line">//第二种方法</div><div class="line">[[self.navigationBar subviews] objectAtIndex:0].alpha = 0;</div></pre></td></tr></table></figure>
<h4 id="tabBar变为纯透明"><a href="#tabBar变为纯透明" class="headerlink" title="tabBar变为纯透明"></a><strong>tabBar变为纯透明</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[self.tabBar setBackgroundImage:[UIImage new]];</div><div class="line">self.tabBar.shadowImage = [UIImage new];</div></pre></td></tr></table></figure>
<h4 id="navigationBar根据滑动距离的渐变色实现"><a href="#navigationBar根据滑动距离的渐变色实现" class="headerlink" title="navigationBar根据滑动距离的渐变色实现"></a><strong>navigationBar根据滑动距离的渐变色实现</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">//第一种</div><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">    CGFloat offsetToShow = 200.0;//滑动多少就完全显示</div><div class="line">    CGFloat alpha = 1 - (offsetToShow - scrollView.contentOffset.y) / offsetToShow;</div><div class="line">    [[self.navigationController.navigationBar subviews] objectAtIndex:0].alpha = alpha;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//第二种</div><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</div><div class="line">&#123;</div><div class="line">    CGFloat offsetToShow = 200.0;</div><div class="line">    CGFloat alpha = 1 - (offsetToShow - scrollView.contentOffset.y) / offsetToShow;</div><div class="line"></div><div class="line">    [self.navigationController.navigationBar setShadowImage:[UIImage new]];</div><div class="line">    [self.navigationController.navigationBar setBackgroundImage:[self imageWithColor:[[UIColor orangeColor]colorWithAlphaComponent:alpha]] forBarMetrics:UIBarMetricsDefault];</div><div class="line">&#125;</div><div class="line"></div><div class="line">//生成一张纯色的图片</div><div class="line">- (UIImage *)imageWithColor:(UIColor *)color</div><div class="line">&#123;</div><div class="line">    CGRect rect = CGRectMake(0.0f, 0.0f, 1.0f, 1.0f);</div><div class="line">    UIGraphicsBeginImageContext(rect.size);</div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line">    CGContextSetFillColorWithColor(context, [color CGColor]);</div><div class="line">    CGContextFillRect(context, rect);</div><div class="line">    UIImage *theImage = UIGraphicsGetImageFromCurrentImageContext();</div><div class="line">    UIGraphicsEndImageContext();</div><div class="line"></div><div class="line">    return theImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="常用宏"><a href="#常用宏" class="headerlink" title="常用宏"></a>常用宏</h2><h4 id="尺寸宏"><a href="#尺寸宏" class="headerlink" title="尺寸宏"></a>尺寸宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#define StatusBar_HEIGHT 20</div><div class="line"></div><div class="line">#define NavigationBar_HEIGHT 44</div><div class="line"></div><div class="line">#define NavigationBarIcon 20</div><div class="line"></div><div class="line">#define TabBar_HEIGHT 49</div><div class="line"></div><div class="line">#define TabBarIcon 30</div><div class="line"></div><div class="line">#define SCREEN_WIDTH ([UIScreen mainScreen].bounds.size.width)</div><div class="line"></div><div class="line">#define SCREEN_HEIGHT ([UIScreen mainScreen].bounds.size.height)</div></pre></td></tr></table></figure>
<h4 id="打印宏"><a href="#打印宏" class="headerlink" title="打印宏"></a>打印宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//替换NSLog来使用，debug模式下可以打印很多方法名，行信息。</div><div class="line">#ifdef DEBUG</div><div class="line">#   define DLog(fmt, ...) NSLog((@&quot;%s [Line %d] &quot; fmt), __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__);</div><div class="line">#else  </div><div class="line">#   define DLog(...)  </div><div class="line">#endif</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//直接替换NSLog</div><div class="line">#if DEBUG  </div><div class="line">#define NSLog(FORMAT, ...) fprintf(stderr,&quot;\nfunction:%s line:%d content:%s\n&quot;, __FUNCTION__, __LINE__, [[NSString stringWithFormat:FORMAT, ##__VA_ARGS__] UTF8String]);  </div><div class="line">#else  </div><div class="line">#define NSLog(FORMAT, ...) nil  </div><div class="line">#endif</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//DEBUG  模式下打印日志,当前行以及弹出一个警告</div><div class="line">#ifdef DEBUG</div><div class="line">#   define ULog(fmt, ...)  &#123; UIAlertView *alert = [[UIAlertView alloc] initWithTitle:[NSString stringWithFormat:@&quot;%s\n [Line %d] &quot;, __PRETTY_FUNCTION__, __LINE__] message:[NSString stringWithFormat:fmt, ##__VA_ARGS__]  delegate:nil cancelButtonTitle:@&quot;Ok&quot; otherButtonTitles:nil]; [alert show]; &#125;</div><div class="line">#else</div><div class="line">#   define ULog(...)</div><div class="line">#endif</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line">#define ITTDEBUG</div><div class="line">#define ITTLOGLEVEL_INFO     10</div><div class="line">#define ITTLOGLEVEL_WARNING  3</div><div class="line">#define ITTLOGLEVEL_ERROR    1</div><div class="line"></div><div class="line">#ifndef ITTMAXLOGLEVEL</div><div class="line"></div><div class="line">#ifdef DEBUG</div><div class="line">#define ITTMAXLOGLEVEL ITTLOGLEVEL_INFO</div><div class="line">#else</div><div class="line">#define ITTMAXLOGLEVEL ITTLOGLEVEL_ERROR</div><div class="line">#endif</div><div class="line"></div><div class="line">#endif</div><div class="line"></div><div class="line">// The general purpose logger. This ignores logging levels.</div><div class="line">#ifdef ITTDEBUG</div><div class="line">#define ITTDPRINT(xx, ...)  NSLog(@&quot;%s(%d): &quot; xx, __PRETTY_FUNCTION__, __LINE__, ##__VA_ARGS__)</div><div class="line">#else</div><div class="line">#define ITTDPRINT(xx, ...)  ((void)0)</div><div class="line">#endif</div><div class="line"></div><div class="line">// Prints the current method&apos;s name.</div><div class="line">#define ITTDPRINTMETHODNAME() ITTDPRINT(@&quot;%s&quot;, __PRETTY_FUNCTION__)</div><div class="line"></div><div class="line">// Log-level based logging macros.</div><div class="line">#if ITTLOGLEVEL_ERROR &lt;= ITTMAXLOGLEVEL</div><div class="line">#define ITTDERROR(xx, ...)  ITTDPRINT(xx, ##__VA_ARGS__)</div><div class="line">#else</div><div class="line">#define ITTDERROR(xx, ...)  ((void)0)</div><div class="line">#endif</div><div class="line"></div><div class="line">#if ITTLOGLEVEL_WARNING &lt;= ITTMAXLOGLEVEL</div><div class="line">#define ITTDWARNING(xx, ...)  ITTDPRINT(xx, ##__VA_ARGS__)</div><div class="line">#else</div><div class="line">#define ITTDWARNING(xx, ...)  ((void)0)</div><div class="line">#endif</div><div class="line"></div><div class="line">#if ITTLOGLEVEL_INFO &lt;= ITTMAXLOGLEVEL</div><div class="line">#define ITTDINFO(xx, ...)  ITTDPRINT(xx, ##__VA_ARGS__)</div><div class="line">#else</div><div class="line">#define ITTDINFO(xx, ...)  ((void)0)</div><div class="line">#endif</div><div class="line"></div><div class="line">#ifdef ITTDEBUG</div><div class="line">#define ITTDCONDITIONLOG(condition, xx, ...) &#123; if ((condition)) &#123; \</div><div class="line">ITTDPRINT(xx, ##__VA_ARGS__); \</div><div class="line">&#125; \</div><div class="line">&#125; ((void)0)</div><div class="line">#else</div><div class="line">#define ITTDCONDITIONLOG(condition, xx, ...) ((void)0)</div><div class="line">#endif</div><div class="line"></div><div class="line">#define ITTAssert(condition, ...)                                       \</div><div class="line">do &#123;                                                                      \</div><div class="line">if (!(condition)) &#123;                                                     \</div><div class="line">[[NSAssertionHandler currentHandler]                                  \</div><div class="line">handleFailureInFunction:[NSString stringWithUTF8String:__PRETTY_FUNCTION__] \</div><div class="line">file:[NSString stringWithUTF8String:__FILE__]  \</div><div class="line">lineNumber:__LINE__                                  \</div><div class="line">description:__VA_ARGS__];                             \</div><div class="line">&#125;                                                                       \</div><div class="line">&#125; while(0)</div></pre></td></tr></table></figure>
<h4 id="系统宏"><a href="#系统宏" class="headerlink" title="系统宏"></a>系统宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//获取版本</div><div class="line">#define IOS_VERSION [[[UIDevice currentDevice] systemVersion] floatValue]</div><div class="line">#define CurrentSystemVersion [[UIDevice currentDevice] systemVersion]</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//获取当前语言</div><div class="line">#define CurrentLanguage ([[NSLocale preferredLanguages] objectAtIndex:0])</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//判断是真机还是模拟器  </div><div class="line">#if TARGET_OS_IPHONE  </div><div class="line">//iPhone Device  </div><div class="line">#endif  </div><div class="line">  </div><div class="line">#if TARGET_IPHONE_SIMULATOR  </div><div class="line">//iPhone Simulator  </div><div class="line">#endif</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//检查系统版本</div><div class="line">#define SYSTEM_VERSION_EQUAL_TO(v)                  ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedSame)</div><div class="line">#define SYSTEM_VERSION_GREATER_THAN(v)              ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedDescending)</div><div class="line">#define SYSTEM_VERSION_GREATER_THAN_OR_EQUAL_TO(v)  ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] != NSOrderedAscending)</div><div class="line">#define SYSTEM_VERSION_LESS_THAN(v)                 ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] == NSOrderedAscending)</div><div class="line">#define SYSTEM_VERSION_LESS_THAN_OR_EQUAL_TO(v)     ([[[UIDevice currentDevice] systemVersion] compare:v options:NSNumericSearch] != NSOrderedDescending)</div></pre></td></tr></table></figure>
<h4 id="内存宏"><a href="#内存宏" class="headerlink" title="内存宏"></a>内存宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">//使用ARC和不使用ARC</div><div class="line">#if __has_feature(objc_arc)</div><div class="line">//compiling with ARC</div><div class="line">#else</div><div class="line">// compiling without ARC</div><div class="line">#endif</div><div class="line"></div><div class="line">#pragma mark - common functions</div><div class="line">#define RELEASE_SAFELY(__POINTER) &#123; [__POINTER release]; __POINTER = nil; &#125;</div><div class="line"></div><div class="line">//释放一个对象</div><div class="line">#define SAFE_DELETE(P) if(P) &#123; [P release], P = nil; &#125;</div><div class="line"></div><div class="line">#define SAFE_RELEASE(x) [x release];x=nil</div></pre></td></tr></table></figure>
<h4 id="图片宏"><a href="#图片宏" class="headerlink" title="图片宏"></a>图片宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//读取本地图片</div><div class="line">#define LOADIMAGE(file,ext) [UIImage imageWithContentsOfFile:[[NSBundle mainBundle]pathForResource:file ofType:ext]]</div><div class="line"></div><div class="line">//定义UIImage对象</div><div class="line">#define IMAGE(A) [UIImage imageWithContentsOfFile:[[NSBundle mainBundle] pathForResource:A ofType:nil]]</div><div class="line"></div><div class="line">//定义UIImage对象</div><div class="line">//#define ImageNamed(_pointer) [UIImage imageNamed:[UIUtil imageName:_pointer]]</div><div class="line"></div><div class="line">//前两种宏性能高，省内存</div><div class="line">//第三个没有必要使用，因为我们可以使用Xcode的插件</div></pre></td></tr></table></figure>
<h4 id="颜色宏"><a href="#颜色宏" class="headerlink" title="颜色宏"></a>颜色宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">// rgb颜色转换（16进制-&gt;10进制）</div><div class="line">#define UIColorFromRGB(rgbValue) [UIColor colorWithRed:((float)((rgbValue &amp; 0xFF0000) &gt;&gt; 16))/255.0 green:((float)((rgbValue &amp; 0xFF00) &gt;&gt; 8))/255.0 blue:((float)(rgbValue &amp; 0xFF))/255.0 alpha:1.0]</div><div class="line"></div><div class="line">//带有RGBA的颜色设置</div><div class="line">#define COLOR(R, G, B, A) [UIColor colorWithRed:R/255.0 green:G/255.0 blue:B/255.0 alpha:A]</div><div class="line"></div><div class="line">// 获取RGB颜色</div><div class="line">#define RGBA(r,g,b,a) [UIColor colorWithRed:r/255.0f green:g/255.0f blue:b/255.0f alpha:a]</div><div class="line">#define RGB(r,g,b) RGBA(r,g,b,1.0f)</div><div class="line"></div><div class="line">//背景色</div><div class="line">#define BACKGROUND_COLOR [UIColor colorWithRed:242.0/255.0 green:236.0/255.0 blue:231.0/255.0 alpha:1.0]</div><div class="line"></div><div class="line">//清除背景色</div><div class="line">#define CLEARCOLOR [UIColor clearColor]</div><div class="line"></div><div class="line">#pragma mark - color functions</div><div class="line">#define RGBCOLOR(r,g,b) [UIColor colorWithRed:(r)/255.0f green:(g)/255.0f blue:(b)/255.0f alpha:1]</div><div class="line">#define RGBACOLOR(r,g,b,a) [UIColor colorWithRed:(r)/255.0f green:(g)/255.0f blue:(b)/255.0f alpha:(a)]</div></pre></td></tr></table></figure>
<h4 id="其他宏"><a href="#其他宏" class="headerlink" title="其他宏"></a>其他宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">//方正黑体简体字体定义</div><div class="line">#define FONT(F) [UIFont fontWithName:@&quot;FZHTJW--GB1-0&quot; size:F]</div><div class="line"></div><div class="line">//定义一个API</div><div class="line">#define APIURL                @&quot;http://xxxxx/&quot;</div><div class="line">//登陆API</div><div class="line">#define APILogin              [APIURL stringByAppendingString:@&quot;Login&quot;]</div><div class="line"></div><div class="line">//设置View的tag属性</div><div class="line">#define VIEWWITHTAG(_OBJECT, _TAG)    [_OBJECT viewWithTag : _TAG]</div><div class="line">//程序的本地化,引用国际化的文件</div><div class="line">#define MyLocal(x, ...) NSLocalizedString(x, nil)</div><div class="line"></div><div class="line">//G－C－D</div><div class="line">#define BACK(block) dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), block)</div><div class="line">#define MAIN(block) dispatch_async(dispatch_get_main_queue(),block)</div><div class="line"></div><div class="line">//NSUserDefaults 实例化</div><div class="line">#define USER_DEFAULT [NSUserDefaults standardUserDefaults]</div><div class="line"></div><div class="line"></div><div class="line">//由角度获取弧度 有弧度获取角度</div><div class="line">#define degreesToRadian(x) (M_PI * (x) / 180.0)</div><div class="line">#define radianToDegrees(radian) (radian*180.0)/(M_PI)</div></pre></td></tr></table></figure>
<h4 id="单例宏"><a href="#单例宏" class="headerlink" title="单例宏"></a>单例宏</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">#define SYNTHESIZE_SINGLETON_FOR_CLASS(classname) \</div><div class="line">\</div><div class="line">static classname *shared##classname = nil; \</div><div class="line">\</div><div class="line">+ (classname *)shared##classname \</div><div class="line">&#123; \</div><div class="line">@synchronized(self) \</div><div class="line">&#123; \</div><div class="line">if (shared##classname == nil) \</div><div class="line">&#123; \</div><div class="line">shared##classname = [[self alloc] init]; \</div><div class="line">&#125; \</div><div class="line">&#125; \</div><div class="line">\</div><div class="line">return shared##classname; \</div><div class="line">&#125; \</div><div class="line">\</div><div class="line">+ (id)allocWithZone:(NSZone *)zone \</div><div class="line">&#123; \</div><div class="line">@synchronized(self) \</div><div class="line">&#123; \</div><div class="line">if (shared##classname == nil) \</div><div class="line">&#123; \</div><div class="line">shared##classname = [super allocWithZone:zone]; \</div><div class="line">return shared##classname; \</div><div class="line">&#125; \</div><div class="line">&#125; \</div><div class="line">\</div><div class="line">return nil; \</div><div class="line">&#125; \</div><div class="line">\</div><div class="line">- (id)copyWithZone:(NSZone *)zone \</div><div class="line">&#123; \</div><div class="line">return self; \</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="小技巧"><a href="#小技巧" class="headerlink" title="小技巧"></a>小技巧</h2><h4 id="CGRect"><a href="#CGRect" class="headerlink" title="CGRect"></a><strong>CGRect</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">CGRectFromString(&lt;#NSString *string#&gt;)//有字符串恢复出矩形CGRectInset(&lt;#CGRect rect#&gt;, &lt;#CGFloat dx#&gt;, &lt;#CGFloat dy#&gt;)//创建较小或者较大的矩形CGRectIntersectsRect(&lt;#CGRect rect1#&gt;, &lt;#CGRect rect2#&gt;)//判断两巨星是否交叉，是否重叠CGRectZero//高度和宽度为零的，位于（0，0）的矩形常量</div></pre></td></tr></table></figure>
<h4 id="隐藏状态栏"><a href="#隐藏状态栏" class="headerlink" title="隐藏状态栏"></a><strong>隐藏状态栏</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[UIApplicationsharedApplication]setStatusBarHidden:&lt;#(BOOL)#&gt; withAnimation:&lt;#(UIStatusBarAnimation)#&gt;//隐藏状态栏</div></pre></td></tr></table></figure>
<h4 id="自动适应父视图大小"><a href="#自动适应父视图大小" class="headerlink" title="自动适应父视图大小"></a><strong>自动适应父视图大小</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">self.view.autoresizesSubviews=YES;</div><div class="line">self.view.autoresizingMask=UIViewAutoresizingFlexibleWidth|UIViewAutoresizingFlexibleHeight;</div></pre></td></tr></table></figure>
<h4 id="UITableView的一些方法"><a href="#UITableView的一些方法" class="headerlink" title="UITableView的一些方法"></a><strong>UITableView的一些方法</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//缩进级别设置为行号，row越大，缩进越多</div><div class="line">  -(NSInteger)tableView:(UITableView*)tableView indentationLevelForRowAtIndexPath:(NSIndexPath*)indexPath&#123;NSIntegerrow=indexPath.row;returnrow;&#125;</div></pre></td></tr></table></figure>
<h4 id="把plist文件中的数据赋给数组"><a href="#把plist文件中的数据赋给数组" class="headerlink" title="把plist文件中的数据赋给数组"></a><strong>把plist文件中的数据赋给数组</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString*path=[[NSBundlemainBundle]pathForResource:@&quot;States&quot;ofType:@&quot;plist&quot;];</div><div class="line">NSArray*array=[NSArrayarrayWithContentsOfFile:path];</div></pre></td></tr></table></figure>
<h4 id="获取触摸的点"><a href="#获取触摸的点" class="headerlink" title="获取触摸的点"></a><strong>获取触摸的点</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">-(CGPoint)locationInView:(UIView*)view;-(CGPoint)previousLocationInView:(UIView*)view;</div></pre></td></tr></table></figure>
<h4 id="获取触摸的属性"><a href="#获取触摸的属性" class="headerlink" title="获取触摸的属性"></a><strong>获取触摸的属性</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">@property(nonatomic,readonly)NSTimeIntervaltimestamp;</div><div class="line">@property(nonatomic,readonly)UITouchPhasephase;</div><div class="line">@property(nonatomic,readonly)NSUIntegertapCount;</div></pre></td></tr></table></figure>
<h4 id="从plist中获取数据赋给字典"><a href="#从plist中获取数据赋给字典" class="headerlink" title="从plist中获取数据赋给字典"></a><strong>从plist中获取数据赋给字典</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString*plistPath=[[NSBundlemainBundle]pathForResource:@&quot;book&quot;ofType:@&quot;plist&quot;];</div><div class="line">NSDictionary*dictionary=[NSDictionarydictionaryWithContentsOfFile:plistPath];</div></pre></td></tr></table></figure>
<h4 id="NSUserDefaults注意事项"><a href="#NSUserDefaults注意事项" class="headerlink" title="NSUserDefaults注意事项"></a><strong>NSUserDefaults注意事项</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">//设置完了以后如果存储的东西比较重要的话，一定要同步一下[[NSUserDefaultsstandardUserDefaults]synchronize];</div></pre></td></tr></table></figure>
<h4 id="获取Documents目录"><a href="#获取Documents目录" class="headerlink" title="获取Documents目录"></a><strong>获取Documents目录</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString*documentsDirectory=NSSearchPathForDirectoriesInDomains(NSDocumentDirectory,NSUserDomainMask,YES)[0];</div></pre></td></tr></table></figure>
<h4 id="获取tmp目录"><a href="#获取tmp目录" class="headerlink" title="获取tmp目录"></a><strong>获取tmp目录</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSString*tmpPath=NSTemporaryDirectory();</div></pre></td></tr></table></figure>
<h4 id="利用Safari打开一个链接"><a href="#利用Safari打开一个链接" class="headerlink" title="利用Safari打开一个链接"></a><strong>利用Safari打开一个链接</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NSURL*url=[NSURLURLWithString:@&quot;http://baidu.com&quot;];[[UIApplicationsharedApplication]openURL:url];</div></pre></td></tr></table></figure>
<h4 id="利用UIWebView显示pdf文件，网页等等"><a href="#利用UIWebView显示pdf文件，网页等等" class="headerlink" title="利用UIWebView显示pdf文件，网页等等"></a><strong>利用UIWebView显示pdf文件，网页等等</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">UIWebView *webView = [[UIWebView alloc]initWithFrame:self.view.bounds];</div><div class="line"></div><div class="line">webView.delegate = self;</div><div class="line"></div><div class="line">webView.scalesPageToFit = YES;</div><div class="line"></div><div class="line">webView.autoresizingMask = UIViewAutoresizingFlexibleWidth | UIViewAutoresizingFlexibleHeight;</div><div class="line"></div><div class="line">[webView setAllowsInlineMediaPlayback:YES];</div><div class="line"></div><div class="line">[self.view addSubview:webView];</div><div class="line"></div><div class="line">NSString *pdfPath = [[NSBundle mainBundle] pathForResource:@&quot;book&quot; ofType:@&quot;pdf&quot;];</div><div class="line"></div><div class="line">NSURL *url = [NSURL fileURLWithPath:pdfPath];</div><div class="line"></div><div class="line">NSURLRequest *request = [NSURLRequest requestWithURL:url cachePolicy:(NSURLRequestUseProtocolCachePolicy) timeoutInterval:5];</div></pre></td></tr></table></figure>
<h4 id="UIWebView和html的简单交互"><a href="#UIWebView和html的简单交互" class="headerlink" title="UIWebView和html的简单交互"></a><strong>UIWebView和html的简单交互</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">myWebView=[[UIWebViewalloc]initWithFrame:self.view.bounds];</div><div class="line">[myWebView loadRequest:[NSURLRequestrequestWithURL:[NSURLURLWithString:@&quot;http://www.baidu.com&quot;]]];</div><div class="line">NSError*error;</div><div class="line">NSString*errorString=[NSStringstringWithFormat:@&quot;AnError Occurred;</div><div class="line">%@&quot;,error];[myWebView loadHTMLString:errorString baseURL:nil];</div><div class="line"> //页面跳转了以后，停止载入</div><div class="line">-(void)viewWillDisappear:(BOOL)animated&#123;</div><div class="line">  if(myWebView.isLoading)&#123;</div><div class="line">   [myWebView stopLoading];</div><div class="line">&#125;</div><div class="line">    myWebView.delegate=nil;   [UIApplicationsharedApplication].networkActivityIndicatorVisible=NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="汉字转码"><a href="#汉字转码" class="headerlink" title="汉字转码"></a><strong>汉字转码</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString*oriString=@&quot;\u67aa\u738b&quot;;</div><div class="line">NSString*escapedString=[oriString stringByReplacingPercentEscapesUsingEncoding:NSUTF8StringEncoding];</div></pre></td></tr></table></figure>
<h4 id="处理键盘通知"><a href="#处理键盘通知" class="headerlink" title="处理键盘通知"></a><strong>处理键盘通知</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">先注册通知，然后实现具体当键盘弹出来要做什么，键盘收起来要做什么</div><div class="line">  -(void)registerForKeyboardNotifications&#123;</div><div class="line">  keyboardShown=NO;//标记当前键盘是没有显示的</div><div class="line">  [[NSNotificationCenterdefaultCenter]addObserver:selfselector:@selector(keyboardWasShown:)name:UIKeyboardWillShowNotificationobject:nil];[[NSNotificationCenterdefaultCenter]addObserver:selfselector:@selector(keyboardWasHidden:)name:UIKeyboardDidHideNotificationobject:nil];</div><div class="line">&#125;//键盘显示要做什么</div><div class="line">-(void)keyboardWasShown:(NSNotification*)notification&#123;</div><div class="line">  if(keyboardShown)&#123;</div><div class="line">    return;</div><div class="line">  &#125;</div><div class="line">  NSDictionary*info=[notification userInfo];</div><div class="line">  NSValue*aValue=[info objectForKey:UIKeyboardFrameBeginUserInfoKey];</div><div class="line">  CGSizekeyboardSize=[aValueCGRectValue].size;</div><div class="line">  CGRectviewFrame=scrollView.frame;</div><div class="line">  viewFrame.size.height=keyboardSize.height;</div><div class="line">  CGRecttextFieldRect=activeField.frame;</div><div class="line">  [scrollView scrollRectToVisible:textFieldRect animated:YES];</div><div class="line">  keyboardShown=YES;</div><div class="line">&#125;</div><div class="line">-(void)keyboardWasHidden:(NSNotification*)notification&#123;</div><div class="line">  NSDictionary*info=[notification userInfo];</div><div class="line">  NSValue*aValue=[info objectForKey:UIKeyboardFrameEndUserInfoKey];</div><div class="line">  CGSizekeyboardSize=[aValueCGRectValue].size;</div><div class="line">  CGRectviewFrame=scrollView.frame;</div><div class="line">  viewFrame.size.height+=keyboardSize.height;</div><div class="line">  scrollView.frame=viewFrame;</div><div class="line">  keyboardShown=NO;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="点击键盘的next按钮，在不同的textField之间换行"><a href="#点击键盘的next按钮，在不同的textField之间换行" class="headerlink" title="点击键盘的next按钮，在不同的textField之间换行"></a><strong>点击键盘的next按钮，在不同的textField之间换行</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">-(BOOL)textFieldShouldReturn:(UITextField*)textField&#123;</div><div class="line">  if([textField returnKeyType]!=UIReturnKeyDone)</div><div class="line">  &#123;</div><div class="line">    NSIntegernextTag=[textField tag]+1;</div><div class="line">    UIView*nextTextField=[self.tableView viewWithTag:nextTag];</div><div class="line">    [nextTextField becomeFirstResponder];</div><div class="line">  &#125;else&#123;</div><div class="line">    [textField resignFirstResponder];</div><div class="line">  &#125;</div><div class="line">  return YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="设置日期格式"><a href="#设置日期格式" class="headerlink" title="设置日期格式"></a><strong>设置日期格式</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dateFormatter=[[NSDateFormatteralloc]init];</div><div class="line">dateFormatter.locale=[NSLocalecurrentLocale];</div><div class="line">dateFormatter.calendar=[NSCalendarautoupdatingCurrentCalendar];</div><div class="line">dateFormatter.timeZone=[NSTimeZonedefaultTimeZone];</div><div class="line">dateFormatter.dateStyle=NSDateFormatterShortStyle;</div><div class="line">  NSLog(@&quot;%@&quot;,[dateFormatter stringFromDate:[NSDatedate]]);</div></pre></td></tr></table></figure>
<h4 id="加载大量图片的时候，可以使用"><a href="#加载大量图片的时候，可以使用" class="headerlink" title="加载大量图片的时候，可以使用"></a><strong>加载大量图片的时候，可以使用</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString*imagePath=[[NSBundlemainBundle]pathForResource:@&quot;icon&quot;ofType:@&quot;png&quot;];</div><div class="line">UIImage*myImage=[UIImageimageWithContentsOfFile:imagePath];</div></pre></td></tr></table></figure>
<h4 id="有时候在iPhone游戏中，既要播放背景音乐，同时又要播放比如枪的开火音效"><a href="#有时候在iPhone游戏中，既要播放背景音乐，同时又要播放比如枪的开火音效" class="headerlink" title="有时候在iPhone游戏中，既要播放背景音乐，同时又要播放比如枪的开火音效"></a><strong>有时候在iPhone游戏中，既要播放背景音乐，同时又要播放比如枪的开火音效</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSString*musicFilePath=[[NSBundlemainBundle]pathForResource:@&quot;xx&quot;ofType:@&quot;wav&quot;];</div><div class="line">NSURL*musicURL=[NSURL fileURLWithPath:musicFilePath];</div><div class="line">AVAudioPlayer*musicPlayer=[[AVAudioPlayeralloc]initWithContentsOfURL:musicURL error:nil];[musicPlayer prepareToPlay];</div><div class="line">musicPlayer.volume=1;</div><div class="line">musicPlayer.numberOfLoops=-1;//-1表示一直循环</div></pre></td></tr></table></figure>
<h4 id="从通讯录中读取电话号码，去掉数字之间的"><a href="#从通讯录中读取电话号码，去掉数字之间的" class="headerlink" title="从通讯录中读取电话号码，去掉数字之间的-"></a><strong>从通讯录中读取电话号码，去掉数字之间的-</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">NSString*originalString=@&quot;(123)123123abc&quot;;</div><div class="line">NSMutableString*strippedString=[NSMutableStringstringWithCapacity:originalString.length];</div><div class="line">NSScanner*scanner=[NSScannerscannerWithString:originalString];</div><div class="line">NSCharacterSet*numbers=[NSCharacterSetcharacterSetWithCharactersInString:@&quot;0123456789&quot;];</div><div class="line">while([scanner isAtEnd]==NO)</div><div class="line">&#123;</div><div class="line">  NSString*buffer;</div><div class="line">  if([scanner scanCharactersFromSet:numbers intoString:&amp;buffer])</div><div class="line">  &#123;</div><div class="line">    [strippedString appendString:buffer];</div><div class="line">  &#125;else&#123;</div><div class="line">    scanner.scanLocation=[scanner scanLocation]+1;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">NSLog(@&quot;%@&quot;,strippedString);</div></pre></td></tr></table></figure>
<h4 id="正则判断：字符串只包含字母和数字"><a href="#正则判断：字符串只包含字母和数字" class="headerlink" title="正则判断：字符串只包含字母和数字"></a><strong>正则判断：字符串只包含字母和数字</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">NSString*myString=@&quot;Letter1234&quot;;</div><div class="line">NSString*regex=@&quot;[a-z][A-Z][0-9]&quot;;</div><div class="line">NSPredicate*predicate=[NSPredicatepredicateWithFormat:@&quot;SELF MATCHES %@&quot;,regex];</div><div class="line">if([predicate evaluateWithObject:myString])&#123;</div><div class="line">  //implement</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="设置UITableView的滚动条颜色"><a href="#设置UITableView的滚动条颜色" class="headerlink" title="设置UITableView的滚动条颜色"></a><strong>设置UITableView的滚动条颜色</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">self.tableView.indicatorStyle=UIScrollViewIndicatorStyleWhite;</div><div class="line"></div><div class="line">/*网络编程 开发web等网络应用程序的时候，需要确认网络环境，连接情况等信息。如果没有处理它们，是不会通过apple的审查的。 系统自带的网络检查是原生的，AFNetworking也为我们添加了相关检测机制，所以这个直接在介绍AFNetworking的时候详解吧。*/</div></pre></td></tr></table></figure>
<h4 id="使用NSURLConnection下载数据"><a href="#使用NSURLConnection下载数据" class="headerlink" title="使用NSURLConnection下载数据"></a><strong>使用NSURLConnection下载数据</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">//1.创建对象</div><div class="line">  NSMutableURLRequest*request=[NSMutableURLRequestrequestWithURL:[NSURLURLWithString:@&quot;http://www.baidu.com&quot;]];[NSURLConnectionconnectionWithRequest:requestdelegate:self];</div><div class="line">//2.NSURLConnectiondelegate委托方法</div><div class="line">-(void)connection:(NSURLConnection*)connection didReceiveResponse:(NSURLResponse*)response&#123;&#125;</div><div class="line">-(void)connection:(NSURLConnection*)connection didReceiveData:(NSData*)data&#123;&#125;</div><div class="line">-(void)connection:(NSURLConnection*)connection didFailWithError:(NSError*)error&#123;&#125;</div><div class="line">-(void)connectionDidFinishLoading:(NSURLConnection*)connection&#123;&#125;</div><div class="line">//3.实现委托方法</div><div class="line">-(void)connection:(NSURLConnection*)connection didReceiveResponse:(NSURLResponse*)response&#123;</div><div class="line">  self.receiveData.length=0;//先清空数据</div><div class="line">&#125;</div><div class="line">-(void)connection:(NSURLConnection*)connection didReceiveData:(NSData*)data&#123;</div><div class="line">  [self.receiveData appendData:data];</div><div class="line">&#125;</div><div class="line">-(void)connection:(NSURLConnection*)connection didFailWithError:(NSError*)error&#123;</div><div class="line">  //错误处理</div><div class="line">&#125;</div><div class="line">-(void)connectionDidFinishLoading:(NSURLConnection*)connection&#123;</div><div class="line">  [UIApplicationsharedApplication].networkActivityIndicatorVisible=NO;</div><div class="line">  NSString*returnString=[[NSStringalloc]initWithData:self.receiveData encoding:NSUTF8StringEncoding];</div><div class="line">  firstTimeDownloaded=YES;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="读取一般性文件"><a href="#读取一般性文件" class="headerlink" title="读取一般性文件"></a><strong>读取一般性文件</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">-(void)readFromTXT&#123;NSString*tmp;NSArray*lines;//将文件转化为一行一行的</div><div class="line">                   lines=[[NSStringstringWithContentsOfFile:@&quot;testFileReadLines.txt&quot;]componentsSeparatedByString:@&quot;\n&quot;];</div><div class="line"> NSEnumerator*nse=[lines objectEnumerator];//读取&lt;&gt;里的内容</div><div class="line"> while(tmp==[nse nextObject])&#123;</div><div class="line">   NSString*stringBetweenBrackets=nil;</div><div class="line">   NSScanner*scanner=[NSScannerscannerWithString:tmp];</div><div class="line">   [scanner scanUpToString:@&quot;&lt;&quot;intoString:nil];</div><div class="line">   [scanner scanString:@&quot;&lt;&quot;intoString:nil];</div><div class="line">   [scanner scanUpToString:@&quot;&gt;&quot;intoString:&amp;stringBetweenBrackets];</div><div class="line">   NSLog(@&quot;%@&quot;,[stringBetweenBrackets description]);</div><div class="line"> &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="调用电话，短信，邮件"><a href="#调用电话，短信，邮件" class="headerlink" title="调用电话，短信，邮件"></a><strong>调用电话，短信，邮件</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[[UIApplicationsharedApplication]openURL:[NSURLURLWithString:@&quot;mailto:apple@mac.com?Subject=hello&quot;]];sms://调用短信tel://调用电话itms://打开MobileStore.app</div></pre></td></tr></table></figure>
<h4 id="获取版本信息"><a href="#获取版本信息" class="headerlink" title="获取版本信息"></a><strong>获取版本信息</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UIDevice*myDevice=[UIDevicecurrentDevice];</div><div class="line">NSString*systemVersion=myDevice.systemVersion;</div></pre></td></tr></table></figure>
<h4 id="UIWebView的使用"><a href="#UIWebView的使用" class="headerlink" title="UIWebView的使用"></a><strong>UIWebView的使用</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">webView.delegate = self;</div><div class="line"></div><div class="line">(BOOL)webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType &#123;</div><div class="line"></div><div class="line">NSURL *url = request.URL;</div><div class="line"></div><div class="line">NSString *urlStirng = url.absoluteString;</div><div class="line"></div><div class="line">NSLog(@&quot;%@&quot;,urlStirng);</div><div class="line"></div><div class="line">return YES;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="NSNotificationCenter带参数发送"><a href="#NSNotificationCenter带参数发送" class="headerlink" title="NSNotificationCenter带参数发送"></a><strong>NSNotificationCenter带参数发送</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">MPMoviePlayerController*theMovie=[[MPMoviePlayerControlleralloc]initWithContentURL:[NSURL fileURLWithPath:moviePath]];[[NSNotificationCenterdefaultCenter]addObserver:selfselector:@selector(myMovieFinishedCallback:)name:MPMoviePlayerPlaybackDidFinishNotificationobject:theMovie];</div><div class="line">[theMovie play];</div><div class="line">-(void)myMovieFinishedCallback:(NSNotification*)aNotification</div><div class="line">&#123;</div><div class="line">  MPMoviePlayerController*theMovie=[aNotificationobject];[[NSNotificationCenterdefaultCenter]removeObserver:selfname:MPMoviePlayerPlaybackDidFinishNotificationobject:theMovie];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="延迟一段时间执行某个函数"><a href="#延迟一段时间执行某个函数" class="headerlink" title="延迟一段时间执行某个函数"></a><strong>延迟一段时间执行某个函数</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[selfperformSelector:@selector(dismissModal)withObject:selfafterDelay:1.0];</div></pre></td></tr></table></figure>
<h4 id="用NSDateFormatter调整时间格式代码"><a href="#用NSDateFormatter调整时间格式代码" class="headerlink" title="用NSDateFormatter调整时间格式代码"></a><strong>用NSDateFormatter调整时间格式代码</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSDateFormatter*dateFormatter=[[NSDateFormatteralloc]init];</div><div class="line">dateFormatter.dateFormat=@&quot;yyyy-MM-dd HH:mm:ss&quot;;</div><div class="line">NSString*currentDateStr=[dateFormatter stringFromDate:[NSDatedate]];</div></pre></td></tr></table></figure>
<h4 id="iPhone-更改键盘右下角按键的-type"><a href="#iPhone-更改键盘右下角按键的-type" class="headerlink" title="iPhone 更改键盘右下角按键的 type"></a><strong>iPhone 更改键盘右下角按键的 type</strong></h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">SearchBar*mySearchBar=[[UISearchBaralloc]init];</div><div class="line">mySearchBar.frame=CGRectMake(0,0,self.view.bounds.size.width,44);</div><div class="line">mySearchBar.placeholder=@&quot;placeholderString&quot;;</div><div class="line">mySearchBar.delegate=self;</div><div class="line">[self.view addSubview:mySearchBar];</div><div class="line">UITextField*searchField=[[mySearchBar subviews]lastObject];</div><div class="line">searchField.returnKeyType=UIReturnKeyDone;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/16/网络编程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/16/网络编程/" itemprop="url">
                  网络编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-16T16:32:05+08:00">
                2017-01-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/16/网络编程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/16/网络编程/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/16/网络编程/" class="leancloud_visitors" data-flag-title="网络编程">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/15/多线程和GCD/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/15/多线程和GCD/" itemprop="url">
                  多线程和GCD
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-15T22:52:06+08:00">
                2017-01-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/15/多线程和GCD/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/15/多线程和GCD/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/15/多线程和GCD/" class="leancloud_visitors" data-flag-title="多线程和GCD">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="使用NSThread来操作多线程"><a href="#使用NSThread来操作多线程" class="headerlink" title="使用NSThread来操作多线程"></a>使用NSThread来操作多线程</h5><p>不说废话直接上代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line">/*</div><div class="line"> 使用NSThread来操作多线程</div><div class="line"> */</div><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line">//    //主线程中的循环打印任务1</div><div class="line">//    for (int j = 0; j &lt; 50; j++) &#123;</div><div class="line">//        </div><div class="line">//        NSLog(@&quot;主线程1:%i&quot;, j);</div><div class="line">//    </div><div class="line">//    &#125;</div><div class="line">    </div><div class="line">//    //1.创建一个线程对象,可以获取线程对象，指定线程名优先级等，灵活处理。</div><div class="line">//    NSThread *thread = [[NSThread alloc] initWithTarget:self selector:@selector(thread:) object:@&quot;multiThread1&quot;];</div><div class="line">//    thread.name = @&quot;multiThread1&quot;;</div><div class="line">//    </div><div class="line">//    //开启多线程，程序开始有了一条新的执行路径</div><div class="line">//    [thread start];</div><div class="line">    </div><div class="line">     //2.创建一个线程对象，并且直接启动此线程</div><div class="line">    //[NSThread detachNewThreadSelector:@selector(thread:) toTarget:self withObject:@&quot;multiThread1&quot;];</div><div class="line">    //3.创建一个线程对象，并且直接启动此线程</div><div class="line">    [self performSelectorInBackground:@selector(thread:) withObject:@&quot;multiThread1&quot;];</div><div class="line"></div><div class="line">    </div><div class="line">    //主线程中的循环打印任务2</div><div class="line">    for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">        </div><div class="line">        NSLog(@&quot;主线程2:%i&quot;, i);</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">//多线程的入口方法</div><div class="line">- (void)thread:(NSString *)threadName &#123;</div><div class="line">    </div><div class="line">    //获取当前线程对象</div><div class="line">    NSThread *thread = [NSThread currentThread];</div><div class="line">    NSLog(@&quot;多线程:%@&quot;, thread);</div><div class="line">    </div><div class="line">    //当前线程分配的堆栈大小:512K</div><div class="line">    NSLog(@&quot;多线程stackSize:%li&quot;, thread.stackSize);</div><div class="line">    </div><div class="line">        for (int j = 0; j &lt; 50; j++) &#123;</div><div class="line">    </div><div class="line">            NSLog(@&quot;%@:%i&quot;, threadName, j);</div><div class="line">            </div><div class="line">//            if(j % 10 == 0) &#123;</div><div class="line">//                //线程睡眠</div><div class="line">//                [NSThread sleepForTimeInterval:1];</div><div class="line">//            &#125;</div><div class="line">            </div><div class="line">//            if (j == 10) &#123;</div><div class="line">//                </div><div class="line">//                //线程退出的方法</div><div class="line">//                [NSThread exit];</div><div class="line">//</div><div class="line">//            &#125;</div><div class="line">            &#125;</div><div class="line">    </div><div class="line">    //判断当前线程是否为主线程</div><div class="line">    if (![NSThread isMainThread]) &#123;</div><div class="line">        NSLog(@&quot;当前线程不是主线程&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h5 id="线程同步解决方案"><a href="#线程同步解决方案" class="headerlink" title="线程同步解决方案"></a>线程同步解决方案</h5><p>ViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface ViewController : UIViewController</div><div class="line"></div><div class="line">//atomic--&gt;给多线程加锁</div><div class="line">//nonatomic--&gt;不加锁</div><div class="line">@property(atomic, copy)NSString *name;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>ViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    int tickets; //剩余票数</div><div class="line">    NSCondition *condition; //线程代码加锁的处理类</div><div class="line">&#125;</div><div class="line">@end</div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    tickets = 50;</div><div class="line">    condition = [[NSCondition alloc] init];</div><div class="line">    </div><div class="line">    [self performSelectorInBackground:@selector(saleTickets:) withObject:@&quot;thread1&quot;];</div><div class="line">    [self performSelectorInBackground:@selector(saleTickets:) withObject:@&quot;thread2&quot;];</div><div class="line">    [self performSelectorInBackground:@selector(saleTickets:) withObject:@&quot;thread3&quot;];</div><div class="line">&#125;</div><div class="line">//多线程访问共享资源会产生数据不同步的问题。</div><div class="line">//解决方案：给共享资源所在的代码加锁，当一个线程在访问此段代码时，会把这段代码锁住，其它线程无法操作这段代码。</div><div class="line">//加锁后会保证数据同步，但是会影响性能，实际开发中，要根据具体的需要进行加锁处理。</div><div class="line"></div><div class="line">- (void)saleTickets:(NSString *)name &#123;</div><div class="line">    while (true) &#123;</div><div class="line">        //加锁</div><div class="line">        [condition lock];</div><div class="line">        if (tickets &gt; 0) &#123;</div><div class="line">            if ([name isEqualToString:@&quot;thread1&quot;]) &#123;</div><div class="line">                [NSThread sleepForTimeInterval:2];</div><div class="line">            &#125;</div><div class="line">            else &#123;</div><div class="line">                [NSThread sleepForTimeInterval:0.1];</div><div class="line">            &#125;</div><div class="line">            tickets--;</div><div class="line">            NSLog(@&quot;%@卖了一张车票，剩余票数为%i&quot;, name, tickets);</div><div class="line">        &#125;</div><div class="line">        //解锁</div><div class="line">        [condition unlock];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setName:(NSString *)name &#123;</div><div class="line">    </div><div class="line">    if (_name != name) &#123;</div><div class="line">        </div><div class="line">        [condition lock];</div><div class="line">        _name = [name copy];</div><div class="line">        [condition unlock];</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="NSOperationQueue任务队列处理多线程"><a href="#NSOperationQueue任务队列处理多线程" class="headerlink" title="NSOperationQueue任务队列处理多线程"></a>NSOperationQueue任务队列处理多线程</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    NSInvocationOperation *op2;</div><div class="line">    NSInvocationOperation *op1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line">    //1.创建任务队列</div><div class="line">    NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">    </div><div class="line">    //5.(1)设置任务队列的并发数</div><div class="line">    queue.maxConcurrentOperationCount = 1;</div><div class="line">    </div><div class="line">    //2.创建任务对象</div><div class="line">    op1 = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(thread1:) object:@&quot;operation1&quot;];</div><div class="line">    op2 = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(thread2:) object:@&quot;operation2&quot;];</div><div class="line">    </div><div class="line">    //5(2）设置任务执行的优先级</div><div class="line">    //如果当前队列正常运行，则优先级别不起作用</div><div class="line">    op1.queuePriority = NSOperationQueuePriorityVeryLow;</div><div class="line">    op2.queuePriority = NSOperationQueuePriorityHigh;</div><div class="line">    </div><div class="line">    //5（3）任务完成时调用的block</div><div class="line">    op2.completionBlock = ^&#123;</div><div class="line">        NSLog(@&quot;任务2执行完毕&quot;);</div><div class="line">        </div><div class="line">    &#125;;</div><div class="line">    //暂停执行队列中的任务，再添加任务，此时会按照任务的优先级别来执行任务。</div><div class="line">    queue.suspended = YES;</div><div class="line">    </div><div class="line">    //4.将任务对象添加到任务队列中。任务队列就会给此任务绑定一个线程开始执行。</div><div class="line">    [queue addOperation:op1];</div><div class="line">    [queue addOperation:op2];</div><div class="line">    </div><div class="line">    //把任务队列唤醒</div><div class="line">    queue.suspended = NO;</div><div class="line">    //6.创建任务对象，并将任务对象添加到任务队列的另一种方式</div><div class="line">    [queue addOperationWithBlock:^&#123;</div><div class="line">        //block中的代码就可以理解一个任务的入口方法</div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;block-thread:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line">    //3.主线程中的打印任务</div><div class="line">    for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">        NSLog(@&quot;mainThread:%i&quot;, i);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//多线程的入口方法</div><div class="line">- (void)thread1:(NSString *)name &#123;</div><div class="line">    for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">        NSLog(@&quot;%@：%i&quot;, name, i);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)thread2:(NSString *)name &#123;</div><div class="line">    for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">        </div><div class="line">//        if (i == 25) &#123;</div><div class="line">//            //如果当前任务在执行状态，此方法无作用</div><div class="line">//            [op1 cancel];</div><div class="line">//            //如果当前任务没有执行，此方法的作用是把任务从队列中移除</div><div class="line">//            //cancel只是更新了任务对象的一个属性isCancelled＝YES。</div><div class="line">//            </div><div class="line">//        &#125;</div><div class="line">        NSLog(@&quot;%@：%i&quot;, name, i);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h5 id="自定义任务类"><a href="#自定义任务类" class="headerlink" title="自定义任务类"></a>自定义任务类</h5><p>MyOperation.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface MyOperation : NSOperation</div><div class="line"></div><div class="line">@property(nonatomic, copy)NSString *mask;</div><div class="line"></div><div class="line">- (instancetype)initWithName:(NSString *)mask;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>MyOperation.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">#import &quot;MyOperation.h&quot;</div><div class="line"></div><div class="line">@implementation MyOperation</div><div class="line"></div><div class="line">- (instancetype)initWithName:(NSString *)mask &#123;</div><div class="line">    </div><div class="line">    if (self = [super init]) &#123;</div><div class="line">        </div><div class="line">        _mask = mask;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//自定义任务类时，必须在类中重写main方法，此方法执行此任务的入口方法</div><div class="line">- (void)main &#123;</div><div class="line">    </div><div class="line">    //多线程创建的实例对象是不会加入到主线程的自动释放池中的，可能会导致内存泄露。</div><div class="line">    //需要在多线程的入口方法中加入自动释放池。</div><div class="line">    @autoreleasepool &#123;</div><div class="line">        for (int i = 0; i &lt; 1000; i++) &#123;</div><div class="line">            //cancel方法的作用只是改变了isCancelled的状态，不会马上取消当前任务。会在未来的某个时刻，在main方法中检查isCancelled状态时退出当前操作。</div><div class="line">            if (self.isCancelled) &#123;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">            NSLog(@&quot;%@:%i&quot;, self.mask, i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<p>然后再主控制器中实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &quot;MyOperation.h&quot;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    MyOperation *_op1;</div><div class="line">    MyOperation *_op2;</div><div class="line">    NSOperationQueue *_queue;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line">    _queue = [[NSOperationQueue alloc] init];</div><div class="line">    </div><div class="line">    _op1 = [[MyOperation alloc] initWithName:@&quot;myOp1&quot;];</div><div class="line">    _op2 = [[MyOperation alloc] initWithName:@&quot;myOp2&quot;];</div><div class="line">    </div><div class="line">    _queue.maxConcurrentOperationCount = 2;</div><div class="line">    </div><div class="line">    [_queue addOperation:_op1];</div><div class="line">    [_queue addOperation:_op2];</div><div class="line">    </div><div class="line">    _op1.completionBlock = ^&#123;</div><div class="line">        NSLog(@&quot;任务1结束了----------------&quot;);</div><div class="line">    &#125;;</div><div class="line">    _op2.completionBlock = ^&#123;</div><div class="line">        NSLog(@&quot;任务2结束了----------------&quot;);</div><div class="line">    &#125;;</div><div class="line">    //[self performSelector:@selector(afterDelay) withObject:nil afterDelay:0.1];</div><div class="line">    [self performSelector:@selector(cancelAllTasks) withObject:nil afterDelay:0.5];</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)afterDelay &#123;</div><div class="line">    [_op1 cancel]; //isCancelled--&gt;YES</div><div class="line">    </div><div class="line">    //如果任务没有开始执行，则取消，如果任务开始执行了，则需要在当前任务类的main方法中手动去判断isCancelled属性是否为YES，如果为YES,则退出当前操作。</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)cancelAllTasks &#123;</div><div class="line">    </div><div class="line">    //取消当前队列中的所有任务</div><div class="line">    [_queue cancelAllOperations];</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h5 id="GCD的基本使用"><a href="#GCD的基本使用" class="headerlink" title="GCD的基本使用"></a>GCD的基本使用</h5><p>1.GCD的本质就是定义想要执行的任务，并把任务追加到适当的Dispatch Queue中。</p>
<p> 2.Dispatch Queue就是执行处理的等待队列，使用block语法来追加任务到队列中，队列按照先进先出的原则处理任务。</p>
<p> 分为两种：</p>
<p> （1）串行队列：所有的任务排队执行，按照添加到队列中的顺序执行。可能只会开启一个线程。</p>
<p> （2）并行队列：所有任务并发执行。可能开启多个线程。并行队列并发的线程数量取决当前系统的状态，GCD会根据当前操作系统中CPU的核数，CPU的负荷，状态来确定并发数量。</p>
<p> （3）主队列（串行队列）：其中只有一个主线程在运行。</p>
<p> 3.两种追加任务的方式：同步追加和异步追加</p>
<p> （1）异步追加：可能会开启新的线程来执行新任务。</p>
<p> 1&gt;dispatch_async函数的特点：追加任务立即返回，执行下面的代码。</p>
<p> 2&gt;追加到串行队列：新任务排队执行。</p>
<p> 3&gt;追加到并行队列：并发执行新任务。</p>
<p> （2）同步追加：在当前线程执行新任务，一般来讲不会开启新线程。</p>
<p> 1&gt;dispatch_sync函数的特点：会一直等待，等待到当前的新任务添加到队列并且执行完毕才能返回，继续执行下面的代码。</p>
<p> 2&gt;必须等到追加的队列中所有的前面排队的任务执行完成后，才能把新任务追加到队列中，并且执行。</p>
<p> 4.分为四种情况来解释GCD的基本操作</p>
<p> （1）向并行队列中异步添加任务（最常用）</p>
<p> （2）向串行队列中异步添加任务</p>
<p> （3）向并行队列中同步添加任务</p>
<p> （4）向串行队列中同步添加任务</p>
<p>下面直接上代码：</p>
<p>ViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    //[self concurrentAndAsync];</div><div class="line">    //[self serialAndAsync];</div><div class="line">    [self concurrentAndSync];</div><div class="line">    //[self serialAndSync];</div><div class="line">    [self mainQueuePrintTask];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mainQueuePrintTask &#123;</div><div class="line">    </div><div class="line">    for (int i = 0; i &lt; 200; i++) &#123;</div><div class="line">        NSLog(@&quot;主线程任务:%i&quot;, i);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//(4) 向串行队列中同步添加任务</div><div class="line">- (void)serialAndSync &#123;</div><div class="line">    </div><div class="line">    //创建一个串行队列</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;huiwen&quot;, DISPATCH_QUEUE_SERIAL);</div><div class="line">    </div><div class="line">    //向串行队列中同步的添加任务</div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;同步任务1:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;同步任务2:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">//（3）向并行队列中同步添加任务</div><div class="line">- (void)concurrentAndSync &#123;</div><div class="line">    </div><div class="line">    //获取系统提供的并行队列：一般来讲不会创建新的并行队列</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    </div><div class="line">    //同步添加任务</div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;同步任务1:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_sync(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;同步任务2:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">// （2）向串行队列中异步添加任务</div><div class="line">- (void)serialAndAsync &#123;</div><div class="line">    </div><div class="line">    //创建一个串行队列</div><div class="line">    dispatch_queue_t queue = dispatch_queue_create(&quot;huiwen&quot;, DISPATCH_QUEUE_SERIAL);</div><div class="line">    </div><div class="line">    //向串行队列中异步的添加任务</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;异步任务1:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;异步任务2:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    /*</div><div class="line">    主线程中有三个任务：异步添加任务1，异步添加任务2，打印任务</div><div class="line">    先执行异步添加任务1，dispatch_asyc不做任何等待，立即执行主线程中下面的任务。要把任务添加串行队列中，要等待串行队列中排队的任务执行完成新任务才能被添加且执行。此时串行队列无排队任务，新任务1立即添加执行（绑定一个新的多线程）。</div><div class="line">    主线程执行异步添加任务2，dispatch_asyc不做任何等待，立即执行主线程中下面的任务。要把任务添加串行队列中，要等待串行队列中排队的任务执行完成新任务才能被添加且执行。此时串行队列有排队新任务1在执行，新任务2需要等待新任务1执行完毕后才能添加到串行队列中并执行。因此没有开启新线程执行新任务2，而是和新任务1在同一个线程中执行。</div><div class="line">    主线程中的打印任务。</div><div class="line">    两条路径，新任务1和新任务2在多线程中有顺序的运行，主线程中的打印任务和它们并发执行。</div><div class="line">    */</div><div class="line">&#125;</div><div class="line"></div><div class="line">//（1）向并行队列中异步添加任务（最常用）</div><div class="line">- (void)concurrentAndAsync &#123;</div><div class="line">    </div><div class="line">    //获取系统提供的并行队列：一般来讲不会创建新的并行队列</div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</div><div class="line">    </div><div class="line">    //向并行队列中异步添加两个任务</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;异步任务1:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        </div><div class="line">        for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">            NSLog(@&quot;异步任务2:%i&quot;, i);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">    /*</div><div class="line">    主线程中有三个任务：异步添加任务1，异步添加任务2，打印任务</div><div class="line">    先执行异步添加任务1，dispatch_asyc不做任何等待，立即添加任务到并行队列中，新任务1立即执行（开启新线程1），与此同时，主线程中继续执行dispatch_async下面的代码。</div><div class="line">    异步添加任务2，dispatch_asyc不做任何等待，立即添加任务到并行队列中，新任务2立即执行（开启新线程2），与此同时，主线程中继续执行dispatch_async下面的代码。</div><div class="line">    主线程中执行打印任务。</div><div class="line">    三个线程，三条程序执行的路径，并行。因此三个打印任务是并发执行的。</div><div class="line">    */</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h5 id="GCD可以运用到遍历数组中"><a href="#GCD可以运用到遍历数组中" class="headerlink" title="GCD可以运用到遍历数组中"></a>GCD可以运用到遍历数组中</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line">    //遍历数组的方式</div><div class="line">    //1.普通遍历</div><div class="line">    //2.快速遍历</div><div class="line">    </div><div class="line">    NSArray *array = @[@1,@2,@3,@4,@5,@6,@7,@8,@9];</div><div class="line">//    </div><div class="line">//    for (NSNumber *object in array) &#123;</div><div class="line">//        </div><div class="line">//        NSLog(@&quot;%@&quot;,object);</div><div class="line">//        </div><div class="line">//    &#125;</div><div class="line">    </div><div class="line">    //3.枚举器遍历</div><div class="line">//    [array enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) &#123;</div><div class="line">//        </div><div class="line">//        NSLog(@&quot;%@&quot;, obj);</div><div class="line">//        </div><div class="line">//        if (idx == 5) &#123;</div><div class="line">//            *stop = YES;</div><div class="line">//        &#125;</div><div class="line">//        </div><div class="line">//        </div><div class="line">//    &#125;];</div><div class="line">//    </div><div class="line">//    NSDictionary *dic = @&#123;@&quot;hello&quot; : @&quot;world&quot;,</div><div class="line">//                          @&quot;hi&quot;: @&quot;hate&quot;</div><div class="line">//                          </div><div class="line">//                          &#125;;</div><div class="line">//    [dic enumerateKeysAndObjectsUsingBlock:^(id key, id obj, BOOL *stop) &#123;</div><div class="line">//        NSLog(@&quot;%@:%@&quot;, key, obj);</div><div class="line">//    &#125;];</div><div class="line">    </div><div class="line">    </div><div class="line"></div><div class="line">//     BOOL isStop = NO;</div><div class="line">//    </div><div class="line">//    for (int index = 0; index &lt; array.count; index++) &#123;</div><div class="line">//        block(array[index], index, &amp;isStop);</div><div class="line">//        </div><div class="line">//        if (isStop) &#123;</div><div class="line">//            break;</div><div class="line">//        &#125;</div><div class="line">//        </div><div class="line">//        </div><div class="line">//    &#125;</div><div class="line">    </div><div class="line">    </div><div class="line">    //4. 用队列异步操作数组，进行数组的遍历</div><div class="line">    //操作无序的，把访问每一个元素的任务异步添加到并行队列，并发执行。这样的操作非常高效。</div><div class="line">    dispatch_queue_t gloableQueue = dispatch_get_global_queue(0, 0);</div><div class="line">    </div><div class="line">    dispatch_apply(array.count, gloableQueue, ^(size_t index) &#123;</div><div class="line">        </div><div class="line">        NSLog(@&quot;%lu:%@&quot;, index, array[index]);</div><div class="line">        </div><div class="line">    &#125;);</div></pre></td></tr></table></figure>
<h5 id="同步追加产生的死锁"><a href="#同步追加产生的死锁" class="headerlink" title="同步追加产生的死锁"></a>同步追加产生的死锁</h5><ol>
<li><p>同步追加任务到主队列产生死锁</p>
</li>
<li><p>如何从多线程中回到主线程中去更新UI</p>
<p><strong>GCD使用总结：</strong></p>
<ol>
<li><p>向并行队列异步添加会开启一条新线程。</p>
</li>
<li><p>向串行队列异步添加可能会开启一条新线程。</p>
</li>
<li><p>同步添加不会开启一条新线程。</p>
</li>
<li><p>向主队列同步追加任务很容易产生死锁。</p>
</li>
<li><p>大任务的处理一般使用多线程完成，如网络申请，大文件的操作以及数据库操作。但是如果多线程中任务完成，需要更新UI,则必须回到主线程更新UI。</p>
</li>
<li><p>需要回到主线程更新UI时，可以使用同步追加或者异步追加，具体使用哪种追加方式，需要根据实际情况判断，如果多线程中的其它任务需要等到更新UI之后才进行，则使用同步追加，如果没有特殊需求，则两种方式都可以进行。</p>
</li>
</ol>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line">//    [self addSyncTaskToMainQueue];</div><div class="line">//    [self mainQueuePrintTask];</div><div class="line">    </div><div class="line">    dispatch_async(dispatch_get_global_queue(0, 0), ^&#123;</div><div class="line">        //网络申请</div><div class="line">        //网络申请图片成功后要更新UI,将图片显示在界面上。</div><div class="line">        //更新UI的动作要在主线程完成，需要添加任务到主队列。</div><div class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">            </div><div class="line">            //        UIImageView *imageView;</div><div class="line">            //</div><div class="line">            //        imageView.image = image;</div><div class="line">            </div><div class="line">            NSLog(@&quot;GCD主线程&quot;);</div><div class="line"></div><div class="line">        &#125;);</div><div class="line">        </div><div class="line">        NSLog(@&quot;GCD多线程&quot;);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)mainQueuePrintTask &#123;</div><div class="line">    for (int i = 0; i &lt; 50; i++) &#123;</div><div class="line">        NSLog(@&quot;主线程打印任务:%i&quot;, i);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)addSyncTaskToMainQueue &#123;</div><div class="line">    </div><div class="line">    //获取主队列</div><div class="line">    dispatch_queue_t mainQueue = dispatch_get_main_queue();</div><div class="line">    </div><div class="line">    //向主队列中同步追加任务,产生死锁</div><div class="line">    //同步追加时，dispatch_sync函数在一直等待block任务添加到主队列中并执行，不添加不执行完毕无法继续下面的代码。</div><div class="line">    //而同步追加的特点是必须等到当前队列中所有的任务全部执行完毕才能追加到队列中，因此互相等待，造成死锁。</div><div class="line">    //异步追加，可以正常运行，因为dispathc_async函数不需要等待。</div><div class="line">    dispatch_async(mainQueue, ^&#123;</div><div class="line">        </div><div class="line">        NSLog(@&quot;主线程block任务&quot;);</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<h5 id="多线程下载图片"><a href="#多线程下载图片" class="headerlink" title="多线程下载图片"></a>多线程下载图片</h5><p>我们自定义一个UIImageView的扩展：UIImageView+ImageRequest</p>
<p>UIImageView+ImageRequest.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface UIImageView (ImageRequest)</div><div class="line"></div><div class="line">- (void)setImageWithURL:(NSURL *)url;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>UIImageView+ImageRequest.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#import &quot;UIImageView+ImageRequest.h&quot;</div><div class="line"></div><div class="line">@implementation UIImageView (ImageRequest)</div><div class="line"></div><div class="line">- (void)setImageWithURL:(NSURL *)url &#123;</div><div class="line">    </div><div class="line">//    NSData *data = [NSData dataWithContentsOfURL:url];</div><div class="line">//    </div><div class="line">//    UIImage *image = [UIImage imageWithData:data];</div><div class="line">//    </div><div class="line">//    self.image = image;</div><div class="line">    </div><div class="line">    dispatch_queue_t queue = dispatch_get_global_queue(0, 0);</div><div class="line">    dispatch_async(queue, ^&#123;</div><div class="line">        </div><div class="line">        //下载图片数据任务在多线程中处理</div><div class="line">            NSData *data = [NSData dataWithContentsOfURL:url];</div><div class="line">        </div><div class="line">            UIImage *image = [UIImage imageWithData:data];</div><div class="line">        </div><div class="line">        //更新UI要在主线程中处理</div><div class="line">        dispatch_sync(dispatch_get_main_queue(), ^&#123;</div><div class="line">            self.image = image;</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>然后在主控制器中实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line">#import &quot;UIImageView+ImageRequest.h&quot;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    NSMutableArray *imgViews;</div><div class="line">    BOOL isLoad;</div><div class="line">&#125;</div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    imgViews = [NSMutableArray array];</div><div class="line">    </div><div class="line">    for (int i = 0; i &lt; 3; i++) &#123;</div><div class="line">        </div><div class="line">        for (int j = 0; j &lt; 3 ; j++) &#123;</div><div class="line">            UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(110*j, 110*i+20, 105, 105)];</div><div class="line">            </div><div class="line">            imageView.backgroundColor = [UIColor orangeColor];</div><div class="line">            [self.view addSubview:imageView];</div><div class="line">            </div><div class="line">            [imgViews addObject:imageView];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    isLoad = NO;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event &#123;</div><div class="line">    if (!isLoad) &#123;</div><div class="line">        for (UIImageView *imageView in imgViews) &#123;</div><div class="line">            NSString *urlString = @&quot;https://ww3.sinaimg.cn/large/006y8lVagw1fbrqb5ry15j303c03cwee.jpg&quot;;</div><div class="line">            NSURL *url = [NSURL URLWithString:urlString];</div><div class="line">            //网络加载，将imageView显示的图片设置为网络加载图片</div><div class="line">            [imageView setImageWithURL:url];</div><div class="line">        &#125;</div><div class="line">        isLoad = YES;</div><div class="line">    &#125; </div><div class="line">&#125;</div><div class="line">@end</div></pre></td></tr></table></figure>
<h5 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h5><p>不说废话，直接上demo是我的风格：</p>
<p>AdressBook.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">#import &lt;Foundation/Foundation.h&gt;</div><div class="line"></div><div class="line">@interface AdressBook : NSObject</div><div class="line"></div><div class="line">@property(nonatomic,assign)NSUInteger phone;</div><div class="line">@property(nonatomic,copy)NSString *name;</div><div class="line">//...</div><div class="line"></div><div class="line"></div><div class="line">//单例的类方法</div><div class="line">+ (AdressBook *)shareInstance;</div><div class="line"></div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>AdressBook.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line">#import &quot;AdressBook.h&quot;</div><div class="line"></div><div class="line">static AdressBook *instance = nil;</div><div class="line"></div><div class="line">@implementation AdressBook</div><div class="line"></div><div class="line">+ (AdressBook *)shareInstance &#123;</div><div class="line">    </div><div class="line">//    AdressBook *book = [[AdressBook alloc] init];</div><div class="line">//    return [book autorelease];</div><div class="line">    </div><div class="line">//    if (instance == nil) &#123;</div><div class="line">//        instance = [[self alloc] init];</div><div class="line">//    &#125;</div><div class="line">//</div><div class="line">//    return instance;</div><div class="line">    </div><div class="line">    //API:当dispatch_once函数被调用多次时，block中的代码只被执行一次,onceToken是记录是否是第一次执行标记（令牌）</div><div class="line">    //GCD的接口可以保证线程安全。</div><div class="line">    static dispatch_once_t onceTocken = 0;</div><div class="line">    </div><div class="line">    dispatch_once(&amp;onceTocken, ^&#123;</div><div class="line">        </div><div class="line">        instance = [[self alloc] init];</div><div class="line">        </div><div class="line">    &#125;);</div><div class="line">    </div><div class="line">    return instance;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">//+ (instancetype)alloc &#123;</div><div class="line">//    </div><div class="line">//    [self allocWithZone:&lt;#(struct _NSZone *)#&gt;];</div><div class="line">//</div><div class="line"></div><div class="line">//&#125;</div><div class="line"></div><div class="line"></div><div class="line">//allo分配内存的工作是自动调用allocWithZone完成的，如果要实现单例则需要复写allocWithZone</div><div class="line">//实现一些限制方法，限制这个类始终只能创建一个对象，并且此对象不能销毁</div><div class="line">+ (id)allocWithZone:(struct _NSZone *)zone &#123;</div><div class="line"> </div><div class="line">    if (instance == nil) &#123;</div><div class="line">        instance = [super allocWithZone:zone];</div><div class="line">    &#125;</div><div class="line">    return instance;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//此方法是调用copy方法之后调用的</div><div class="line">- (id)copyWithZone:(NSZone *)zone &#123;</div><div class="line">    </div><div class="line">    //正常实现是新创建对象，作为复制的副本对象</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (oneway void)release &#123;</div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (id)autorelease &#123;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (id)retain &#123;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (NSUInteger)retainCount &#123;</div><div class="line">    return UINT_MAX;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/13/CALayer的基本使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/13/CALayer的基本使用/" itemprop="url">
                  CALayer的基本使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-13T22:27:20+08:00">
                2017-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/13/CALayer的基本使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/13/CALayer的基本使用/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/13/CALayer的基本使用/" class="leancloud_visitors" data-flag-title="CALayer的基本使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="CALayer和UIView的区别"><a href="#CALayer和UIView的区别" class="headerlink" title="CALayer和UIView的区别"></a>CALayer和UIView的区别</h4><p>1.UIView是UIKit的(只能iOS使用)，CALayer是QuartzCore的(iOS和mac os通用)</p>
<p>2.UIView继承UIResponder,CALayer继承NSObject,UIView比CALayer多了一个事件处理的功能，也就是说，CALayer不能处理用户的触摸事件，而UIView可以</p>
<p>3.UIView来自CALayer，是CALayer的高层实现和封装，UIView的所有特性来源于CALayer支持</p>
<p>4.CABasicAnimation，CAAnimation，CAKeyframeAnimation等动画类都需要加到CALayer上</p>
<p>其实UIView之所以能显示在屏幕上，完全是因为它内部的一个图层</p>
<p>在创建UIView对象时，UIView内部会自动创建一个图层(即CALayer对象)，通过UIView的layer属性可以访问这个层</p>
<h4 id="CALayer的基本属性"><a href="#CALayer的基本属性" class="headerlink" title="CALayer的基本属性"></a>CALayer的基本属性</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//圆角半径</div><div class="line">view.layer.cornerRadius = 50;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//阴影</div><div class="line">view.layer.shadowColor = [UIColor lightGrayColor].CGColor;</div><div class="line">view.layer.shadowOffset = CGSizeMake(10, 10);</div><div class="line">view.layer.shadowOpacity = 1;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//边框</div><div class="line">view.layer.borderColor = [UIColor redColor].CGColor;</div><div class="line">view.layer.borderWidth = 3;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//仅表示给父层倒圆角,子层无相关设置</div><div class="line">//imgView.layer.cornerRadius = 100;</div><div class="line">//表示子层随父层一起变化</div><div class="line">//imgView.layer.masksToBounds = YES;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">//阴影效果不能和maskToBounds一起设置</div><div class="line">imgView.layer.shadowColor = [UIColor lightGrayColor].CGColor;</div><div class="line">imgView.layer.shadowOffset = CGSizeMake(10, 10);</div><div class="line">imgView.layer.shadowOpacity = 1;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//3D形变</div><div class="line">//旋转效果：1为顺时针，-1为逆时针</div><div class="line">//imgView.layer.transform = CATransform3DMakeRotation(M_PI/2, 0, 0, 1);</div><div class="line"></div><div class="line">//KVC来设置形变效果,可以进行效果叠加</div><div class="line">[imgView.layer setValue:@-100 forKeyPath:@&quot;transform.translation&quot;];</div><div class="line"></div><div class="line">[imgView.layer setValue:@M_PI_4 forKeyPath:@&quot;transform.rotation.z&quot;];</div></pre></td></tr></table></figure>
<p>详细请见下图：</p>
<p><img src="http://ww3.sinaimg.cn/large/e3aca1a1jw1fbrogj5e92j20lr0nxn3c.jpg" alt=""></p>
<h4 id="创建CALayer来显示内容"><a href="#创建CALayer来显示内容" class="headerlink" title="创建CALayer来显示内容"></a>创建CALayer来显示内容</h4><p><code>CALayer</code>不能接收点击事件，只能显示界面，它的出现只是为了提高动画的执行效率，父类是<code>NSObject</code>。</p>
<p><code>UIView的</code>父类是<code>UIResponder</code>，可以接收事件，并且参与到事件响应者链中。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"> //1.创建图层</div><div class="line">    CALayer *myLayer = [CALayer layer];</div><div class="line">    </div><div class="line">    //2.添加到self.view的rootLayer上才能显示</div><div class="line">    [self.view.layer addSublayer:myLayer];</div><div class="line">    </div><div class="line">    //3.设置属性</div><div class="line">    myLayer.bounds = CGRectMake(0, 0, 200, 200);</div><div class="line">    </div><div class="line">    myLayer.backgroundColor = [UIColor redColor].CGColor;</div><div class="line">    </div><div class="line">    myLayer.position = CGPointMake(100, 100);</div><div class="line">    </div><div class="line">    </div><div class="line">    //锚点的取值是0-1之间的值,默认值为0.5，0.5</div><div class="line">    //锚点决定了当前层和postion之间的相对位置</div><div class="line">    myLayer.anchorPoint = CGPointMake(0.5, 0.5);</div><div class="line">    </div><div class="line">    </div><div class="line">    //当层进行3D形变时，会以锚点为轴进行放大缩小以及旋转</div><div class="line">    [myLayer setValue:@-M_PI_4 forKeyPath:@&quot;transform.rotation.z&quot;];</div><div class="line">    </div><div class="line">    UIImage *image =[UIImage imageNamed:@&quot;ali.jpg&quot;];</div><div class="line">    </div><div class="line">    //把图片作为当前层的显示内容</div><div class="line">    myLayer.contents = (id)image.CGImage;</div><div class="line">    //myLayer.contents =  (__bridge id _Nullable)([UIImage imageNamed:@&quot;ali.jpg&quot;].CGImage);</div><div class="line"></div><div class="line">//内容模式，类似于UIImageView的contentMode。默认是填充整个区域 kCAGravityResize</div><div class="line">//kCAGravityResizeAspectFill 这个会向左边靠 贴到view的边边上</div><div class="line">//kCAGravityResizeAspect 这个好像就是按比例了 反正是长方形</div><div class="line">myLayer.contentsGravity = kCAGravityResizeAspect;</div></pre></td></tr></table></figure>
<h4 id="CALayer的隐式动画属性"><a href="#CALayer的隐式动画属性" class="headerlink" title="CALayer的隐式动画属性"></a>CALayer的隐式动画属性</h4><p>非rootLayer才有存在隐式动画。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController () &#123;</div><div class="line">    CALayer *myLayer;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    // Do any additional setup after loading the view, typically from a nib.</div><div class="line">    </div><div class="line">    myLayer = [CALayer layer];</div><div class="line">    myLayer.bounds = CGRectMake(0, 0, 100, 100);</div><div class="line">    myLayer.backgroundColor = [UIColor orangeColor].CGColor;</div><div class="line">    </div><div class="line">    [self.view.layer addSublayer:myLayer];</div><div class="line">    </div><div class="line">    myLayer.position = CGPointMake(100, 100);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event &#123;</div><div class="line">    </div><div class="line">    UITouch *touch = [touches anyObject];</div><div class="line">    </div><div class="line">    CGPoint p = [touch locationInView:self.view];</div><div class="line">    </div><div class="line">    //开始动画,动画事务性的处理</div><div class="line">    [CATransaction begin];</div><div class="line">    //关闭CALayer的隐式动画效果</div><div class="line">    [CATransaction setDisableActions:YES];</div><div class="line">    </div><div class="line">    //修改图层的显示位置</div><div class="line">    myLayer.position = p;</div><div class="line">    </div><div class="line">    </div><div class="line">    NSInteger size = arc4random_uniform(50) + 50;</div><div class="line">    myLayer.bounds = CGRectMake(0, 0, size, size);</div><div class="line">    myLayer.opacity = arc4random_uniform(10)/10.0;</div><div class="line">    </div><div class="line">    //提交动画效果</div><div class="line">    [CATransaction commit];</div><div class="line">    </div><div class="line">//    [UIView beginAnimations:&lt;#(NSString *)#&gt; context:&lt;#(void *)#&gt;];</div><div class="line">//    [UIView commitAnimations];</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="在CALayer上绘图"><a href="#在CALayer上绘图" class="headerlink" title="在CALayer上绘图"></a>在CALayer上绘图</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">CALayer *layer = [CALayer layer];</div><div class="line">layer.bounds = CGRectMake(0, 0, 200, 200);</div><div class="line">layer.backgroundColor = [UIColor grayColor].CGColor;</div><div class="line">layer.position = CGPointMake(100, 100);</div><div class="line"></div><div class="line">[self.view.layer addSublayer:layer];</div><div class="line"></div><div class="line">//设置图层的代理对象，调用代理对象的相关协议方法进行内容的绘制</div><div class="line">//不能把self.view作为当前层的代理，因为它已经是rootLayer的代理，再次设置会出问题：self.view.layer.delegate = self.view;</div><div class="line"></div><div class="line">layer.delegate = self;</div><div class="line"></div><div class="line">//必须发送此消息，才能触发当前层代理对象绘图协议方法的调用</div><div class="line">[layer setNeedsDisplay];</div></pre></td></tr></table></figure>
<p>然后实现代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">#pragma mark - CALayer delegate</div><div class="line">- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx &#123;</div><div class="line">    </div><div class="line">    //NSLog(@&quot;%@&quot;, layer);</div><div class="line">    //用UIKit提供的方法进行绘制无法实现绘制</div><div class="line">    //此协议方法是CALayer的协议方法，为了避免CA框架和UIKit耦合，UIKit提供的方法在此处无效，因为在此处使用UIKit函数无法获取到context。</div><div class="line">//    [[UIColor blueColor] setFill];</div><div class="line">//    </div><div class="line">//    UIRectFill(CGRectMake(50, 50, 100, 100));</div><div class="line">    </div><div class="line">    //只能使用CG框架提供的接口进行绘制</div><div class="line">    CGContextAddRect(ctx, CGRectMake(50, 50, 100, 100));</div><div class="line">    CGContextSetRGBFillColor(ctx, 0, 0, 1, 1);</div><div class="line">    </div><div class="line">    CGContextDrawPath(ctx, kCGPathFill);</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下面我们通过CALayer来创建一个UIView,说明UIView,CALayer,图形上下文之间的关系</p>
<p>在一个UIView的子类中实现下面的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</div><div class="line">    if (self = [super initWithFrame:frame]) &#123;</div><div class="line">    </div><div class="line">        //在UIView的构造方法中做了如下设置，把当前UIView的Layer属性的delegate设置为当前UIView对象。</div><div class="line">       //self.layer.delegate = self;</div><div class="line">        </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">// Only override drawRect: if you perform custom drawing.</div><div class="line">// An empty implementation adversely affects performance during animation.</div><div class="line">- (void)drawRect:(CGRect)rect &#123;</div><div class="line">    // Drawing code</div><div class="line">    </div><div class="line">//    NSLog(@&quot;%@&quot;, self);</div><div class="line">//    NSLog(@&quot;%@&quot;, self.layer.delegate);</div><div class="line">    </div><div class="line">    </div><div class="line">    CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line">    </div><div class="line">    //在drawRect:方法中获取的context就是CALayer准备好的context传入协议方法中的context。</div><div class="line">     NSLog(@&quot;%p&quot;, context);</div><div class="line">    </div><div class="line">    </div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)drawLayer:(CALayer *)layer inContext:(CGContextRef)ctx &#123;</div><div class="line">     NSLog(@&quot;%p&quot;, ctx);</div><div class="line">    </div><div class="line">    //必须调用父类的协议方法，因为在UIView的此协议方法中会自动调用drawRect:进行绘制，如果不调用则drawRect:不会被调用。</div><div class="line">    [super drawLayer:layer inContext:ctx];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/13/Quartz-2D的基本使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/13/Quartz-2D的基本使用/" itemprop="url">
                  Quartz 2D的基本使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-13T14:03:21+08:00">
                2017-01-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/13/Quartz-2D的基本使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/13/Quartz-2D的基本使用/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/13/Quartz-2D的基本使用/" class="leancloud_visitors" data-flag-title="Quartz 2D的基本使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="什么是Quartz2D"><a href="#什么是Quartz2D" class="headerlink" title="什么是Quartz2D?"></a>什么是Quartz2D?</h4><p>Quartz 2D是一个二维绘图引擎，同时支持iOS和Mac系统</p>
<ul>
<li>Quartz 2D能完成的工作<ul>
<li>绘制图形 : 线条\三角形\矩形\圆\弧\贝塞尔曲线等</li>
<li>绘制文字</li>
<li>绘制\生成图片(图像)</li>
<li>读取\生成PDF</li>
<li>截图\裁剪图片</li>
<li>自定义UI控件</li>
</ul>
</li>
</ul>
<h4 id="Quartz2D在iOS开发中的价值"><a href="#Quartz2D在iOS开发中的价值" class="headerlink" title="Quartz2D在iOS开发中的价值:"></a>Quartz2D在iOS开发中的价值:</h4><ul>
<li>绘制一些系统UIKit框架中不好展示的内容，例如饼图</li>
<li>自定义一些控件</li>
<li>不添加UI控件的情况下，使UI内容更丰富</li>
<li>……</li>
</ul>
<p><strong>iOS中，大部分控件都是Quartz2D绘制出来的</strong></p>
<h4 id="图形上下文"><a href="#图形上下文" class="headerlink" title="图形上下文"></a>图形上下文</h4><p><strong>图形上下文就相当于画布，不同类型的画布就是决定着画得内容将展示在哪里</strong></p>
<ul>
<li>Quartz2D提供了以下几种类型的Graphics Context：<br>◦ Bitmap Graphics Context 位图上下文，在这个上下文上绘制或者渲染的内容，可以获取成图片（需要主动创建一个位图上下文来使用，使用完毕，一定要销毁）<br>◦ PDF Graphics Context<br>◦ Window Graphics Context<br>◦ Layer Graphics Context 图层上下文，针对UI控件的上下文<br>◦ Printer Graphics Context</li>
</ul>
<h4 id="drawRect"><a href="#drawRect" class="headerlink" title="drawRect:"></a>drawRect:</h4><p>为什么要实现drawRect:方法才能绘图到view上？<br>因为在drawRect:方法中才能取得跟view相关联的图形上下文</p>
<p>drawRect:中取得的上下文，然后就可以绘制东西到view上</p>
<p>View内部有个layer（图层）属性，drawRect:方法中取得的是一个Layer Graphics Context，因此，绘制的东西其实是绘制到view的layer上去了</p>
<p><strong>View之所以能显示东西，完全是因为它内部的layer</strong></p>
<h4 id="drawRect-方法的调用？"><a href="#drawRect-方法的调用？" class="headerlink" title="drawRect:方法的调用？"></a>drawRect:方法的调用？</h4><p>• 当view第一次显示到屏幕上时，系统会创建好一个跟当前view相关的Layer上下文<br>• 系统会通过此上下文，在drawRect:方法中绘制好当前view的内容<br>• 主动让view重绘内容的时候，调用setNeedsDisplay或者setNeedsDisplayInRect:。我们主动调用drawRect:方法是无效的。<br>• 调用view的setNeedsDisplay或者setNeedsDisplayInRect:时。<br>• 注意：setNeedsDisplay和setNeedsDisplayInRect:方法调用后，屏幕并不是立即刷新，而是会在下一次刷新屏幕的时候把绘制的内容显示出来。</p>
<p>也正是系统会在调用这个方法之前创建一个与该view相关的上下文，才让我们可以在drawRect:方法中绘制。注意：在其他地方拿不到view相关的上下文，所以不能实现绘制。</p>
<h4 id="自定义view"><a href="#自定义view" class="headerlink" title="自定义view"></a>自定义view</h4><p>如何利用Quartz2D绘制东西到view上？<br>• 首先，得有图形上下文，因为它能保存绘图信息，并且决定着绘制到什么地方去<br>• 其次，那个图形上下文必须跟view相关联，才能将内容绘制到view上面</p>
<h5 id="自定义view的步骤"><a href="#自定义view的步骤" class="headerlink" title="自定义view的步骤:"></a>自定义view的步骤:</h5><p>1   新建一个类，继承自UIView<br>2   实现- (void)drawRect:(CGRect)rect方法，然后在这个方法中<br>3   取得跟当前view相关联的图形上下文<br>4   绘制相应的图形内容<br>5   利用图形上下文将绘制的所有内容渲染显示到view上面</p>
<h4 id="常用拼接路径函数"><a href="#常用拼接路径函数" class="headerlink" title="常用拼接路径函数"></a>常用拼接路径函数</h4><p>• 新建一个起点<br><code>void CGContextMoveToPoint(CGContextRef c, CGFloat x, CGFloat y)</code><br>• 添加新的线段到某个点<br><code>void CGContextAddLineToPoint(CGContextRef c, CGFloat x, CGFloat y)</code><br>• 添加一个矩形<br><code>void CGContextAddRect(CGContextRef c, CGRect rect)</code><br>• 添加一个椭圆<br><code>void CGContextAddEllipseInRect(CGContextRef context, CGRect rect)</code><br>• 添加一个圆弧<br><code>void CGContextAddArc(CGContextRef c, CGFloat x, CGFloat y, CGFloat radius, CGFloat startAngle, CGFloat endAngle, int clockwise)</code></p>
<h4 id="常用绘制路径函数"><a href="#常用绘制路径函数" class="headerlink" title="常用绘制路径函数"></a>常用绘制路径函数</h4><p>• Mode参数决定绘制的模式<br><code>void CGContextDrawPath(CGContextRef c, CGPathDrawingMode mode)</code><br>• 绘制空心路径<br><code>void CGContextStrokePath(CGContextRef c)</code><br>• 绘制实心路径<br><code>void CGContextFillPath(CGContextRef c)</code><br><strong>提示：一般以CGContextDraw、CGContextStroke、CGContextFill开头的函数，都是用来绘制路径的</strong></p>
<h4 id="图形上下文栈的操作"><a href="#图形上下文栈的操作" class="headerlink" title="图形上下文栈的操作"></a>图形上下文栈的操作</h4><p>• 将当前的上下文copy一份,保存到栈顶(那个栈叫做”图形上下文栈”)<br><code>void CGContextSaveGState(CGContextRef c)</code><br>• 将栈顶的上下文出栈,替换掉当前的上下文<br><code>void CGContextRestoreGState(CGContextRef c)</code></p>
<h3 id="矩阵操作"><a href="#矩阵操作" class="headerlink" title="矩阵操作"></a>矩阵操作</h3><p>利用矩阵操作，能让绘制到上下文中的所有路径一起发生变化<br>• 缩放<br><code>void CGContextScaleCTM(CGContextRef c, CGFloat sx, CGFloat sy)</code><br>• 旋转<br><code>void CGContextRotateCTM(CGContextRef c, CGFloat angle)</code><br>• 平移<br><code>void CGContextTranslateCTM(CGContextRef c, CGFloat tx, CGFloat ty)</code></p>
<h3 id="绘图的核心步骤："><a href="#绘图的核心步骤：" class="headerlink" title="绘图的核心步骤："></a>绘图的核心步骤：</h3><p>1   获得上下文<br>2   绘制/拼接绘图路径<br>3   将路径添加到上下文<br>4   渲染上下文<br><strong>记住：所有的绘图，都是这个步骤，即使使用贝塞尔路径，也只是对这个步骤进行了封装。对于绘图而言，拿到上下文很关键。</strong></p>
<h4 id="贝塞尔路径"><a href="#贝塞尔路径" class="headerlink" title="贝塞尔路径"></a>贝塞尔路径</h4><p>就是UIKit框架中，对绘图的封装。实际操作起来，使用贝塞尔路径，更为方便。<br>• 用法与CGContextRef类似，但是oc对其进行了封装，更加面向对象。<br>• 常用的方法：<br>◦ 返回一个描述椭圆的路径:<br><code>+ (UIBezierPath *)bezierPathWithOvalInRect:(CGRect)rect;</code><br>◦ 设置起始点:<br><code>- (void)moveToPoint:(CGPoint)point;</code><br>◦ 添加直线到一点:<br><code>- (void)addLineToPoint:(CGPoint)point;</code><br>◦ 三次贝塞尔曲线：<br><code>- (void)addCurveToPoint:(CGPoint)endPoint controlPoint1:(CGPoint)controlPoint1 controlPoint2:(CGPoint)controlPoint2;</code></p>
<p><img src="https://ww1.sinaimg.cn/large/006tKfTcjw1fbozfmu0u4g3097049dfm.gif" alt=""></p>
<ul>
<li>贝塞尔曲线:<br><code>- (void)addQuadCurveToPoint:(CGPoint)endPoint controlPoint:(CGPoint)controlPoint;</code></li>
</ul>
<p><img src="https://ww3.sinaimg.cn/large/006tKfTcjw1fbp6pzowv2g30cu057mwz.gif" alt=""></p>
<ul>
<li><p>绘制圆弧:<br><code>- (void)addArcWithCenter:(CGPoint)center radius:(CGFloat)radius startAngle:(CGFloat)startAngle endAngle:(CGFloat)endAngle clockwise:(BOOL)clockwise;</code><br><img src="https://ww1.sinaimg.cn/large/006tKfTcjw1fbp6so1lv1j309u08sgll.jpg" alt=""></p>
</li>
<li><p>封闭闭路径:<code>- (void)closePath;</code></p>
</li>
</ul>
<h3 id="接下来针对上面讲的一些内容，我们来做几个小demo。上代码："><a href="#接下来针对上面讲的一些内容，我们来做几个小demo。上代码：" class="headerlink" title="接下来针对上面讲的一些内容，我们来做几个小demo。上代码："></a>接下来针对上面讲的一些内容，我们来做几个小demo。上代码：</h3><p>下面的都是在drawRect方法里面实现的。</p>
<ul>
<li><p>绘制线条</p>
</li>
<li><p>绘制线条的第一种方式：创建路径，将线条添加到路径上，再把路径添加到图形上下文</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">//1.获取当前的图形上下文</div><div class="line"></div><div class="line">CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">// .创建一条绘制的路径，此路径为可变的路径</div><div class="line"></div><div class="line">CGMutablePathRef path = CGPathCreateMutable();</div><div class="line"></div><div class="line">//3.起始点</div><div class="line"></div><div class="line">CGPathMoveToPoint(path, NULL, 50, 50);</div><div class="line"></div><div class="line">CGPathAddLineToPoint(path, NULL, 100, 100);</div><div class="line"></div><div class="line">CGPathAddLineToPoint(path, NULL, 50, 100);</div><div class="line"></div><div class="line">//4.关闭路径</div><div class="line"></div><div class="line">CGPathCloseSubpath(path); </div><div class="line"></div><div class="line">//5.把路径添加到图形上下文，才能显示在界面上。  </div><div class="line"></div><div class="line">CGContextAddPath(context, path);</div><div class="line"></div><div class="line">//6.设置图形上下文的属性（如线条的颜色宽度等）</div><div class="line"></div><div class="line">CGContextSetRGBStrokeColor(context, 254/255.0, 201/255.0, 22/255.0, 1);</div><div class="line"></div><div class="line">CGContextSetRGBFillColor(context, 1, 0, 0, 1);</div><div class="line"></div><div class="line">CGContextSetLineWidth(context, 3.0);</div><div class="line"></div><div class="line">//7.绘制</div><div class="line"></div><div class="line">CGContextDrawPath(context, kCGPathFillStroke);  </div><div class="line"></div><div class="line">//8.释放路径</div><div class="line"></div><div class="line">CGPathRelease(path);</div></pre></td></tr></table></figure>
</li>
<li><p>绘制线条的第二种方式：直接将线条绘制到图形上下文上。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//获取当前的图形上下文</div><div class="line"></div><div class="line">CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">CGPoint points[] = &#123;&#123;50,50&#125;, &#123;200,200&#125;, &#123;50,200&#125;, &#123;50,50&#125;&#125;;</div><div class="line"></div><div class="line">//直接将线条添加到图形上下文</div><div class="line">CGContextAddLines(context, points, 4);</div><div class="line"></div><div class="line">//设置图形上下文的属性</div><div class="line">[[UIColor redColor] setStroke];</div><div class="line">[[UIColor blueColor] setFill];</div><div class="line"></div><div class="line">//[[UIColor orangeColor] set]; //一起设置线条和填充颜色</div><div class="line"></div><div class="line">CGContextSetLineWidth(context, 5);</div><div class="line"></div><div class="line">//绘制</div><div class="line">CGContextDrawPath(context, kCGPathFillStroke);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>绘制矩形</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">//获取当前的图形上下文</div><div class="line"></div><div class="line">CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">CGContextAddRect(context, CGRectMake(10, 10, 200, 200));</div><div class="line">[[UIColor orangeColor] set];</div><div class="line">CGContextSetLineWidth(context, 5);</div><div class="line">//绘制</div><div class="line">CGContextDrawPath(context, kCGPathFillStroke);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>绘制圆形</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//获取当前的图形上下文</div><div class="line"></div><div class="line">CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">CGContextAddArc(context, 100, 100, 100, 0, M_PI * 2, 0);</div><div class="line">[[UIColor redColor] set];</div><div class="line">CGContextDrawPath(context, kCGPathFillStroke);</div></pre></td></tr></table></figure>
</li>
<li><p>绘制Bezier曲线</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//获取当前的图形上下文</div><div class="line"></div><div class="line">CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">CGContextMoveToPoint(context, 20, 200);</div><div class="line">CGContextAddCurveToPoint(context, 100, 220, 200, 300, 300, 50);</div><div class="line">[[UIColor redColor] set];</div><div class="line">CGContextDrawPath(context, kCGPathFillStroke);</div></pre></td></tr></table></figure>
</li>
<li><p>绘制文本:轻量级，不需要创建一个UI控件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">NSString *str = @&quot;I am a teacher and you are a student&quot;;</div><div class="line">UIFont *font = [UIFont systemFontOfSize:18];</div><div class="line">UIColor *color = [UIColor redColor];</div><div class="line"></div><div class="line">NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc] init];</div><div class="line">style.alignment = NSTextAlignmentCenter;</div><div class="line"></div><div class="line">NSDictionary *attributes = @&#123;</div><div class="line">                             NSFontAttributeName : font,</div><div class="line">                             NSForegroundColorAttributeName : color,</div><div class="line">                             NSParagraphStyleAttributeName : style</div><div class="line">                             &#125;;</div><div class="line">[str drawInRect:CGRectMake(50, 50, 200, 400) withAttributes:attributes];</div></pre></td></tr></table></figure>
</li>
<li><p>绘制图片：轻量级，不需要创建UIIMageView就能显示图片</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">//获取当前的图形上下文</div><div class="line"></div><div class="line">CGContextRef context = UIGraphicsGetCurrentContext();</div><div class="line"></div><div class="line">//1.创建UIImage</div><div class="line">UIImage *image = [UIImage imageNamed:@&quot;ali.jpg&quot;];</div><div class="line"></div><div class="line">//2.坐标系统的转换 UIKit(左上）--&gt;Quarz2D（左下）</div><div class="line">//(1)保存UIKitContex</div><div class="line">CGContextSaveGState(context);</div><div class="line"></div><div class="line">//(2)把y缩放为原来的-1倍</div><div class="line">CGContextScaleCTM(context, 1, -1);</div><div class="line"></div><div class="line">//(3)把y平移图片高度</div><div class="line">CGContextTranslateCTM(context, 0, -image.size.height);</div><div class="line"></div><div class="line">CGContextDrawImage(context, CGRectMake(0, 0, image.size.width, image.size.height), image.CGImage);</div><div class="line"></div><div class="line">//(4）恢复contex</div><div class="line">CGContextRestoreGState(context);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>这里是我的一个关于自定义水印的demo:<a href="https://github.com/Feyddy/FDWaterImage.git" title="FDWaterImage" target="_blank" rel="external">FDWaterImage</a></p>
</li>
<li><p>我们在做一个自定义的UILabel好了：<br>FDLabel.h里面自定义两个开放的属性:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">@interface MyLabel : UIView</div><div class="line"></div><div class="line">@property(nonatomic, copy)NSString *text;</div><div class="line"></div><div class="line">@property(nonatomic, strong)UIFont *font;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>FDLabel.m 里面实现drawRect方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line">import &quot;FDLabel.h&quot;</div><div class="line"></div><div class="line">@implementation FDLabel</div><div class="line"></div><div class="line">- (instancetype)initWithFrame:(CGRect)frame &#123;</div><div class="line">    if (self = [super initWithFrame:frame]) &#123;</div><div class="line">		 self.font = [UIFont systemFontOfSize:14];</div><div class="line">  		 self.text = @&quot;Label&quot;;</div><div class="line">  &#125;</div><div class="line">    return self;</div><div class="line">&#125;</div><div class="line">- (void)drawRect:(CGRect)rect &#123;</div><div class="line">    // Drawing code</div><div class="line">    //绘制文本</div><div class="line">    NSMutableParagraphStyle *style = [[NSMutableParagraphStyle alloc] init];</div><div class="line">    style.alignment = NSTextAlignmentCenter;</div><div class="line">    UIColor *color = [UIColor greenColor];</div><div class="line">    [self.text drawInRect:rect withAttributes:@&#123;NSFontAttributeName : self.font,</div><div class="line">     										NSForegroundColorAttributeName : color,</div><div class="line">                                          NSParagraphStyleAttributeName : style</div><div class="line">                                          </div><div class="line">                                          &#125;];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (void)setFont:(UIFont *)font &#123;</div><div class="line">  if (_font != font) &#123;</div><div class="line">	  _font = font;</div><div class="line">  	//刷新Label,要发送setNeedsDisplay方法来让系统自动调用drawRect:刷新</div><div class="line">  	[self setNeedsDisplay];</div><div class="line">  </div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">- (void)setText:(NSString *)text &#123;</div><div class="line">    if (_text != text) &#123;</div><div class="line">      _text = text;</div><div class="line">      [self setNeedsDisplay];</div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>​                                    </p>
</li>
<li><p>读取生成PDF<br>首先创建一个工程，导入CoreText.framework框架。在ViewController.h文件中引入CoreText文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line">-(void)drawText</div><div class="line"></div><div class="line">&#123;</div><div class="line"></div><div class="line"> //在沙盒目录下创建PDF文件，并命名为Invoice.pdf</div><div class="line"></div><div class="line">NSString* fileName = @&quot;Invoice.PDF&quot;;</div><div class="line">NSArray *arrayPaths =</div><div class="line">NSSearchPathForDirectoriesInDomains(</div><div class="line">                                    NSDocumentDirectory,</div><div class="line">                                    NSUserDomainMask,</div><div class="line">                                    YES);</div><div class="line">NSString *path = [arrayPaths objectAtIndex:0];</div><div class="line">NSString* pdfFileName = [path stringByAppendingPathComponent:fileName];</div><div class="line"></div><div class="line">//创建一个已“Hello，world”为内容的PDF，将string转换为CFStringRef格式</div><div class="line">NSString* textToDraw = @&quot;Hello World&quot;;</div><div class="line">CFStringRef stringRef = (__bridge CFStringRef)textToDraw;</div><div class="line"></div><div class="line">// 使用 Core Text Framesetter.</div><div class="line">CFAttributedStringRef currentText = CFAttributedStringCreate(NULL, stringRef, NULL);</div><div class="line">CTFramesetterRef framesetter = CTFramesetterCreateWithAttributedString(currentText);</div><div class="line"></div><div class="line">//创建一个CGRect用于定义文本的大小</div><div class="line">  CGRect frameRect = CGRectMake(0, 0, 300, 50);CGMutablePathRef framePath = CGPathCreateMutable();CGPathAddRect(framePath, NULL, frameRect);// 获取将要被渲染的帧CFRange currentRange = CFRangeMake(0, 0);CTFrameRef frameRef = CTFramesetterCreateFrame(framesetter, currentRange, framePath, NULL);CGPathRelease(framePath);</div><div class="line">  </div><div class="line">  </div><div class="line">  //创建一个PDF上下文和标记的PDF的起始页。 PDF的每个页面都有开始并调用UIGraphicsBeginPDFPageWithInfo</div><div class="line">    // 创建一个PDF的上下文，页面大小默认为 612 x 792UIGraphicsBeginPDFContextToFile(pdfFileName, CGRectZero, nil);// 标记新页面的开头UIGraphicsBeginPDFPageWithInfo(CGRectMake(0, 0, 612, 792), nil);// 获取上下文.CGContextRef currentContext = UIGraphicsGetCurrentContext();</div><div class="line">    </div><div class="line">    </div><div class="line">    // 创建一个PDF的上下文，页面大小默认为 612 x 792</div><div class="line">UIGraphicsBeginPDFContextToFile(pdfFileName, CGRectZero, nil);</div><div class="line">// 标记新页面的开头</div><div class="line">UIGraphicsBeginPDFPageWithInfo(CGRectMake(0, 0, 612, 792), nil);</div><div class="line">// 获取上下文.</div><div class="line">CGContextRef currentContext = UIGraphicsGetCurrentContext();</div><div class="line"> //由于Core Graphics 的坐标是从左下角开始，而UIKit的坐标是从左上角开始，所以需做一个变换：</div><div class="line"> // 把文字变成矩阵已知状态。这将确保没有旧缩放因子被留在原处。</div><div class="line"> CGContextSetTextMatrix(currentContext, CGAffineTransformIdentity);</div><div class="line"> //文本坐标翻转</div><div class="line"> CGContextTranslateCTM(currentContext, 0, 100);</div><div class="line"> CGContextScaleCTM(currentContext, 1.0, -1.0);</div><div class="line"> //绘制文本实际帧，释放Core Graphics对象，并关闭PDF上下文至此PDF写入到沙盒目录下。</div><div class="line"> // 绘制帧</div><div class="line"> CTFrameDraw(frameRef, currentContext);</div><div class="line"> CFRelease(frameRef);</div><div class="line"> CFRelease(stringRef);</div><div class="line"> CFRelease(framesetter);</div><div class="line"> //关闭PDF上下文</div><div class="line"> UIGraphicsEndPDFContext();</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
</li>
<li><p>我们使用UIWebView来加载PDF文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">- (void)showPDFFile</div><div class="line"></div><div class="line">&#123;</div><div class="line"></div><div class="line">NSString* fileName = @&quot;Invoice.PDF&quot;;</div><div class="line"></div><div class="line">NSArray *arrayPaths =</div><div class="line"></div><div class="line">NSSearchPathForDirectoriesInDomains( NSDocumentDirectory,</div><div class="line">                              NSUserDomainMask,</div><div class="line">                              YES);</div><div class="line">   NSString *path = [arrayPaths objectAtIndex:0];</div><div class="line">  NSString* pdfFileName = [path stringByAppendingPathComponent:fileName];</div><div class="line"></div><div class="line">  UIWebView* webView = [[UIWebView alloc] initWithFrame:CGRectMake(0, 0, 320, 480)];</div><div class="line"></div><div class="line">  NSURL *url = [NSURL fileURLWithPath:pdfFileName];</div><div class="line"></div><div class="line">  NSURLRequest *request = [NSURLRequest requestWithURL:url];</div><div class="line"></div><div class="line">  [webView setScalesPageToFit:YES];</div><div class="line"></div><div class="line">  [webView loadRequest:request];</div><div class="line"></div><div class="line">  [self.view addSubview:webView];  </div><div class="line"></div><div class="line">  &#125;</div><div class="line"> -(void)viewDidLoad</div><div class="line"></div><div class="line">  &#123;</div><div class="line"></div><div class="line">    [self drawText];</div><div class="line"></div><div class="line">    [self showPDFFile];</div><div class="line"></div><div class="line">   [super viewDidLoad];</div><div class="line"></div><div class="line">  &#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Quartz-2D的渐变方式分为两种："><a href="#Quartz-2D的渐变方式分为两种：" class="headerlink" title="Quartz 2D的渐变方式分为两种："></a>Quartz 2D的渐变方式分为两种：</h4><pre><code>a.线性渐变线：渐变色以直线方式从开始位置逐渐向结束位置渐变
b.径向渐变：以中心点为圆心从起始渐变色向四周辐射，直到终止渐变色
   要做渐变则必须先设置从开始位置到结束位置的渐变颜色，做过photoshop的朋友相信对于渐变色设置并不陌生，只要在指定位置指定不同的颜色，剩下的事情交给系统处理即可，如下图在起始位置、3/10位置、结束位置指定了三种颜色就形成由三种颜色组成的渐变色：
</code></pre><p><img src="http://img.blog.csdn.net/20160113092306928" alt=""><br>另外，在iOS中绘制渐变还需要注意一点就是指定颜色空间，所谓颜色空间就是不同颜色在不同的维度上取值最终组成一种颜色的过程。就拿RGB来说，如果将红色、绿色、蓝色看成是x、y、z轴坐标系，那么在三个坐标上分别取0~255范围内的不同值则可以组成各类颜色。当然，不同颜色空间的“坐标系”也是不同的（也就是说颜色表示的方式是不同的），常用的颜色空间除了RGB还有CMYK（印刷业常用这种颜色模式）、Gray。<br>      在使用Quartz 2D绘图时我们的颜色除了使用常规的方法（前面<code>CGContextSetRGBFillColor(CGContextRef context, CGFloat red, CGFloat green, CGFloat blue, CGFloat alpha)</code>方法）设置<code>RGB</code>和透明度外，有时还会遇到颜色参数是一个数组情况。如使用颜色空间填充时用到的<code>CGContextSetFillColor(CGContextRef context, const CGFloat *components)</code>方法，这个时候components数组中具体是如何存储颜色就要根据颜色空间而定，如果颜色空间使用RGB则数组中的元素四个为一组，分别是red（红）、green（绿）、blue（蓝）、alpha（透明度）；如果使用CMYK颜色空间，那么数组中的元素五个为一组，分别是cyan（青）、magenta（洋红）、yellow（黄）、black（黑）、alpha（透明度）。</p>
<p>详细demo请看：<a href="https://github.com/Feyddy/FDQuartz2DGradualChange.git" target="_blank" rel="external">FDQuartz2DGradualChange</a><br>或者还有一篇比较好的博客：<a href="http://blog.csdn.net/xy_26207005/article/details/51481510" target="_blank" rel="external"> http://blog.csdn.net/xy_26207005/article/details/51481510 </a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/12/ARC的基本使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/12/ARC的基本使用/" itemprop="url">
                  ARC的基本使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-12T22:23:28+08:00">
                2017-01-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/12/ARC的基本使用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/12/ARC的基本使用/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/12/ARC的基本使用/" class="leancloud_visitors" data-flag-title="ARC的基本使用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>ARC中可以重写dealloc，但是不允许调用[super dealloc]</p>
</li>
<li><p>ARC中一般不需要重写Dealloc,但是一些情况比如移除通知，移除观察者等需要重写dealloc,在对象释放之前做一些内存的清理工作。</p>
</li>
<li><p>弱指针指向的实例对象被释放后，弱指针自动清空为nil</p>
<p>__<em>unsafe\</em>__unretained修饰的指针，当其指向的实例对象被释放后，此指针不会自动清空。此关键字在iOS5之前会使用，目前几乎不使用。</p>
</li>
<li><p>弱指针使用的场景：</p>
<p>   (1)delegate属性一般使用weak避免产生循环引用 self–&gt;self.view–&gt;tableView–&gt;self 产生循环引用</p>
<p>   (2)block</p>
<p>   (3)storyboard连线默认是weak:viewController–&gt;view–&gt;button,没有必要再让viewController再次持有一次button。</p>
</li>
<li><p>ARC桥接（Toll-free Bridging。 简称：TFB）</p>
<ul>
<li><p>允许OC类型与对应的CoreFoundation类型之间相互转换的机制。</p>
</li>
<li><p>ARC进行内存管理的范围即OC对象，对于CF框架框架中的对象无法进行管理。</p>
</li>
<li><p>两个框架之间类型进行转换时，有三个关键字进行桥接：_<strong><em>bridge\</em>_ </strong>bridge_retained __bridge_transfer</p>
</li>
<li><p><strong>\</strong>bridge表示即不授权也不放权，仍然由ARC来管理string对象的内存.__</p>
<p><code>CFStringRef cfstring1 = (__bridge CFStringRef)string;</code></p>
</li>
<li><p>__bridge_retained表示ARC放弃管理内存，把此权利交给CF,由其管理内存</p>
<p><code>CFStringRef cfstring1 = (__bridge_retained CFStringRef)string;</code></p>
<p><code>CFStringRef cfstring2 = CFBridgingRetain(string);</code></p>
</li>
<li><p>CF释放内存</p>
<p><code>CFRelease(cfstring1);</code></p>
</li>
</ul>
<p>下面举个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">CFStringRef cfString = CFStringCreateWithFormat(kCFAllocatorDefault, NULL, (__bridge CFStringRef)@&quot;text-%i&quot;, 100);</div><div class="line"></div><div class="line">  //把CF对象转成OC对象 __bridge_transfer：表示把管理内存的权利授权给ARC,CF不需要管理内存</div><div class="line">  NSString *ocString = (__bridge_transfer NSString *)cfString;</div><div class="line">  </div><div class="line">  CFRelease(cfString);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/01/12/Block的基本用法/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Feyddy">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="清风明心">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="清风明心" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/12/Block的基本用法/" itemprop="url">
                  Block的基本用法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-12T21:09:02+08:00">
                2017-01-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Objective-C/" itemprop="url" rel="index">
                    <span itemprop="name">Objective-C</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2017/01/12/Block的基本用法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="http://yoursite.com/2017/01/12/Block的基本用法/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          

          
          
             <span id="/2017/01/12/Block的基本用法/" class="leancloud_visitors" data-flag-title="Block的基本用法">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>block是OC中另外一种对象和对象的通信方式，是一对一的关系，类似于delegate，而通知时一对多的关系</p>
<h4 id="Block的基本用法"><a href="#Block的基本用法" class="headerlink" title="Block的基本用法"></a>Block的基本用法</h4><ul>
<li><p>block 也可以看做是一个变量，也有点类似于函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">// block 的声明</div><div class="line"></div><div class="line"> // 返回值 (^变量名)(参数类型1, 参数类型2, ...)</div><div class="line"></div><div class="line"> int (^block1)(int, int);</div><div class="line"></div><div class="line"> // block 的赋值</div><div class="line"></div><div class="line"> // 注意 1. 参数不能只写类型，必须要带上参数名。 2. block的创建不代表代码块的运行</div><div class="line"></div><div class="line"> block1 = ^(int a, int b)&#123;</div><div class="line"></div><div class="line">     return a + b;</div><div class="line"></div><div class="line"> &#125;;</div><div class="line"></div><div class="line"> // block 的调用</div><div class="line"></div><div class="line"> int sum = block1(10,20);</div><div class="line"></div><div class="line"> NSLog(@&quot;%i&quot;, sum);</div></pre></td></tr></table></figure>
</li>
<li><p>定义一个block类型</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">//---------------------block类型的定义---------------------</div><div class="line"></div><div class="line">// 定义一个block类型</div><div class="line"></div><div class="line">// 类型名：StringBlock  指代返回值为NSString* 参数为一个int 的block</div><div class="line"></div><div class="line">typedef NSString *(^StringBlock)(int);</div><div class="line"></div><div class="line">// 使用block类型 来定义变量</div><div class="line"></div><div class="line">StringBlock block2 = ^(int b)&#123;</div><div class="line"></div><div class="line">    return [NSString stringWithFormat:@&quot;%i&quot;, b];</div><div class="line"></div><div class="line">&#125;;</div><div class="line"></div><div class="line">NSString *str1 = block2(5);</div><div class="line"></div><div class="line">NSLog(@&quot;%@&quot;, str1);</div></pre></td></tr></table></figure>
</li>
<li><p>block作为参数传递</p>
<p>首先我们先定义一个Person类，里面定义一个Block属性</p>
<p>Person.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- #import &lt;Foundation/Foundation.h&gt;</div><div class="line">  typedef NSString *(^YearBlock)();</div><div class="line">  @interface Person : NSObject</div><div class="line"></div><div class="line">  @property (nonatomic, copy) NSString *name;     // 名字</div><div class="line"></div><div class="line">  @property (nonatomic, assign) NSInteger age;    // 年龄</div><div class="line"></div><div class="line">  @property (nonatomic, copy) YearBlock block;</div><div class="line"></div><div class="line">- (instancetype)initWithName:(NSString *)name age:(NSInteger)age;</div><div class="line"></div><div class="line">- (void)setBlock:(YearBlock)block;</div><div class="line"></div><div class="line">  @end</div></pre></td></tr></table></figure>
<p>Person.m</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> #import &quot;Person.h&quot;</div><div class="line"></div><div class="line">  @implementation Person</div><div class="line"></div><div class="line">- (instancetype)initWithName:(NSString *)name age:(NSInteger)age</div><div class="line">  &#123;</div><div class="line">    self = [super init];</div><div class="line">    if (self)</div><div class="line">    &#123;</div><div class="line">        self.name = name;</div><div class="line">        self.age = age;</div><div class="line">    &#125;</div><div class="line">    return self;</div><div class="line">  &#125;</div><div class="line">- (void)setBlock:(YearBlock)block</div><div class="line">  &#123;</div><div class="line">    // block 在作为类的属性  或者全局变量时 需要使用copy</div><div class="line">    _block = [block copy];</div><div class="line">  &#125;</div><div class="line">  @end</div></pre></td></tr></table></figure>
<p>然后在控制器中实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">//---------------------block作为参数---------------------</div><div class="line"></div><div class="line">  Person *p = [[Person alloc] initWithName:@&quot;jack&quot; age:18];</div><div class="line"></div><div class="line">  [p setBlock:^NSString *&#123;</div><div class="line"></div><div class="line">      return [NSString stringWithFormat:@&quot;%li&quot;, 2015 - p.age];</div><div class="line"></div><div class="line">  &#125;];</div><div class="line"></div><div class="line">  NSString *yearString = p.block();</div><div class="line"></div><div class="line">  NSLog(@&quot;%@&quot;, yearString);</div></pre></td></tr></table></figure>
<ul>
<li><p>block页面传值</p>
<p>首先创建一个控制器SecondViewController，里面定义一个block</p>
<p>SecondViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">#import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">// 给block 声明一个数据类型</div><div class="line"></div><div class="line">typedef void(^ShowTextBlock)(NSString *);</div><div class="line"></div><div class="line">@interface SecondViewController : UIViewController</div><div class="line"></div><div class="line">// 定义一个block</div><div class="line"></div><div class="line">@property (nonatomic, copy) ShowTextBlock block;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>​</p>
<p>SecondViewController.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#import &quot;SecondViewController.h&quot;</div><div class="line"></div><div class="line">@interface SecondViewController ()</div><div class="line"></div><div class="line">@property (weak, nonatomic) IBOutlet UITextField *textField;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation SecondViewController</div><div class="line"></div><div class="line">- (IBAction)enterButtonAction:(id)sender &#123;</div><div class="line">  // 使用block 来回传数据</div><div class="line">  if (_block)</div><div class="line">  &#123;</div><div class="line">    block(textField.text);</div><div class="line">  &#125;</div><div class="line">  [self.navigationController popToRootViewControllerAnimated:YES];</div><div class="line">  &#125;</div><div class="line">  @end</div></pre></td></tr></table></figure>
<p>​</p>
<p>然后在主控制器中给block赋值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">#import &quot;SecondViewController.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@property (weak, nonatomic) IBOutlet UILabel *label;</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">  [super viewDidLoad];</div><div class="line">  // Do any additional setup after loading the view, typically from a nib.</div><div class="line">  &#125;</div><div class="line">- (IBAction)pushInputView:(id)sender &#123;</div><div class="line">  SecondViewController *second = [self.storyboard instantiateViewControllerWithIdentifier:@&quot;SecondViewController&quot;];</div><div class="line">  // 给block赋值 用于将回传的值 显示到label上面去</div><div class="line">  [second setBlock:^(NSString *text)&#123;</div><div class="line">    _label.text = text;</div><div class="line">  &#125;];</div><div class="line">  [self.navigationController pushViewController:second animated:YES];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>block的内存管理问题</p>
<p>  循环引用的原因：某个对象 持有了一个 被 copy的block，这个block中，又引用了这个对象</p>
<p>  解决方法: 使用一个__weak类型的中间指针 来引用这个对象。如：__</p>
<p>  <code>weak Person *weakP = p;</code></p>
<p>  循环引用：造成了内存泄漏 </p>
<p>  在ARC中，block中使用到了某个对象，或者对象的属性，可以看作是block持有了这个对象</p>
</li>
<li><p>block和变量</p>
<p>  局部变量：在block中，会把局部变量当成常量变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">int num=10;</div><div class="line"></div><div class="line">      　　int num=30;</div><div class="line"></div><div class="line">      　　MyBlock myblock=^(int a)</div><div class="line"></div><div class="line">      　　&#123;</div><div class="line"></div><div class="line">      　　num=20; //此处会报错</div><div class="line"></div><div class="line">      　　NSLog(@&quot;%d&quot;,a);</div><div class="line"></div><div class="line">      　　return 30;</div><div class="line"></div><div class="line">      　　&#125;;</div></pre></td></tr></table></figure>
<p>  ​</p>
<p>  原因：block代码块不会在写的地方执行，是在其他地方调用时才会执行，局部变量在跳出此作用域时销毁，所以block代码块会将局部变量当成一个常量变量来处理，要修改前面加__block</p>
<p>  解决方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">__block int num=10; </div><div class="line"></div><div class="line">MyBlock myblock=^(int a) &#123; </div><div class="line"></div><div class="line">NSLog(@&quot;before the val of num is %d&quot;,num);</div><div class="line"></div><div class="line">num++; </div><div class="line"></div><div class="line">return 30; </div><div class="line"></div><div class="line">&#125;; </div><div class="line"></div><div class="line">num=30; </div><div class="line"></div><div class="line">[self testBlock:myblock];</div><div class="line"></div><div class="line">NSLog(@&quot;after the val of num is %d&quot;,num);</div></pre></td></tr></table></figure>
<p>  ​</p>
<p>  输出结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2013-10-28 15:38:24.602 blockDemo[1541:70b] before the val of num is 30</div><div class="line"></div><div class="line">2013-10-28 15:38:24.603 blockDemo[1541:70b] after the val of num is 31</div></pre></td></tr></table></figure>
<p>  ​</p>
</li>
<li><p>用block自定义一个按钮</p>
<p>  BlockButton.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">  #import &lt;UIKit/UIKit.h&gt;</div><div class="line"></div><div class="line">  // 定义block类型</div><div class="line"></div><div class="line">  typedef void(^ButtonBlock)(UIButton *);</div><div class="line"></div><div class="line">  @interface BlockButton : UIButton</div><div class="line"></div><div class="line">  // 属性  block  用于在按钮被点击之后执行回调</div><div class="line"></div><div class="line">  @property (nonatomic, copy) ButtonBlock block;</div><div class="line"></div><div class="line">  // 给按钮设置回调的block</div><div class="line"></div><div class="line">- (void)addBlock:(ButtonBlock)block;</div><div class="line"></div><div class="line">@end</div></pre></td></tr></table></figure>
<p>​</p>
<p>BlockButton.m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">#import &quot;BlockButton.h&quot;</div><div class="line"></div><div class="line">@implementation BlockButton</div><div class="line"></div><div class="line">// 给按钮添加block回调</div><div class="line"></div><div class="line">- (void)addBlock:(ButtonBlock)block</div><div class="line">  &#123;</div><div class="line">  // 1. 储存block</div><div class="line">  _block = [block copy];</div><div class="line">  // 2. 添加一个点击事件</div><div class="line">  [self addTarget:self action:@selector(buttonAction:) forControlEvents:UIControlEventTouchUpInside];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">// 按钮的点击事件</div><div class="line"></div><div class="line">- (void)buttonAction:(UIButton *)button</div><div class="line">  &#123;</div><div class="line">  // 调用block</div><div class="line">  // 判断 如果没有block</div><div class="line">  if (_block)</div><div class="line">  &#123;</div><div class="line">      _block(button);</div><div class="line">  &#125;</div><div class="line">  &#125;</div><div class="line">  @end</div></pre></td></tr></table></figure>
<p>​</p>
<p>然后在主控制器中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">#import &quot;ViewController.h&quot;</div><div class="line"></div><div class="line">#import &quot;BlockButton.h&quot;</div><div class="line"></div><div class="line">@interface ViewController ()</div><div class="line"></div><div class="line">@end</div><div class="line"></div><div class="line">@implementation ViewController</div><div class="line"></div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">  [super viewDidLoad];</div><div class="line">  BlockButton *button2 = [BlockButton buttonWithType:UIButtonTypeContactAdd];</div><div class="line">  button2.frame = CGRectMake(100, 100, 30, 30);</div><div class="line">  // 给按钮添加点击回调block</div><div class="line">  [button2 addBlock:^(UIButton *button) &#123;</div><div class="line">   // 按钮被点击之后 运行的代码</div><div class="line">    NSLog(@&quot;按钮被点击了&quot;);</div><div class="line">  &#125;];</div><div class="line">  [self.view addSubview:button2];</div><div class="line">  &#125;</div><div class="line">- (void)buttonAction:(UIButton *)button</div><div class="line">  &#123;</div><div class="line">  &#125;</div><div class="line">  @end</div></pre></td></tr></table></figure>
<p>​</p>
<p>​</p>
<p>​</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww3.sinaimg.cn/large/e3aca1a1jw1fahfwp4p04j207307mwf6.jpg"
               alt="Feyddy" />
          <p class="site-author-name" itemprop="name">Feyddy</p>
          <p class="site-description motion-element" itemprop="description">不积跬步，无以至千里；不积小流，无以成江海。</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">43</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">41</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Feyddy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/新Feyddy" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Feyddy</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
